import{r as x,j as e,A as oe}from"./index-09c3368c.js";import{G as ie}from"./GlassModal-a6c5f610.js";import{T as de}from"./TabNavigation-8088ee11.js";import{S as xe}from"./StandardTable-d1cd024c.js";import{S as I}from"./SearchableSelect-bf34f521.js";import{F as me}from"./FunnelIcon-694d59fc.js";import{U as he}from"./UsersIcon-56853008.js";import{P as ge}from"./PlusIcon-3d2e3b30.js";import{T as re}from"./TagIcon-88ee5672.js";import{G as pe}from"./GiftIcon-2b55a02f.js";import{E as ue}from"./EyeIcon-bb65ea7b.js";import{P as be}from"./PencilIcon-619ae986.js";import{C as je}from"./CreditCardIcon-8584d4ca.js";import"./XMarkIcon-93d59038.js";import"./chevron-down-5d12351e.js";function ve({title:t,titleId:l,...r},c){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":l},r),t?x.createElement("title",{id:l},t):null,x.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"}))}const Ne=x.forwardRef(ve),fe=Ne;function ye({title:t,titleId:l,...r},c){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":l},r),t?x.createElement("title",{id:l},t):null,x.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const we=x.forwardRef(ye),ke=we,Ce=Array.from({length:20}).map((t,l)=>({id:`MBR-${100+l}`,memberNo:`M-${100+l}`,name:["王小明","李小美","陳大文","林靜怡","張雅婷"][l%5],email:`user${l}@example.com`,phone:`09${String(1e7+l).slice(0,8)}`,level:["一般","金卡","銀卡","VIP"][l%4],status:l%3===0?"inactive":"active",totalOrders:Math.floor(Math.random()*20),totalSpent:Math.floor(Math.random()*5e4)})),v={async getMembers(){return await new Promise(t=>setTimeout(t,80)),{success:!0,data:[...Ce]}}};function Se(t){return Array.from({length:Math.floor(Math.random()*6)+2}).map((l,r)=>({id:`${t}-ORD-${r+1}`,date:new Date(Date.now()-r*864e5).toISOString().slice(0,10),items:Math.floor(Math.random()*4)+1,amount:Math.floor(Math.random()*4e3)+500,status:["pending","processing","shipped","delivered"][r%4]}))}function Me(t){return Array.from({length:Math.floor(Math.random()*3)}).map((l,r)=>({id:`${t}-RF-${r+1}`,date:new Date(Date.now()-r*1728e5).toISOString().slice(0,10),amount:Math.floor(Math.random()*2e3)+200,status:["requested","approved","rejected"][r%3]}))}const ne={async getOrdersByMember(t){return await new Promise(l=>setTimeout(l,60)),{success:!0,data:Se(t)}},async getRefundsByMember(t){return await new Promise(l=>setTimeout(l,60)),{success:!0,data:Me(t)}}},u=t=>`NT$ ${Number(t||0).toLocaleString()}`,De=({detail:t})=>{var i,s,o,g,R,w,k,C,S,j,f,M,N,h,y,E,D,L,O,$,n,d,m,p,T,A,F,B,V,P,_,z,G,q,H,K,W,U,Z,Y,J,Q,X,ee,se,te,ae,le;const[l,r]=x.useState("items"),c=t.type==="order",a=t.data;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:c?"訂單編號":"退款編號"}),e.jsx("div",{className:"font-mono text-sm mt-1",children:c?a.orderNo:a.refundNo})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"建立時間"}),e.jsx("div",{className:"text-sm mt-1",children:a.createdAt||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1 inline-flex px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-700",children:a.status||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:c?"金額":"退款金額"}),e.jsx("div",{className:`text-sm mt-1 ${c?"font-semibold":"text-red-600 font-semibold"}`,children:c?u((i=a.totals)==null?void 0:i.grandTotal):`- ${u((s=a.amounts)==null?void 0:s.totalRefund)}`})]})]}),e.jsx(de,{mode:"controlled",activeKey:l,onTabChange:b=>r(b.key),layout:"left",tabs:[{key:"items",label:"商品明細"},{key:"shipping",label:"配送細節"},{key:"payment",label:"付款與金額"},{key:"invoice",label:"發票/折讓"}]}),l==="items"&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-gray-500 px-2 mb-1",children:[e.jsx("div",{className:"col-span-6",children:"商品"}),e.jsx("div",{className:"col-span-2 text-right",children:"單價"}),e.jsx("div",{className:"col-span-2 text-right",children:"數量"}),e.jsx("div",{className:"col-span-2 text-right",children:"小計"})]}),e.jsx("div",{className:"space-y-2",children:(a.items||[]).map((b,ce)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center bg-white/60 rounded px-2 py-3",children:[e.jsxs("div",{className:"col-span-6 flex items-center gap-3",children:[b.image&&e.jsx("img",{src:b.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.sku||""})]})]}),e.jsx("div",{className:"col-span-2 text-right",children:u(b.price)}),e.jsxs("div",{className:"col-span-2 text-right",children:["x ",b.qty]}),e.jsx("div",{className:"col-span-2 text-right font-semibold",children:u((b.price||0)*(b.qty||0))})]},ce))})]}),l==="shipping"&&e.jsx("div",{className:"text-sm grid grid-cols-2 gap-4",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"配送方式"}),e.jsx("div",{className:"font-medium",children:((o=a.shipping)==null?void 0:o.method)==="home"?"宅配":"超商取貨"}),((g=a.shipping)==null?void 0:g.method)==="home"?e.jsxs("div",{className:"text-gray-700 mt-2",children:[(w=(R=a.shipping)==null?void 0:R.address)==null?void 0:w.postalCode," ",(C=(k=a.shipping)==null?void 0:k.address)==null?void 0:C.city,(j=(S=a.shipping)==null?void 0:S.address)==null?void 0:j.district,(M=(f=a.shipping)==null?void 0:f.address)==null?void 0:M.streetAddress]}):e.jsxs("div",{className:"text-gray-700 mt-2",children:[(h=(N=a.shipping)==null?void 0:N.store)==null?void 0:h.name,"（",(E=(y=a.shipping)==null?void 0:y.store)==null?void 0:E.id,"）- ",(L=(D=a.shipping)==null?void 0:D.store)==null?void 0:L.address]})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"物流資訊"}),e.jsxs("div",{children:["物流：",((O=a.shipping)==null?void 0:O.carrier)||"—"]}),e.jsxs("div",{children:["追蹤：",(($=a.shipping)==null?void 0:$.trackingNo)||"—"]}),e.jsxs("div",{children:["狀態：",a.status||"—"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"退貨方式"}),e.jsx("div",{className:"font-medium",children:((n=a.shippingReturn)==null?void 0:n.method)==="home"?"宅配":"超商寄件"}),((d=a.shippingReturn)==null?void 0:d.method)==="home"?e.jsx("div",{className:"text-gray-700 mt-2",children:((p=(m=a.shippingReturn)==null?void 0:m.address)==null?void 0:p.postalCode)||""}):e.jsxs("div",{className:"text-gray-700 mt-2",children:[((T=a.shippingReturn)==null?void 0:T.storeName)||"","（",((A=a.shippingReturn)==null?void 0:A.storeId)||"","）"]})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"物流資訊"}),e.jsxs("div",{children:["物流：",((F=a.shippingReturn)==null?void 0:F.carrier)||((B=a.shippingReturn)==null?void 0:B.provider)||"—"]}),e.jsxs("div",{children:["追蹤：",((V=a.shippingReturn)==null?void 0:V.trackingNo)||"—"]}),e.jsxs("div",{children:["狀態：",a.status||"—"]})]})]})}),l==="payment"&&e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:c?"付款方式":"退款方式"}),e.jsxs("div",{children:[((P=a.payment)==null?void 0:P.method)||"—","（",((_=a.payment)==null?void 0:_.status)||"—","）"]})]}),c?e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"小計"}),e.jsx("div",{className:"font-medium mt-1",children:u((z=a.totals)==null?void 0:z.subtotal)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"折扣"}),e.jsx("div",{className:"font-medium mt-1",children:u((G=a.totals)==null?void 0:G.discount)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"運費"}),e.jsx("div",{className:"font-medium mt-1",children:u((q=a.totals)==null?void 0:q.shipping)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"應付金額"}),e.jsx("div",{className:"font-semibold mt-1",children:u((H=a.totals)==null?void 0:H.grandTotal)})]})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退貨商品金額"}),e.jsx("div",{className:"font-medium mt-1",children:u((K=a.amounts)==null?void 0:K.subtotal)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退運費"}),e.jsx("div",{className:"font-medium mt-1",children:u((W=a.amounts)==null?void 0:W.shippingRefund)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退款總額"}),e.jsx("div",{className:"font-semibold text-red-600 mt-1",children:u((U=a.amounts)==null?void 0:U.totalRefund)})]})]})]}),l==="invoice"&&e.jsx("div",{className:"text-sm grid grid-cols-2 gap-3",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"發票類型"}),e.jsx("div",{className:"mt-1",children:((Z=a.invoice)==null?void 0:Z.type)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"發票號碼"}),e.jsx("div",{className:"mt-1",children:((Y=a.invoice)==null?void 0:Y.number)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"載具"}),e.jsx("div",{className:"mt-1",children:((J=a.invoice)==null?void 0:J.carrier)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"抬頭"}),e.jsx("div",{className:"mt-1",children:((Q=a.invoice)==null?void 0:Q.title)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"開立日期"}),e.jsx("div",{className:"mt-1",children:((X=a.invoice)==null?void 0:X.issuedAt)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1",children:((ee=a.invoice)==null?void 0:ee.status)||"—"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"類型"}),e.jsx("div",{className:"mt-1",children:((se=a.invoice)==null?void 0:se.type)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"折讓單號"}),e.jsx("div",{className:"mt-1",children:((te=a.invoice)==null?void 0:te.number)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"開立日期"}),e.jsx("div",{className:"mt-1",children:((ae=a.invoice)==null?void 0:ae.issuedAt)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1",children:((le=a.invoice)==null?void 0:le.status)||"—"})]})]})})]})},Ie=["台北市","新北市","桃園市","台中市","台南市","高雄市"];function Re(t){return{台北市:["中正區","大安區","信義區"],新北市:["板橋區","新店區","新莊區"],桃園市:["桃園區","中壢區","龜山區"]}[t]||[]}const Ee=({newAddress:t,setNewAddress:l,onSave:r,saving:c})=>{const a=x.useMemo(()=>(Ie||[]).map(s=>({value:s,label:s})),[]),i=x.useMemo(()=>t.city?Re(t.city).map(s=>({value:s.name,label:`${s.name}（${s.zip}）`,zip:s.zip})):[],[t.city]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"收件人"}),e.jsx("input",{value:t.contactName||"",onChange:s=>l(o=>({...o,contactName:s.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"王小明"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"電話"}),e.jsx("input",{value:t.phone||"",onChange:s=>l(o=>({...o,phone:s.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"09xx-xxx-xxx"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"縣市"}),e.jsx(I,{options:a,value:t.city||null,onChange:s=>l(o=>({...o,city:s,district:"",postalCode:""})),placeholder:"選擇縣市"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"行政區"}),e.jsx(I,{options:i,value:t.district||null,onChange:(s,o)=>l(g=>({...g,district:s,postalCode:(o==null?void 0:o.zip)||""})),placeholder:"選擇行政區",disabled:!t.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"郵遞區號"}),e.jsx("input",{value:t.postalCode||"",onChange:s=>l(o=>({...o,postalCode:s.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"e.g., 100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"詳細地址"}),e.jsx("input",{value:t.streetAddress||"",onChange:s=>l(o=>({...o,streetAddress:s.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"某某路 123 號 5 樓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.isDefault,onChange:s=>l(o=>({...o,isDefault:s.target.checked}))}),"設為預設地址"]}),e.jsx("button",{onClick:r,disabled:!!c,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:c?"儲存中…":"新增地址"})]})]})},Le=[{value:"711",label:"7-ELEVEN",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-green-600"})},{value:"familymart",label:"全家 FamilyMart",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-emerald-500"})},{value:"hilife",label:"萊爾富 Hi-Life",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-red-500"})},{value:"okmart",label:"OK mart",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-rose-500"})}],Oe=({newAddress:t,setNewAddress:l,onSave:r,saving:c})=>{const a=x.useMemo(()=>Le.map(i=>({value:i.value,label:i.label,icon:i.icon})),[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"取件人"}),e.jsx("input",{value:t.contactName||"",onChange:i=>l(s=>({...s,contactName:i.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"王小明"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"電話"}),e.jsx("input",{value:t.phone||"",onChange:i=>l(s=>({...s,phone:i.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"09xx-xxx-xxx"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"超商"}),e.jsx(I,{options:a,value:t.provider||null,onChange:i=>l(s=>({...s,provider:i})),placeholder:"選擇品牌"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市名稱"}),e.jsx("input",{value:t.storeName||"",onChange:i=>l(s=>({...s,storeName:i.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"如 台北站前門市"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市代號"}),e.jsx("input",{value:t.storeId||"",onChange:i=>l(s=>({...s,storeId:i.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"e.g., 123456"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市地址"}),e.jsx("input",{value:t.storeAddress||"",onChange:i=>l(s=>({...s,storeAddress:i.target.value})),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"完整地址"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.isDefault,onChange:i=>l(s=>({...s,isDefault:i.target.checked}))}),"設為預設門市"]}),e.jsx("button",{onClick:r,disabled:!!c,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:c?"儲存中…":"新增門市"})]})]})},$e=({selectedLevel:t,onChangeLevel:l,selectedStatus:r,onChangeStatus:c,total:a})=>e.jsx("div",{className:"glass rounded-2xl p-6 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-400"}),e.jsx(I,{options:[{value:"全部",label:"全部等級"},{value:"VIP",label:"VIP"},{value:"金卡",label:"金卡"},{value:"銀卡",label:"銀卡"},{value:"一般",label:"一般"}],value:t,onChange:l,placeholder:"選擇會員等級",className:"w-36"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"w-5 h-5 text-gray-400"}),e.jsx(I,{options:[{value:"全部",label:"全部狀態"},{value:"active",label:"活動"},{value:"inactive",label:"休眠"}],value:r,onChange:c,placeholder:"選擇會員狀態",className:"w-28"})]}),e.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["共 ",a," 位會員"]})]})}),Te=({orders:t,onOpen:l})=>!t||t.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無訂單"}):e.jsx("div",{className:"space-y-3",children:t.map(r=>e.jsx("button",{className:"w-full text-left glass rounded-xl p-4 hover:bg-white/60 transition",onClick:()=>l({type:"order",data:r}),children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{className:"font-mono text-sm",children:r.orderNo}),e.jsx("div",{className:"text-sm text-gray-600",children:r.createdAt}),e.jsxs("div",{className:"text-sm font-semibold",children:["NT$ ",r.totals.grandTotal.toLocaleString()]}),e.jsx("div",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-700",children:r.status})]})},r.id))}),Ae=({refunds:t,onOpen:l})=>!t||t.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無退款紀錄"}):e.jsx("div",{className:"space-y-3",children:t.map(r=>e.jsx("button",{className:"w-full text-left glass rounded-xl p-4 hover:bg-white/60 transition",onClick:()=>l({type:"refund",data:r}),children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{className:"font-mono text-sm",children:r.refundNo}),e.jsx("div",{className:"text-sm text-gray-600",children:r.createdAt}),e.jsxs("div",{className:"text-sm font-semibold text-red-600",children:["- NT$ ",r.amounts.totalRefund.toLocaleString()]}),e.jsx("div",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-700",children:r.status})]})},r.id))}),Fe=({addresses:t,memberId:l,refreshAfter:r,dataManager:c})=>{const a=(t||[]).filter(i=>i.type==="home");return a.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無宅配地址"}):e.jsx("div",{className:"space-y-3",children:a.map(i=>e.jsxs("div",{className:"glass rounded-xl p-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-chinese font-semibold",children:[i.contactName,"（",i.phone,"）",i.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded",children:"預設"})]}),e.jsxs("div",{className:"text-gray-600",children:[i.postalCode," ",i.city,i.district,i.streetAddress]})]}),e.jsxs("div",{className:"flex gap-2 mt-0",children:[!i.isDefault&&e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:async()=>{await c.setDefaultShippingAddress(l,i.id),await r()},children:"設為預設"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-red-600 text-white rounded",onClick:async()=>{await c.deleteShippingAddress(l,i.id),await r()},children:"刪除"})]})]},i.id))})},Be=({addresses:t,memberId:l,refreshAfter:r,dataManager:c})=>{const a=(t||[]).filter(i=>i.type==="cvs");return a.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無超商取貨地址"}):e.jsx("div",{className:"space-y-3",children:a.map(i=>e.jsxs("div",{className:"glass rounded-xl p-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-chinese font-semibold",children:[i.provider," 門市",i.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded",children:"預設"})]}),e.jsxs("div",{className:"text-gray-600",children:[i.storeName,"（",i.storeId,"）- ",i.storeAddress]})]}),e.jsxs("div",{className:"flex gap-2 mt-0",children:[!i.isDefault&&e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:async()=>{await c.setDefaultShippingAddress(l,i.id),await r()},children:"設為預設"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-red-600 text-white rounded",onClick:async()=>{await c.deleteShippingAddress(l,i.id),await r()},children:"刪除"})]})]},i.id))})},Ve=[],ss=()=>{const[t,l]=x.useState("全部"),[r,c]=x.useState("全部"),[a,i]=x.useState(!1),[s,o]=x.useState(null),[g,R]=x.useState("profile"),[w,k]=x.useState([]),[C,S]=x.useState([]),[j,f]=x.useState(null),[M,N]=x.useState(Ve),[h,y]=x.useState({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""});x.useEffect(()=>{(async()=>{const{success:d,data:m}=await v.getMembers();d&&N(m)})()},[]),x.useEffect(()=>{(async()=>{if(s!=null&&s.id){const{success:d,data:m}=await ne.getOrdersByMember(s.id);d&&k(m);const p=await ne.getRefundsByMember(s.id);p.success&&S(p.data)}else k([]),S([])})()},[s]);const E=()=>f(null),D=x.useMemo(()=>M.filter(d=>{const m=t==="全部"||d.level===t,p=r==="全部"||d.status===r;return m&&p}),[t,r,M]),L=n=>{const d={VIP:{bg:"bg-purple-100",text:"text-purple-700",icon:"👑"},金卡:{bg:"bg-yellow-100",text:"text-yellow-700",icon:"🥇"},銀卡:{bg:"bg-gray-100",text:"text-gray-700",icon:"🥈"},一般:{bg:"bg-blue-100",text:"text-blue-700",icon:"✅"}},m=d[n]||d.一般;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-bold rounded font-chinese ${m.bg} ${m.text}`,children:[m.icon," ",n]})},O=n=>n==="active"?e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-bold bg-green-100 text-green-700 rounded font-chinese",children:"活動"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-bold bg-red-100 text-red-700 rounded font-chinese",children:"休眠"}),$=[{key:"memberNo",label:"會員編號",sortable:!0,render:n=>e.jsx("span",{className:"font-mono text-sm",children:n})},{key:"name",label:"姓名",sortable:!0,render:n=>e.jsx("span",{className:"font-chinese font-medium",children:n})},{key:"contact",label:"聯絡資料",sortable:!1,render:(n,d)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:d.email}),e.jsx("div",{className:"text-gray-500",children:d.phone})]})},{key:"level",label:"會員等級",sortable:!0,render:n=>L(n)},{key:"totalSpent",label:"消費金額",sortable:!0,render:n=>e.jsxs("span",{className:"font-bold text-green-600",children:["NT$ ",Number(n||0).toLocaleString()]})},{key:"points",label:"積分",sortable:!0,render:n=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-4 h-4 text-amber-500 mr-1"}),n]})},{key:"orders",label:"訂單數",sortable:!0},{key:"status",label:"狀態",sortable:!1,render:n=>O(n)},{key:"tags",label:"標籤",sortable:!1,render:(n=[])=>e.jsx("div",{className:"flex flex-wrap gap-1",children:n.slice(0,2).map((d,m)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded font-chinese",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),d]},m))})},{key:"actions",label:"操作",sortable:!1,render:(n,d)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"查看詳情",onClick:()=>o(d),children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"編輯",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 text-purple-600 hover:bg-purple-100 rounded",title:"溝通紀錄",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1 text-amber-600 hover:bg-amber-100 rounded",title:"積分管理",children:e.jsx(je,{className:"w-4 h-4"})})]})}];return e.jsx("div",{className:"bg-[#fdf8f2] min-h-screen",children:e.jsxs("div",{className:oe.contentContainerFluid,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"w-8 h-8 text-amber-500 mr-3"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese",children:"會員管理系統"})]}),e.jsxs("button",{className:"btn btn-primary flex items-center",onClick:()=>i(!0),children:[e.jsx(ge,{className:"w-5 h-5 mr-2"}),"新增會員"]})]}),e.jsx($e,{selectedLevel:t,onChangeLevel:l,selectedStatus:r,onChangeStatus:c,total:D.length}),e.jsx(xe,{data:D,columns:$,title:"會員清單",emptyMessage:"沒有找到符合條件的會員資料",exportFileName:"會員清單"}),e.jsx(ie,{isOpen:!!s,onClose:()=>{f(null),o(null)},title:"會員詳情",size:"max-w-2xl",children:s&&e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx(de,{mode:"controlled",activeKey:g,onTabChange:n=>R(n.key),layout:"left",tabs:[{key:"profile",label:"基本資料"},{key:"orders",label:`訂單 (${w.length})`},{key:"home",label:"宅配地址"},{key:"cvs",label:"超商取貨地址"},{key:"refunds",label:`退款 (${C.length})`}]}),g==="profile"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"會員編號"}),e.jsx("div",{className:"text-gray-900",children:s.memberNo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"姓名"}),e.jsx("div",{className:"text-gray-900 font-chinese",children:s.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"Email"}),e.jsx("div",{className:"text-gray-900",children:s.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"電話"}),e.jsx("div",{className:"text-gray-900",children:s.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"性別"}),e.jsx("div",{className:"text-gray-900 font-chinese",children:s.gender})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"生日"}),e.jsx("div",{className:"text-gray-900",children:s.birthday})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"註冊日期"}),e.jsx("div",{className:"text-gray-900",children:s.registerDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"最後登入"}),e.jsx("div",{className:"text-gray-900",children:s.lastLoginDate})]})]}),e.jsxs("div",{className:"border-t border-white/30 pt-6",children:[e.jsx("h3",{className:"text-lg font-bold font-chinese mb-4",children:"會員標籤"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(s.tags||[]).map((n,d)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-sm bg-blue-100/80 text-blue-700 rounded-full font-chinese backdrop-blur-sm",children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),n]},d))})]})]}),g==="orders"&&e.jsx(Te,{orders:w,onOpen:f}),g==="refunds"&&e.jsx(Ae,{refunds:C,onOpen:f}),g==="home"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{addresses:s.shippingAddresses,memberId:s.id,dataManager:v,refreshAfter:async()=>{const{data:n}=await v.getMembers();N(n),o(n.find(d=>d.id===s.id))}}),e.jsx("div",{className:"mt-2",children:e.jsx(Ee,{newAddress:h,setNewAddress:y,onSave:async()=>{const n={type:"home",contactName:h.contactName,phone:h.phone,postalCode:h.postalCode,city:h.city,district:h.district,streetAddress:h.streetAddress,isDefault:!!h.isDefault};await v.addShippingAddress(s.id,n);const{data:d}=await v.getMembers();N(d);const m=d.find(p=>p.id===s.id);o(m),y({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""})}})})]}),g==="cvs"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(Be,{addresses:s.shippingAddresses,memberId:s.id,dataManager:v,refreshAfter:async()=>{const{data:n}=await v.getMembers();N(n),o(n.find(d=>d.id===s.id))}}),e.jsx("div",{className:"mt-2",children:e.jsx(Oe,{newAddress:h,setNewAddress:y,onSave:async()=>{const n={type:"cvs",provider:h.provider,storeId:h.storeId,storeName:h.storeName,storeAddress:h.storeAddress,isDefault:!!h.isDefault};await v.addShippingAddress(s.id,n);const{data:d}=await v.getMembers();N(d);const m=d.find(p=>p.id===s.id);o(m),y({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""})}})})]})]})}),j&&e.jsx(ie,{isOpen:!!j,onClose:E,title:j.type==="order"?`訂單詳情：${j.data.orderNo}`:`退款詳情：${j.data.refundNo}`,size:"max-w-4xl",children:e.jsx("div",{className:"p-4",children:e.jsx(De,{detail:j})})})]})})};export{ss as default};
