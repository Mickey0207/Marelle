import{u as f,a as v,r as i,j as e}from"./index-5be64975.js";import{i as j}from"./inboxDataManager-a3acafe0.js";import{S as N}from"./StandardTable-046e436b.js";import{S as g}from"./SearchableSelect-06cd3eb3.js";import{G as w}from"./GlassModal-8d9cbd14.js";import{T as S}from"./TabNavigation-b0ee78ba.js";import{B as k}from"./BellIcon-679cf2a6.js";import{E as C}from"./EyeIcon-db27fda4.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";const T=[{key:"title",label:"標題",render:(s,r)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:r.source})]})},{key:"type",label:"類型",render:s=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700",children:s})},{key:"severity",label:"等級",render:s=>e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${s==="error"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s})},{key:"status",label:"狀態",render:s=>e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${s==="unread"?"bg-amber-100 text-amber-800":"bg-green-100 text-green-800"}`,children:s})},{key:"receivedAt",label:"接收時間",render:s=>new Date(s).toLocaleString()},{key:"actions",label:"操作",sortable:!1,render:(s,r)=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"p-2 text-gray-500 hover:text-[#cc824d]",title:"檢視",onClick:()=>{var o;return(o=r.__onView)==null?void 0:o.call(r,r)},children:e.jsx(C,{className:"w-5 h-5"})})})}],B=()=>{const s=f(),r=v(),o=new URLSearchParams(r.search),[t,u]=i.useState({status:o.get("status")||"all",type:o.get("type")||"all"}),p=j.getAll(),m=i.useMemo(()=>p.filter(a=>!(t.status!=="all"&&(t.status==="error"&&a.severity!=="error"||["unread","read","resolved"].includes(t.status)&&a.status!==t.status)||t.type!=="all"&&a.type!==t.type)),[p,t]),[l,d]=i.useState(null),[x,b]=i.useState("info"),h=i.useMemo(()=>m.map(a=>({...a,__onView:n=>{d(n),b("info")}})),[m]);return i.useEffect(()=>{const a=new URLSearchParams(r.search);t.status&&t.status!=="all"?a.set("status",t.status):a.delete("status"),t.type&&t.type!=="all"?a.set("type",t.type):a.delete("type");const n=a.toString(),y=r.search.startsWith("?")?r.search.slice(1):r.search;n!==y&&s({pathname:r.pathname,search:n?`?${n}`:""},{replace:!0})},[t.status,t.type]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-[#2d1e0f]",children:"通知中心"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"接收來自顧客、金流與系統的所有訊息"})]}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm rounded-lg border border-white/20 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(g,{options:[{value:"all",label:"所有狀態"},{value:"unread",label:"未讀"},{value:"read",label:"已讀"},{value:"resolved",label:"已處理"},{value:"error",label:"錯誤/告警"}],value:t.status,onChange:a=>u(n=>({...n,status:a||"all"})),placeholder:"選擇狀態",allowClear:!1}),e.jsx(g,{options:[{value:"all",label:"所有類型"},{value:"order",label:"訂單"},{value:"payment",label:"金流"},{value:"review",label:"評價"},{value:"system",label:"系統"}],value:t.type,onChange:a=>u(n=>({...n,type:a||"all"})),placeholder:"選擇類型",allowClear:!1})]})}),e.jsx(N,{data:h,columns:T,title:"收件匣",exportFileName:"notification-center",getRowId:a=>a.id,emptyIcon:k})]}),e.jsx(w,{isOpen:!!l,onClose:()=>d(null),title:l?`通知詳情：${l.title}`:"通知詳情",size:"max-w-3xl",contentMaxHeight:"max-h-[calc(85vh-80px)]",children:l&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"border-b",children:e.jsx(S,{tabs:[{key:"info",label:"資訊"},{key:"raw",label:"原始資料"}],mode:"controlled",activeKey:x,onTabChange:a=>b(a.key),layout:"left",className:"px-4"})}),e.jsxs("div",{className:"p-6 pt-0 space-y-6",children:[x==="info"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{label:"標題",children:e.jsxs("span",{className:"font-medium text-gray-900",children:[l.title||"-"," "]})}),e.jsx(c,{label:"來源",children:l.source||"-"}),e.jsx(c,{label:"類型",children:e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700",children:l.type})}),e.jsx(c,{label:"等級",children:e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${l.severity==="error"?"bg-red-100 text-red-800":l.severity==="warning"?"bg-amber-100 text-amber-800":l.severity==="success"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:l.severity})}),e.jsx(c,{label:"狀態",children:e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${l.status==="unread"?"bg-amber-100 text-amber-800":l.status==="resolved"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:l.status})}),e.jsx(c,{label:"接收時間",children:new Date(l.receivedAt).toLocaleString()})]}),x==="raw"&&e.jsx("div",{children:e.jsx("pre",{className:"bg-gray-50 rounded-lg p-4 text-xs overflow-auto",children:e.jsx("code",{children:JSON.stringify(l,null,2)})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700",onClick:()=>d(null),children:"關閉"})})]})]})})]})},c=({label:s,children:r})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 py-1",children:[e.jsx("div",{className:"text-sm text-gray-500 font-chinese col-span-1",children:s}),e.jsx("div",{className:"col-span-2 text-gray-900 text-sm break-words",children:r||"-"})]});export{B as default};
