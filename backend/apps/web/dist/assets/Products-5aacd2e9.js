import{r as y,j as s,A as _,d as z}from"./index-09c3368c.js";import{S as J}from"./StandardTable-d1cd024c.js";import{G as B}from"./GlassModal-a6c5f610.js";import{T as W}from"./TabNavigation-8088ee11.js";import{Q as X}from"./QRCodeGenerator-edf9c63c.js";import{N as d}from"./NestedSKUManager-f82465e3.js";import{I as A}from"./IconActionButton-fd764fa6.js";import{m as u,f as Q}from"./mockProductData-8411f5af.js";import{P as p}from"./PlusIcon-3d2e3b30.js";import{E as ee}from"./EyeIcon-bb65ea7b.js";import{P as se}from"./PencilIcon-619ae986.js";import{T as ae}from"./TrashIcon-41cd83e4.js";import{C as le}from"./Cog6ToothIcon-f8515c56.js";import"./chevron-down-5d12351e.js";import"./XMarkIcon-93d59038.js";import"./QrCodeIcon-0fb2cc7f.js";import"./ArrowDownTrayIcon-2accbe6b.js";import"./CubeIcon-1f7f940f.js";import"./CheckCircleIcon-377c1a08.js";import"./ChevronDownIcon-05511def.js";import"./ChevronRightIcon-4b094a17.js";import"./ExclamationTriangleIcon-8f54841e.js";const g=({label:r,children:t})=>s.jsxs("div",{className:"grid grid-cols-3 gap-4 py-2",children:[s.jsx("div",{className:"text-sm text-gray-500 font-chinese col-span-1",children:r}),s.jsx("div",{className:"col-span-2 text-gray-900 text-sm break-words",children:t||"-"})]}),P=({title:r,children:t})=>s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3 font-chinese",children:r}),s.jsx("div",{className:"bg-white/70 rounded-lg border border-gray-100 p-4",children:t})]}),ie=({images:r=[]})=>!r||r.length===0?s.jsx("div",{className:"text-sm text-gray-500",children:"尚未上傳圖片"}):s.jsx("div",{className:"grid grid-cols-5 gap-3",children:r.slice(0,10).map((t,e)=>s.jsx("img",{src:(t==null?void 0:t.url)||t,alt:`image-${e}`,className:"w-full h-24 object-cover rounded-lg border"},e))}),ne=r=>({active:"上架",draft:"草稿",archived:"封存"})[r]||"草稿",te=r=>({visible:"可見",hidden:"隱藏"})[r]||"可見",Y=r=>{if(!r)return"-";if(Array.isArray(r))return r.map(t=>{if(typeof t=="string")return t;if(t&&typeof t=="object"){const e=t.level||t.title||t.name||"",j=t.option||t.value||t.name||"";return e?`${e}: ${j}`:j||"-"}return String(t)}).join(" / ");if(typeof r=="object"){const t=r.items||r.path||r.values;if(Array.isArray(t))return Y(t)}return String(r)},me=({open:r,onClose:t,product:e})=>{var U,I,T;const[j,D]=y.useState("basic"),[$,C]=y.useState(!1),[N,b]=y.useState(null),K=i=>{b(i),C(!0)},G=y.useMemo(()=>[{key:"basic",label:"基本資訊"},{key:"pricing",label:"定價"},{key:"variants",label:"變體"},{key:"categories",label:"分類"},{key:"media",label:"圖片"},{key:"seo",label:"SEO"}],[]),L=(e==null?void 0:e.image)||((I=(U=e==null?void 0:e.images)==null?void 0:U[0])==null?void 0:I.url)||"/placeholder-image.jpg";return s.jsxs(B,{isOpen:r,onClose:t,title:`快速檢視：${(e==null?void 0:e.name)||""}`,size:"max-w-5xl",children:[s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("img",{src:L,alt:e==null?void 0:e.name,className:"w-16 h-16 rounded-lg object-cover border"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-lg font-bold text-gray-900 font-chinese",children:e==null?void 0:e.name}),s.jsxs("div",{className:"text-xs text-gray-600",children:["SKU: ",s.jsx("span",{className:"font-mono",children:e==null?void 0:e.baseSKU})]})]})]})}),s.jsx("div",{className:"border-t",children:s.jsx(W,{tabs:G,mode:"controlled",activeKey:j,onTabChange:i=>D(i.key||i.label),className:"px-4",layout:"left"})}),s.jsxs("div",{className:"px-6 pb-6",children:[j==="basic"&&s.jsx("div",{children:s.jsxs(P,{title:"基本資訊",children:[s.jsx(g,{label:"產品名稱",children:e==null?void 0:e.name}),s.jsx(g,{label:"Slug",children:e==null?void 0:e.slug}),s.jsx(g,{label:"簡短描述",children:e==null?void 0:e.shortDescription}),s.jsx(g,{label:"描述",children:e==null?void 0:e.description}),s.jsx(g,{label:"標籤",children:((e==null?void 0:e.tags)||[]).join("、")||"-"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 py-2",children:[s.jsx("div",{className:"text-sm text-gray-500 font-chinese",children:"狀態 / 可見性"}),s.jsxs("div",{className:"col-span-2 text-sm text-gray-900",children:[ne(e==null?void 0:e.status)," / ",te(e==null?void 0:e.visibility)]})]})]})}),j==="pricing"&&s.jsx("div",{children:s.jsxs(P,{title:"定價資訊",children:[s.jsx(g,{label:"銷售價格",children:e!=null&&e.price?`NT$${Number(e.price).toLocaleString()}`:"-"}),s.jsx(g,{label:"比較價格",children:e!=null&&e.comparePrice?`NT$${Number(e.comparePrice).toLocaleString()}`:"-"}),s.jsx(g,{label:"成本價格",children:e!=null&&e.costPrice?`NT$${Number(e.costPrice).toLocaleString()}`:"-"}),s.jsx(g,{label:"利潤",children:e!=null&&e.profit?`NT$${Number(e.profit).toLocaleString()}`:"-"}),s.jsx(g,{label:"利潤率",children:e!=null&&e.profitMargin?`${e.profitMargin}%`:"-"})]})}),j==="variants"&&s.jsx("div",{children:s.jsxs(P,{title:"SKU 變體",children:[s.jsx(g,{label:"是否多變體",children:e!=null&&e.hasVariants?"是":"否"}),e!=null&&e.hasVariants?s.jsx("div",{className:"mt-2",children:((e==null?void 0:e.skuVariants)||[]).length===0?s.jsx("div",{className:"text-sm text-gray-500",children:"尚未設定變體"}):s.jsx("div",{className:"space-y-3",children:((e==null?void 0:e.skuVariants)||[]).map((i,q)=>{var v,l,a,m,n,x,h;const w=((v=i==null?void 0:i.config)==null?void 0:v.variantImages)||[],V=((l=w[0])==null?void 0:l.url)||w[0]||((m=(a=e==null?void 0:e.images)==null?void 0:a[0])==null?void 0:m.url)||(e==null?void 0:e.image),k=i.fullSKU||i.sku||`${e==null?void 0:e.baseSKU}${i.suffix||""}`,S=i.finalPrice??i.price??((n=i==null?void 0:i.config)==null?void 0:n.price)??(e==null?void 0:e.price)??null,M=i.finalComparePrice??i.comparePrice??((x=i==null?void 0:i.config)==null?void 0:x.comparePrice)??(e==null?void 0:e.comparePrice)??null,O=i.finalCostPrice??i.costPrice??((h=i==null?void 0:i.config)==null?void 0:h.costPrice)??(e==null?void 0:e.costPrice)??null,o=i.path??i.variantPath;return s.jsx("div",{className:"p-3 border rounded-lg bg-gray-50",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("img",{src:V||"/placeholder-image.jpg",alt:k,className:"w-14 h-14 rounded object-cover border"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-mono text-[#cc824d] truncate",title:k,children:k}),s.jsx("button",{className:"text-xs px-2 py-1 rounded border text-[#cc824d] border-[#cc824d] hover:bg-[#cc824d] hover:text-white transition-colors",onClick:()=>K({sku:k,salePrice:S,comparePrice:M,costPrice:O,variantPath:o,images:w}),children:"生成 QR"})]}),o&&s.jsxs("div",{className:"text-xs text-gray-600 mt-1 truncate",children:["路徑：",Y(o)]}),S!=null&&s.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["價格：NT$",Number(S).toLocaleString()]}),(()=>{var c;const f=i.stock??i.quantity??((c=i==null?void 0:i.config)==null?void 0:c.quantity);return f==null||f===""?null:s.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["庫存：",f]})})()]})]})},q)})})}):s.jsxs("div",{className:"text-sm text-gray-600",children:["單一 SKU：",s.jsx("span",{className:"font-mono",children:e==null?void 0:e.baseSKU})]})]})}),j==="categories"&&s.jsx("div",{children:s.jsx(P,{title:"分類",children:s.jsx(g,{label:"主分類",children:(T=e==null?void 0:e.categories)!=null&&T.length?e.categories.map(i=>(i==null?void 0:i.name)||i).join("、"):(e==null?void 0:e.category)||"未分類"})})}),j==="media"&&s.jsx("div",{children:s.jsx(P,{title:"圖片",children:s.jsx(ie,{images:e==null?void 0:e.images})})}),j==="seo"&&s.jsx("div",{children:s.jsxs(P,{title:"SEO 與分享",children:[s.jsx(g,{label:"Meta 標題",children:e==null?void 0:e.metaTitle}),s.jsx(g,{label:"Meta 描述",children:e==null?void 0:e.metaDescription}),s.jsx(g,{label:"Open Graph 標題",children:(e==null?void 0:e.openGraphTitle)||(e!=null&&e.useMetaTitleForOG?e==null?void 0:e.metaTitle:"")}),s.jsx(g,{label:"Open Graph 描述",children:(e==null?void 0:e.openGraphDescription)||(e!=null&&e.useMetaDescriptionForOG?e==null?void 0:e.metaDescription:"")}),s.jsx(g,{label:"搜尋標題",children:(e==null?void 0:e.searchTitle)||(e!=null&&e.useMetaTitleForSearch?e==null?void 0:e.metaTitle:"")}),s.jsx(g,{label:"搜尋描述",children:(e==null?void 0:e.searchDescription)||(e!=null&&e.useMetaDescriptionForSearch?e==null?void 0:e.metaDescription:"")}),s.jsx(g,{label:"排除於站內搜尋",children:e!=null&&e.excludeFromSearch?"是":"否"}),s.jsx(g,{label:"Sitemap 索引",children:e!=null&&e.sitemapIndexing?"是":"否"}),s.jsx(g,{label:"自訂 Canonical URL",children:(e==null?void 0:e.customCanonicalUrl)||"-"})]})})]}),s.jsx(X,{isOpen:$,onClose:()=>C(!1),title:`QR 預覽 - ${(N==null?void 0:N.sku)||""}`,product:{name:e==null?void 0:e.name,categories:e==null?void 0:e.categories,slug:e==null?void 0:e.slug,price:e==null?void 0:e.price,comparePrice:e==null?void 0:e.comparePrice,costPrice:e==null?void 0:e.costPrice},sku:N})]})},Ve=()=>{var V,k,S,M,O,o,v;const[r,t]=y.useState(u),[e,j]=y.useState(!1),[D,$]=y.useState(null),[C,N]=y.useState(!1),[b,K]=y.useState(null),G=l=>{$(l),j(!0)},L=()=>{j(!1),$(null)},U=(l,a)=>{K({productId:l==null?void 0:l.id,product:l,variant:a}),N(!0)},I=()=>{N(!1),K(null)},T=l=>{b!=null&&b.productId&&t(a=>a.map(m=>{if(m.id!==b.productId)return m;const n=Array.isArray(m.skuVariants)?m.skuVariants.map(x=>{const h=(l||[]).find(f=>f.id===x.id||f.sku===x.sku);return h?{...x,...h,config:{...x.config,...h.config||{}}}:x}):l||[];return{...m,skuVariants:n}}))},i=l=>l?{text:"有庫存",color:"bg-green-100 text-green-800"}:{text:"缺貨",color:"bg-red-100 text-red-800"},q=[{key:"name",label:"商品",sortable:!0,render:(l,a)=>{var n,x;const m=(a==null?void 0:a.image)||((x=(n=a==null?void 0:a.images)==null?void 0:n[0])==null?void 0:x.url)||"/placeholder-image.jpg";return s.jsxs("div",{className:"flex items-center",children:[s.jsx("img",{src:m,alt:(a==null?void 0:a.name)||"產品圖片",className:"w-12 h-12 object-cover rounded-lg mr-4"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 font-chinese",children:(a==null?void 0:a.name)||"未知商品"}),s.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["SKU: ",(a==null?void 0:a.baseSKU)||"N/A"]})]})]})}},{key:"category",label:"類別",sortable:!0,render:(l,a)=>{var n,x;const m=(a==null?void 0:a.category)||((x=(n=a==null?void 0:a.categories)==null?void 0:n[0])==null?void 0:x.name)||"未分類";return s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-apricot-100 text-apricot-800 rounded-full font-chinese",children:m})}},{key:"sku",label:"SKU",sortable:!0,render:(l,a)=>s.jsx("span",{className:"font-mono text-sm text-gray-800",children:(a==null?void 0:a.baseSKU)||"-"})},{key:"price",label:"價格",sortable:!0,render:(l,a)=>s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-900 font-bold",children:a!=null&&a.price?Q(a.price):"N/A"}),(a==null?void 0:a.originalPrice)&&s.jsx("div",{className:"text-sm text-gray-500 line-through",children:Q(a.originalPrice)})]})},{key:"inStock",label:"庫存狀態",sortable:!0,render:(l,a)=>{const m=i(a==null?void 0:a.inStock);return s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${m.color} font-chinese`,children:m.text})}},{key:"slug",label:"Slug",sortable:!0,render:(l,a)=>s.jsx("span",{className:"text-xs text-gray-600",children:(a==null?void 0:a.slug)||"-"})},{key:"status",label:"狀態",sortable:!0,render:(l,a)=>{const m=(a==null?void 0:a.status)||"draft",n={active:{text:"上架",color:"bg-green-100 text-green-800"},draft:{text:"草稿",color:"bg-yellow-100 text-yellow-800"},archived:{text:"封存",color:"bg-gray-100 text-gray-800"}},{text:x,color:h}=n[m]||n.draft;return s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${h}`,children:x})}},{key:"visibility",label:"可見性",sortable:!0,render:(l,a)=>{const m=(a==null?void 0:a.visibility)||"visible",n={visible:{text:"可見",color:"bg-blue-100 text-blue-800"},hidden:{text:"隱藏",color:"bg-gray-100 text-gray-800"}},{text:x,color:h}=n[m]||n.visible;return s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${h}`,children:x})}},{key:"variants",label:"多變體",sortable:!0,render:(l,a)=>s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${a!=null&&a.hasVariants?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:a!=null&&a.hasVariants?"是":"否"})},{key:"rating",label:"評分",sortable:!0,render:(l,a)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-sm text-gray-900",children:(a==null?void 0:a.rating)||0}),s.jsx("span",{className:"text-yellow-400 ml-1",children:"★"}),s.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",(a==null?void 0:a.reviews)||0,")"]})]})},{key:"actions",label:"操作",sortable:!1,render:(l,a)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(A,{Icon:ee,label:"預覽",variant:"blue",onClick:()=>G(a)}),s.jsx(z,{to:`/products/edit/${a==null?void 0:a.baseSKU}`,className:"inline-flex",children:s.jsx(A,{Icon:se,label:"編輯",variant:"amber"})}),s.jsx(A,{Icon:ae,label:"刪除",variant:"red"})]})}],w=[{key:"image",label:"圖片",sortable:!1,render:(l,a,m,n)=>{var E,F,R,H;const x=((E=a==null?void 0:a.config)==null?void 0:E.variantImages)||[],h=((F=x[0])==null?void 0:F.url)||x[0]||null,f=((H=(R=n==null?void 0:n.images)==null?void 0:R[0])==null?void 0:H.url)||(n==null?void 0:n.image)||null,c=h||f||"/placeholder-image.jpg",Z=a!=null&&a.sku?`${a.sku} 縮圖`:n!=null&&n.name?`${n.name} 縮圖`:"SKU 縮圖";return s.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-gray-100 flex items-center justify-center",children:c?s.jsx("img",{src:c,alt:Z,className:"w-full h-full object-cover"}):s.jsx("span",{className:"text-[10px] text-gray-400",children:"無圖"})})}},{key:"sku",label:"SKU",sortable:!0,render:l=>s.jsx("span",{className:"font-mono text-xs text-gray-800",children:l})},{key:"pathDisplay",label:"組合",sortable:!0,render:(l,a)=>s.jsx("div",{className:"text-gray-900 text-sm",children:l||(a==null?void 0:a.name)||"-"})},{key:"price",label:"售價",sortable:!0,render:l=>s.jsx("span",{className:"text-gray-900 font-medium",children:typeof l=="number"?Q(l):"-"})},{key:"comparePrice",label:"參考價",sortable:!0,render:l=>s.jsx("span",{className:"text-gray-500 line-through",children:typeof l=="number"?Q(l):"-"})},{key:"quantity",label:"庫存",sortable:!0,render:(l,a)=>{const m=(a==null?void 0:a.lowStockThreshold)??0,n=typeof l=="number"&&l<=m&&l>0,x=l===0;return s.jsx("span",{className:`text-sm font-medium ${x?"text-red-600":n?"text-yellow-700":"text-gray-900"}`,children:typeof l=="number"?l:"-"})}},{key:"active",label:"狀態",sortable:!0,render:l=>s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${l?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:l?"上架":"停用"})},{key:"actions",label:"操作",sortable:!1,render:(l,a,m,n)=>s.jsx(A,{Icon:le,label:"管理 SKU",variant:"gray",onClick:()=>U(n,a)})}];return s.jsx("div",{className:_.pageContainer,children:s.jsxs("div",{className:_.contentContainerFluid,children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:_.pageTitle,children:"商品管理"}),s.jsx("p",{className:_.pageSubtitle,children:"管理商品資訊、庫存和雜貨"})]}),s.jsx("div",{className:"flex items-center space-x-3",children:s.jsxs(z,{to:"/products/add",className:"inline-flex items-center px-6 py-3 bg-[#cc824d] text-white font-medium rounded-lg hover:bg-[#b86c37] transition-all duration-200 shadow-md hover:shadow-lg font-chinese",children:[s.jsx(p,{className:"w-5 h-5 mr-2"}),"新增商品"]})})]}),s.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm",children:s.jsx(J,{title:"商品清單",columns:q,data:r,exportFileName:"products",emptyMessage:"沒有找到符合條件的商品",enableRowExpansion:!0,getSubRows:l=>((l==null?void 0:l.skuVariants)||[]).map(a=>{var m,n,x,h,f,c;return{...a,price:((m=a==null?void 0:a.config)==null?void 0:m.price)??null,comparePrice:((n=a==null?void 0:a.config)==null?void 0:n.comparePrice)??null,costPrice:((x=a==null?void 0:a.config)==null?void 0:x.costPrice)??null,quantity:((h=a==null?void 0:a.config)==null?void 0:h.quantity)??null,lowStockThreshold:((f=a==null?void 0:a.config)==null?void 0:f.lowStockThreshold)??null,active:((c=a==null?void 0:a.config)==null?void 0:c.isActive)??null}}),subColumns:w,renderSubtableHeader:l=>{var a;return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[(l==null?void 0:l.name)||"商品"," 的 SKU 清單"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["共 ",((a=l==null?void 0:l.skuVariants)==null?void 0:a.length)||0," 項"]})]})},subtableClassName:"bg-white/70 rounded-xl"})}),s.jsx(me,{open:e,onClose:L,product:D}),s.jsx(B,{isOpen:C,onClose:I,title:b?`管理 SKU - ${((V=b==null?void 0:b.variant)==null?void 0:V.sku)||""}`:"",size:"max-w-6xl",maxHeight:"max-h-[95vh]",contentMaxHeight:"max-h-[calc(95vh-80px)]",children:b&&s.jsx("div",{className:"p-6",children:s.jsx(d,{baseSKU:(k=b.product)==null?void 0:k.baseSKU,skuVariants:[b.variant],onChange:T,basePrice:((S=b.product)==null?void 0:S.price)||0,baseComparePrice:((M=b.product)==null?void 0:M.originalPrice)||0,baseCostPrice:((O=b.product)==null?void 0:O.costPrice)||0,productName:((o=b.product)==null?void 0:o.name)||"",productCategories:((v=b.product)==null?void 0:v.categories)||[],singleVariant:!0,variantSelected:b.variant})})})]})})};export{Ve as default};
