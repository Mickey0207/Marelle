import{r as g,j as a,A as B,d as ae}from"./index-5be64975.js";import{S as te}from"./StandardTable-046e436b.js";import{G as Y}from"./GlassModal-8d9cbd14.js";import{T as re}from"./TabNavigation-b0ee78ba.js";import{Q as ce}from"./QRCodeGenerator-e8a67a0e.js";import{N as me}from"./NestedSKUManager-d9e30a19.js";import{I as R}from"./IconActionButton-2bcd0b2a.js";import{P as oe}from"./PlusIcon-86b6a2f5.js";import{E as xe}from"./EyeIcon-db27fda4.js";import{P as ie}from"./PencilIcon-0921d86f.js";import{T as he}from"./TrashIcon-c73d815d.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";import"./QrCodeIcon-befa0648.js";import"./ImageUpload-68adf005.js";import"./CubeIcon-717b6b1f.js";import"./ChevronDownIcon-47739443.js";import"./ChevronRightIcon-bd983f70.js";import"./Cog6ToothIcon-88b00cb1.js";const f=({label:x,children:o})=>a.jsxs("div",{className:"grid grid-cols-3 gap-4 py-2",children:[a.jsx("div",{className:"text-sm text-gray-500 font-chinese col-span-1",children:x}),a.jsx("div",{className:"col-span-2 text-gray-900 text-sm break-words",children:o||"-"})]}),V=({title:x,children:o})=>a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3 font-chinese",children:x}),a.jsx("div",{className:"bg-white/70 rounded-lg border border-gray-100 p-4",children:o})]}),be=({images:x=[]})=>!x||x.length===0?a.jsx("div",{className:"text-sm text-gray-500",children:"尚未上傳圖片"}):a.jsx("div",{className:"grid grid-cols-5 gap-3",children:x.slice(0,10).map((o,e)=>a.jsx("img",{src:(o==null?void 0:o.url)||o,alt:`image-${e}`,className:"w-full h-24 object-cover rounded-lg border"},e))}),ge=x=>({active:"上架",draft:"草稿",archived:"封存"})[x]||"草稿",fe=x=>({visible:"可見",hidden:"隱藏"})[x]||"可見",ne=x=>{if(!x)return"-";if(Array.isArray(x))return x.map(o=>{if(typeof o=="string")return o;if(o&&typeof o=="object"){const e=o.level||o.title||o.name||"",_=o.option||o.value||o.name||"";return e?`${e}: ${_}`:_||"-"}return String(o)}).join(" / ");if(typeof x=="object"){const o=x.items||x.path||x.values;if(Array.isArray(o))return ne(o)}return String(x)},ye=({open:x,onClose:o,product:e})=>{var U,K;const[_,T]=g.useState("basic"),[M,$]=g.useState(!1),[N,H]=g.useState(null),D=l=>{H(l),$(!0)},W=g.useMemo(()=>[{key:"basic",label:"基本資訊"},{key:"variants",label:"變體"},{key:"categories",label:"分類"},{key:"media",label:"圖片"},{key:"seo",label:"SEO"}],[]),w=(e==null?void 0:e.image)||((K=(U=e==null?void 0:e.images)==null?void 0:U[0])==null?void 0:K.url)||"/placeholder-image.jpg";return a.jsxs(Y,{isOpen:x,onClose:o,title:`快速檢視：${(e==null?void 0:e.name)||""}`,size:"max-w-5xl",children:[a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:w,alt:e==null?void 0:e.name,className:"w-16 h-16 rounded-lg object-cover border"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-lg font-bold text-gray-900 font-chinese",children:e==null?void 0:e.name}),a.jsxs("div",{className:"text-xs text-gray-600",children:["SKU: ",a.jsx("span",{className:"font-mono",children:e==null?void 0:e.baseSKU})]})]})]})}),a.jsx("div",{className:"border-t",children:a.jsx(re,{tabs:W,mode:"controlled",activeKey:_,onTabChange:l=>T(l.key||l.label),className:"px-4",layout:"left"})}),a.jsxs("div",{className:"px-6 pb-6",children:[_==="basic"&&a.jsx("div",{children:a.jsxs(V,{title:"基本資訊",children:[a.jsx(f,{label:"產品名稱",children:e==null?void 0:e.name}),a.jsx(f,{label:"Slug",children:e==null?void 0:e.slug}),a.jsx(f,{label:"簡短描述",children:e==null?void 0:e.shortDescription}),a.jsx(f,{label:"描述",children:e==null?void 0:e.description}),a.jsx(f,{label:"標籤",children:((e==null?void 0:e.tags)||[]).join("、")||"-"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 py-2",children:[a.jsx("div",{className:"text-sm text-gray-500 font-chinese",children:"狀態 / 可見性"}),a.jsxs("div",{className:"col-span-2 text-sm text-gray-900",children:[ge(e==null?void 0:e.status)," / ",fe(e==null?void 0:e.visibility)]})]})]})}),_==="variants"&&a.jsx("div",{children:a.jsxs(V,{title:"SKU 變體",children:[a.jsx(f,{label:"是否多變體",children:e!=null&&e.hasVariants?"是":"否"}),e!=null&&e.hasVariants?a.jsx("div",{className:"mt-2",children:((e==null?void 0:e.skuVariants)||[]).length===0?a.jsx("div",{className:"text-sm text-gray-500",children:"尚未設定變體"}):a.jsx("div",{className:"space-y-3",children:((e==null?void 0:e.skuVariants)||[]).map((l,J)=>{var P,E,F,G,Q,L,q;const A=((P=l==null?void 0:l.config)==null?void 0:P.variantImages)||[],S=((E=A[0])==null?void 0:E.url)||A[0]||((G=(F=e==null?void 0:e.images)==null?void 0:F[0])==null?void 0:G.url)||(e==null?void 0:e.image),j=l.fullSKU||l.sku||`${e==null?void 0:e.baseSKU}${l.suffix||""}`,O=l.finalPrice??l.price??((Q=l==null?void 0:l.config)==null?void 0:Q.price)??(e==null?void 0:e.price)??null,y=l.finalComparePrice??l.comparePrice??((L=l==null?void 0:l.config)==null?void 0:L.comparePrice)??(e==null?void 0:e.comparePrice)??null,d=l.finalCostPrice??l.costPrice??((q=l==null?void 0:l.config)==null?void 0:q.costPrice)??(e==null?void 0:e.costPrice)??null,u=l.path??l.variantPath;return a.jsx("div",{className:"p-3 border rounded-lg bg-gray-50",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("img",{src:S||"/placeholder-image.jpg",alt:j,className:"w-14 h-14 rounded object-cover border"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm font-mono text-[#cc824d] truncate",title:j,children:j}),a.jsx("button",{className:"text-xs px-2 py-1 rounded border text-[#cc824d] border-[#cc824d] hover:bg-[#cc824d] hover:text-white transition-colors",onClick:()=>D({sku:j,salePrice:O,comparePrice:y,costPrice:d,variantPath:u,images:A}),children:"生成 QR"})]}),u&&a.jsxs("div",{className:"text-xs text-gray-600 mt-1 truncate",children:["路徑：",ne(u)]}),O!=null&&a.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["價格：NT$",Number(O).toLocaleString()]}),(()=>{var z;const C=l.stock??l.quantity??((z=l==null?void 0:l.config)==null?void 0:z.quantity);return C==null||C===""?null:a.jsxs("div",{className:"text-xs text-gray-700 mt-1",children:["庫存：",C]})})()]})]})},J)})})}):a.jsxs("div",{className:"text-sm text-gray-600",children:["單一 SKU：",a.jsx("span",{className:"font-mono",children:e==null?void 0:e.baseSKU})]})]})}),_==="categories"&&a.jsx("div",{children:a.jsx(V,{title:"分類",children:a.jsx(f,{label:"分類",children:Array.isArray(e==null?void 0:e.categories)&&e.categories.length?e.categories.join("、"):"未分類"})})}),_==="media"&&a.jsx("div",{children:a.jsx(V,{title:"圖片",children:a.jsx(be,{images:e==null?void 0:e.images})})}),_==="seo"&&a.jsx("div",{children:a.jsxs(V,{title:"SEO 與分享",children:[a.jsx(f,{label:"Meta 標題",children:e==null?void 0:e.metaTitle}),a.jsx(f,{label:"Meta 描述",children:e==null?void 0:e.metaDescription}),a.jsx(f,{label:"Open Graph 標題",children:(e==null?void 0:e.openGraphTitle)||(e!=null&&e.useMetaTitleForOG?e==null?void 0:e.metaTitle:"")}),a.jsx(f,{label:"Open Graph 描述",children:(e==null?void 0:e.openGraphDescription)||(e!=null&&e.useMetaDescriptionForOG?e==null?void 0:e.metaDescription:"")}),a.jsx(f,{label:"搜尋標題",children:(e==null?void 0:e.searchTitle)||(e!=null&&e.useMetaTitleForSearch?e==null?void 0:e.metaTitle:"")}),a.jsx(f,{label:"搜尋描述",children:(e==null?void 0:e.searchDescription)||(e!=null&&e.useMetaDescriptionForSearch?e==null?void 0:e.metaDescription:"")}),a.jsx(f,{label:"排除於站內搜尋",children:e!=null&&e.excludeFromSearch?"是":"否"}),a.jsx(f,{label:"Sitemap 索引",children:e!=null&&e.sitemapIndexing?"是":"否"}),a.jsx(f,{label:"自訂 Canonical URL",children:(e==null?void 0:e.customCanonicalUrl)||"-"})]})})]}),a.jsx(ce,{isOpen:M,onClose:()=>$(!1),title:`QR 預覽 - ${(N==null?void 0:N.sku)||""}`,product:{name:e==null?void 0:e.name,categories:e==null?void 0:e.categories,slug:e==null?void 0:e.slug,price:e==null?void 0:e.price,comparePrice:e==null?void 0:e.comparePrice,costPrice:e==null?void 0:e.costPrice},sku:N})]})};function I(x){try{return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD"}).format(Number(x||0))}catch{return`NT$ ${Number(x||0).toLocaleString("zh-TW")}`}}const Ue=()=>{var X,Z,p,ee;const[x,o]=g.useState([]),[e,_]=g.useState(!0),[T,M]=g.useState(null),[$,N]=g.useState({}),[H,D]=g.useState(!1),[W,w]=g.useState(null),[U,K]=g.useState(!1),[l,J]=g.useState(null),[A,S]=g.useState(!1),[j,O]=g.useState(null),[y,d]=g.useState({});g.useEffect(()=>{const s=(n,t=[],r={})=>((n||[]).forEach(m=>{const c=[...t,m.name].filter(Boolean);r[m.id]=c.join(" / "),m.children&&m.children.length&&s(m.children,c,r)}),r);(async()=>{try{const n=await fetch("/backend/categories",{credentials:"include"});if(!n.ok)throw new Error("分類加載失敗");const t=await n.json();N(s(Array.isArray(t)?t:[]))}catch(n){console.warn("載入分類失敗：",n),N({})}})()},[]),g.useEffect(()=>{(async()=>{try{_(!0);const i=await fetch("/backend/products",{credentials:"include"});if(!i.ok)throw new Error("加載商品失敗");const n=await i.json()||[],t=await Promise.all(n.map(async r=>{try{const m=await fetch(`/backend/products/${r.id}`,{credentials:"include"});if(!m.ok)throw new Error("detail failed");const c=await m.json();return{...r,photos:c.photos||null,prices:c.prices||[],inventory:c.inventory||[]}}catch{const[c,h]=await Promise.all([fetch(`/backend/products/${r.id}/prices`,{credentials:"include"}),fetch(`/backend/products/${r.id}/inventory`,{credentials:"include"})]),b=c.ok?await c.json():[],v=h.ok?await h.json():[];return{...r,prices:b||[],inventory:v||[]}}}));o(t),M(null)}catch(i){console.error("加載商品列表失敗:",i),M(i.message),o([])}finally{_(!1)}})()},[]);const u=s=>{if(typeof s=="number")return s;const i=parseInt(s,10);return Number.isNaN(i)?0:i},P=s=>{if(!s)return!1;const i=u(s.current_stock_qty),n=s.low_stock_threshold===null||s.low_stock_threshold===void 0?0:u(s.low_stock_threshold);return i<=n},E=s=>(Array.isArray(s==null?void 0:s.inventory)?s.inventory:[]).some(P)?s!=null&&s.auto_hide_when_oos?{text:"缺貨自動下架中",color:"bg-red-100 text-red-800"}:{text:"已上架，缺貨中",color:"bg-yellow-100 text-yellow-800"}:{text:"正常販售中",color:"bg-green-100 text-green-800"},F=s=>{if(!!!(s!=null&&s.enable_preorder))return{text:"—",color:"bg-gray-100 text-gray-600"};const n=new Date,t=s!=null&&s.preorder_start_at?new Date(s.preorder_start_at):null,r=s!=null&&s.preorder_end_at?new Date(s.preorder_end_at):null;return r&&n>r?{text:"預購結束",color:"bg-gray-100 text-gray-700"}:t&&n<t?{text:"預購待開始",color:"bg-slate-100 text-slate-700"}:{text:"正常預購中",color:"bg-blue-100 text-blue-800"}},G=s=>{if(!s)return null;const i=[];if(s.photos)for(let b=1;b<=10;b++){const v=s.photos[`photo_url_${b}`];v&&i.push({id:`photo_${b}`,url:v,name:`image-${b}.jpg`,size:0,type:"image/jpeg"})}const n=Array.isArray(s.prices)?s.prices:[],r=(Array.isArray(s.inventory)?s.inventory:[]).map(b=>{const v=[];for(let k=1;k<=3;k++){const se=b[`variant_photo_url_${k}`];se&&v.push({url:se})}return{id:b.id,sku:b.sku_key,barcode:b.barcode||"",config:{isActive:!0,variantImages:v}}}),m=n.find(b=>!b.sku_key)||{},c=s.seo||{},h=Array.isArray(s.category_ids)?s.category_ids.map(b=>$[b]).filter(Boolean):[];return{id:s.id,name:s.name||"",slug:s.slug||"",description:s.description||"",shortDescription:s.short_description||"",tags:Array.isArray(s.tags)?s.tags:[],baseSKU:s.base_sku||"",status:s.status||"draft",visibility:s.visibility||"visible",hasVariants:!!s.has_variants,skuVariants:r,images:i,categories:h,price:m.sale_price??"",comparePrice:m.compare_at_price??"",costPrice:m.cost_price??"",profit:"",profitMargin:"",metaTitle:c.meta_title||"",metaDescription:c.meta_description||"",openGraphTitle:c.og_title||"",openGraphDescription:c.og_description||"",openGraphImage:c.og_image_url||"",useMetaTitleForOG:c.use_meta_title_for_og!==!1,useMetaDescriptionForOG:c.use_meta_description_for_og!==!1,searchTitle:c.search_title||"",searchDescription:c.search_description||"",searchImage:c.search_image_url||"",useMetaTitleForSearch:c.use_meta_title_for_search!==!1,useMetaDescriptionForSearch:c.use_meta_description_for_search!==!1,useOpenGraphImageForSearch:c.use_og_image_for_search!==!1,excludeFromSearch:!!c.exclude_from_search,sitemapIndexing:c.sitemap_indexing!==!1,customCanonicalUrl:c.custom_canonical_url||""}},Q=async s=>{try{const i=await fetch(`/backend/products/${s.id}`,{credentials:"include"});if(i.ok){const n=await i.json(),t=G(n);w(t)}else w({id:s.id,name:s.name,slug:s.slug,baseSKU:s.base_sku,status:s.status,visibility:s.visibility,images:[],hasVariants:!!s.has_variants,skuVariants:[]})}catch(i){console.error("載入快速檢視資料失敗:",i),w({id:s.id,name:s.name,slug:s.slug,baseSKU:s.base_sku,status:s.status,visibility:s.visibility,images:[],hasVariants:!!s.has_variants,skuVariants:[]})}finally{D(!0)}},L=()=>{D(!1),w(null)},q=()=>{K(!1),J(null)},C=s=>{l!=null&&l.productId&&o(i=>i.map(n=>{if(n.id!==l.productId)return n;const t=Array.isArray(n.skuVariants)?n.skuVariants.map(r=>{const m=(s||[]).find(c=>c.id===r.id||c.sku===r.sku);return m?{...r,...m,config:{...r.config,...m.config||{}}}:r}):s||[];return{...n,skuVariants:t}}))},z=[{key:"name",label:"商品",sortable:!0,render:(s,i)=>{let n="/placeholder-image.jpg";const t=(i==null?void 0:i.photos)||null;if(t&&typeof t=="object")for(let r=1;r<=10;r++){const m=t[`photo_url_${r}`];if(m){n=m;break}}return a.jsxs("div",{className:"flex items-center",children:[a.jsx("img",{src:n,alt:(i==null?void 0:i.name)||"產品圖片",className:"w-12 h-12 object-cover rounded-lg mr-4"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 font-chinese",children:(i==null?void 0:i.name)||"未知商品"}),a.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["SKU: ",(i==null?void 0:i.base_sku)||"N/A"]})]})]})}},{key:"category",label:"類別",sortable:!0,render:(s,i)=>{const n=Array.isArray(i==null?void 0:i.category_ids)?i.category_ids.map(r=>$[r]).filter(Boolean):[],t=n.length?n.join("、"):"未分類";return a.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-apricot-100 text-apricot-800 rounded-full font-chinese",children:t})}},{key:"price",label:"價格",sortable:!0,render:()=>a.jsx("div",{children:a.jsx("div",{className:"text-gray-500",children:"需在編輯頁設定"})})},{key:"slug",label:"Slug",sortable:!0,render:(s,i)=>a.jsx("span",{className:"text-xs text-gray-600",children:(i==null?void 0:i.slug)||"-"})},{key:"status",label:"狀態",sortable:!0,render:(s,i)=>{const n=(i==null?void 0:i.status)||"draft",t={active:{text:"上架",color:"bg-green-100 text-green-800"},draft:{text:"草稿",color:"bg-yellow-100 text-yellow-800"},archived:{text:"封存",color:"bg-gray-100 text-gray-800"}},{text:r,color:m}=t[n]||t.draft;return a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${m}`,children:r})}},{key:"visibility",label:"可見性",sortable:!0,render:(s,i)=>{const n=(i==null?void 0:i.visibility)||"visible",t={visible:{text:"可見",color:"bg-blue-100 text-blue-800"},hidden:{text:"隱藏",color:"bg-gray-100 text-gray-800"}},{text:r,color:m}=t[n]||t.visible;return a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${m}`,children:r})}},{key:"oos",label:"缺貨狀態",sortable:!1,render:(s,i)=>{const{text:n,color:t}=E(i);return a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t}`,children:n})}},{key:"preorder",label:"預購狀態",sortable:!1,render:(s,i)=>{const{text:n,color:t}=F(i);return a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t}`,children:n})}},{key:"actions",label:"操作",sortable:!1,render:(s,i)=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(R,{Icon:xe,label:"預覽",variant:"blue",onClick:()=>Q(i)}),a.jsx(ae,{to:`/products/edit/${i==null?void 0:i.base_sku}`,className:"inline-flex",children:a.jsx(R,{Icon:ie,label:"編輯",variant:"amber"})}),a.jsx(R,{Icon:he,label:"刪除",variant:"red"})]})}],le=[{key:"photo",label:"圖片",sortable:!1,width:"w-12",render:(s,i)=>{var c,h;const n=((c=i==null?void 0:i.config)==null?void 0:c.variantImages)||[],t=((h=n[0])==null?void 0:h.url)||n[0]||null,r=(i==null?void 0:i.variant_photo_url_1)||(i==null?void 0:i.variant_photo_url_2)||(i==null?void 0:i.variant_photo_url_3)||null,m=t||r||"/placeholder-image.jpg";return a.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-gray-100 flex items-center justify-center",children:m?a.jsx("img",{src:m,alt:(i==null?void 0:i.sku)||"SKU",className:"w-full h-full object-cover"}):a.jsx("span",{className:"text-[10px] text-gray-400",children:"無圖"})})}},{key:"spec",label:"規格",sortable:!1,render:(s,i)=>{const n=[];for(let t=1;t<=5;t++){const r=i[`spec_level_${t}_name`],m=i[`sku_level_${t}_name`];r&&m&&n.push(`${r}: ${m}`)}return a.jsx("div",{className:"text-sm text-gray-900",children:n.length>0?n.join(" / "):(i==null?void 0:i.pathDisplay)||"標準規格"})}},{key:"sale_price",label:"售價",sortable:!0,render:s=>a.jsx("span",{className:"text-gray-900 font-medium",children:typeof s=="number"?I(s):"-"})},{key:"compare_at_price",label:"原價",sortable:!0,render:s=>a.jsx("span",{className:"text-gray-500 line-through",children:typeof s=="number"?I(s):"-"})},{key:"gold_member_price",label:"金卡價",sortable:!0,render:s=>a.jsx("span",{className:"text-amber-700 font-medium",children:typeof s=="number"?I(s):"-"})},{key:"silver_member_price",label:"銀卡價",sortable:!0,render:s=>a.jsx("span",{className:"text-slate-500 font-medium",children:typeof s=="number"?I(s):"-"})},{key:"vip_member_price",label:"VIP價",sortable:!0,render:s=>a.jsx("span",{className:"text-purple-700 font-medium",children:typeof s=="number"?I(s):"-"})},{key:"cost_price",label:"成本",sortable:!0,render:s=>a.jsx("span",{className:"text-gray-600 text-sm",children:typeof s=="number"?I(s):"-"})},{key:"actions",label:"操作",sortable:!1,width:"w-24",render:(s,i,n,t)=>a.jsx(R,{Icon:ie,label:"編輯",variant:"amber",onClick:()=>{O({...i,product:t}),d({sale_price:i.sale_price,compare_at_price:i.compare_at_price,gold_member_price:i.gold_member_price,silver_member_price:i.silver_member_price,vip_member_price:i.vip_member_price,cost_price:i.cost_price}),S(!0)}})}];return a.jsx("div",{className:B.pageContainer,children:a.jsxs("div",{className:B.contentContainerFluid,children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:B.pageTitle,children:"商品管理"}),a.jsx("p",{className:B.pageSubtitle,children:"管理商品資訊、庫存和雜貨"})]}),a.jsx("div",{className:"flex items-center space-x-3",children:a.jsxs(ae,{to:"/products/add",className:"inline-flex items-center px-6 py-3 bg-[#cc824d] text-white font-medium rounded-lg hover:bg-[#b86c37] transition-all duration-200 shadow-md hover:shadow-lg font-chinese",children:[a.jsx(oe,{className:"w-5 h-5 mr-2"})," 新增商品"]})})]}),T&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:a.jsxs("p",{className:"text-red-800 font-chinese",children:["⚠️ ",T]})}),e&&a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm p-8 text-center",children:a.jsx("p",{className:"text-gray-600 font-chinese",children:"正在加載商品..."})}),!e&&a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-sm",children:a.jsx(te,{title:"商品清單",columns:z,data:x,exportFileName:"products",emptyMessage:"沒有找到符合條件的商品",enableRowExpansion:!0,getSubRows:s=>s!=null&&s.inventory&&s.inventory.length>0?(s.auto_hide_when_oos?s.inventory.filter(n=>!P(n)):s.inventory).map(n=>{var r;const t=((r=s.prices)==null?void 0:r.find(m=>m.sku_key===n.sku_key))||{};return{id:t.id||n.id,sku_key:n.sku_key,spec:n.barcode?`條碼: ${n.barcode}`:"標準規格",...n,...t,pathDisplay:[n.sku_level_1_name,n.sku_level_2_name,n.sku_level_3_name,n.sku_level_4_name,n.sku_level_5_name].filter(Boolean).join(" / ")||"標準"}}):s!=null&&s.prices&&s.prices.length>0?s.prices.map(i=>({id:i.id,sku_key:i.sku_key,spec:i.sku_key?`SKU: ${i.sku_key}`:"標準規格",...i})):[],subColumns:le,renderSubtableHeader:s=>{var m,c;const i=((m=s==null?void 0:s.inventory)==null?void 0:m.length)||0,n=s!=null&&s.auto_hide_when_oos?((s==null?void 0:s.inventory)||[]).filter(h=>P(h)).length:0,r=(s!=null&&s.auto_hide_when_oos?Math.max(0,i-n):i)||0||((c=s==null?void 0:s.prices)==null?void 0:c.length)||0;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[(s==null?void 0:s.name)||"商品"," 的 SKU 變體定價"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[(s==null?void 0:s.auto_hide_when_oos)&&a.jsxs("span",{className:"text-xs text-red-600",children:["缺貨自動下架：隱藏 ",n," / ",i]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["共 ",r," 項變體"]})]})]})},subtableClassName:"bg-white/70 rounded-xl"})}),a.jsx(ye,{open:H,onClose:L,product:W}),a.jsx(Y,{isOpen:A,onClose:()=>S(!1),title:"編輯價格",size:"max-w-md",contentClass:"pt-0",actions:[{label:"取消",variant:"secondary",onClick:()=>S(!1)},{label:"保存",onClick:async()=>{var s;try{const i=(s=j==null?void 0:j.product)==null?void 0:s.id;if(!i)return;const n=c=>c===""||c===void 0||c===null?null:Number(c),t={sale_price:n(y.sale_price),compare_at_price:n(y.compare_at_price),gold_member_price:n(y.gold_member_price),silver_member_price:n(y.silver_member_price),vip_member_price:n(y.vip_member_price),cost_price:n(y.cost_price)},r=await fetch(`/backend/products/${i}/prices/${j.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!r.ok)throw new Error("更新失敗");const m=await r.json();o(c=>c.map(h=>{if(h.id!==i)return h;const v=(Array.isArray(h.prices)?h.prices.some(k=>k.id===m.id):!1)?h.prices.map(k=>k.id===m.id?m:k):[...h.prices||[],m];return{...h,prices:v}})),S(!1)}catch(i){console.error("保存價格失敗:",i)}}}],children:a.jsxs("div",{className:"space-y-6 p-6",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"售價"}),a.jsx("input",{type:"number",value:y.sale_price??"",onChange:s=>d(i=>({...i,sale_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-apricot-500 focus:border-transparent transition-all",step:"0.01",placeholder:"1500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"原價"}),a.jsx("input",{type:"number",value:y.compare_at_price??"",onChange:s=>d(i=>({...i,compare_at_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-apricot-500 focus:border-transparent transition-all",step:"0.01",placeholder:"1000"})]})]}),a.jsx("div",{className:"grid grid-cols-2 gap-6",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"成本"}),a.jsx("input",{type:"number",value:y.cost_price??"",onChange:s=>d(i=>({...i,cost_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-apricot-500 focus:border-transparent transition-all",step:"0.01",placeholder:"200"})]})}),a.jsxs("div",{className:"bg-gradient-to-br from-cream-50 to-apricot-50 rounded-xl p-6 border border-apricot-100",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-800 mb-4 font-chinese",children:"會員價"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"金卡會員價"}),a.jsx("input",{type:"number",value:y.gold_member_price??"",onChange:s=>d(i=>({...i,gold_member_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base bg-white focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all",step:"0.01",placeholder:"1400"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"銀卡會員價"}),a.jsx("input",{type:"number",value:y.silver_member_price??"",onChange:s=>d(i=>({...i,silver_member_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base bg-white focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all",step:"0.01",placeholder:"1300"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"VIP 會員價"}),a.jsx("input",{type:"number",value:y.vip_member_price??"",onChange:s=>d(i=>({...i,vip_member_price:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-base bg-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",step:"0.01",placeholder:"1222"})]})]})]})]})}),a.jsx(Y,{isOpen:U,onClose:q,title:l?`管理 SKU - ${((X=l==null?void 0:l.variant)==null?void 0:X.sku)||""}`:"",size:"max-w-6xl",maxHeight:"max-h-[95vh]",contentMaxHeight:"max-h-[calc(95vh-80px)]",children:l&&a.jsx("div",{className:"p-6",children:a.jsx(me,{baseSKU:(Z=l.product)==null?void 0:Z.baseSKU,skuVariants:[l.variant],onChange:C,productName:((p=l.product)==null?void 0:p.name)||"",productCategories:((ee=l.product)==null?void 0:ee.categories)||[],singleVariant:!0,variantSelected:l.variant})})})]})})};export{Ue as default};
