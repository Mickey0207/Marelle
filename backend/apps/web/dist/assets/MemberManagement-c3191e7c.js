import{r as x,j as e,A as j,u as Ye}from"./index-5be64975.js";import{G as ze}from"./GlassModal-8d9cbd14.js";import{T as He}from"./TabNavigation-b0ee78ba.js";import{S as We}from"./StandardTable-046e436b.js";import{m as k}from"./membersDataManager-4a5623cf.js";import{S as L}from"./SearchableSelect-06cd3eb3.js";import{S as Ze}from"./StarIcon-cc45df6b.js";import{F as Je}from"./FunnelIcon-3b9657d7.js";import{I as P}from"./IconActionButton-2bcd0b2a.js";import{U as Qe}from"./UsersIcon-99672bc6.js";import{P as Xe}from"./PlusIcon-86b6a2f5.js";import{T as Ke}from"./TagIcon-a7572c43.js";import{G as es}from"./GiftIcon-bda10844.js";import{E as ss}from"./EyeIcon-db27fda4.js";import{P as ts}from"./PencilIcon-0921d86f.js";import{C as as}from"./CreditCardIcon-444fefd6.js";import"./XMarkIcon-404a829f.js";import"./chevron-down-e41c1b61.js";function ls({title:t,titleId:i,...l},r){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":i},l),t?x.createElement("title",{id:i},t):null,x.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"}))}const is=x.forwardRef(ls),ns=is,_=t=>String(t).padStart(2,"0"),g=(t,i)=>Math.floor(Math.random()*(i-t+1))+t,Ue=t=>Math.max(0,t),p=t=>t[Math.floor(Math.random()*t.length)];function rs(t){const i=g(100,3e3),l=g(1,3);return{sku:`SKU-${1e3+t}`,name:p(["經典帆布包","保溫杯","無線滑鼠","藍牙耳機","運動毛巾","筆記本"]),image:`https://picsum.photos/seed/${1e3+t}/80/80`,price:i,qty:l}}function cs(t){const i=g(2,7);return Array.from({length:i}).map((l,r)=>{const s=`${t}-ORD-${r+1}`,a=new Date(Date.now()-r*864e5),c=`${a.getFullYear()}-${_(a.getMonth()+1)}-${_(a.getDate())}`,n=g(1,4),m=Array.from({length:n}).map((C,b)=>rs(r*10+b)),v=m.reduce((C,b)=>C+b.price*b.qty,0),$=g(0,Math.floor(v*.2)),w=p([0,60,90,120]),R=Ue(v-$+w);return{id:s,orderNo:`O${Date.now().toString().slice(-6)}-${r+1}`,createdAt:c,status:p(["pending","processing","shipped","delivered","cancelled"]),items:m,totals:{subtotal:v,discount:$,shipping:w,grandTotal:R},payment:{method:p(["信用卡","Line Pay","貨到付款"]),status:p(["paid","unpaid","refunding"])},shipping:p([{method:"home",carrier:p(["黑貓","新竹物流","郵局"]),trackingNo:`TRK${g(1e5,999999)}`,address:{postalCode:"100",city:"台北市",district:"中正區",streetAddress:"重慶南路一段 122 號"}},{method:"cvs",carrier:"超商配",trackingNo:`CVS${g(1e5,999999)}`,store:{id:String(g(1e5,999999)),name:"站前門市",address:"台北市中正區忠孝西路一段 47 號"}}]),invoice:{type:p(["雲端發票","紙本"]),number:`AB${g(10,99)}-${g(1e7,99999999)}`,carrier:"/ABCD1234",title:p(["個人","美樂有限公司"]),issuedAt:c,status:p(["issued","void"])}}})}function ds(t){const i=g(0,3);return Array.from({length:i}).map((l,r)=>{const s=`${t}-RF-${r+1}`,a=new Date(Date.now()-r*1728e5),c=`${a.getFullYear()}-${_(a.getMonth()+1)}-${_(a.getDate())}`,n=g(200,2500),m=p([0,60,90]),v=Ue(n+m);return{id:s,refundNo:`R${Date.now().toString().slice(-6)}-${r+1}`,createdAt:c,status:p(["requested","approved","rejected","refunded"]),amounts:{subtotal:n,shippingRefund:m,totalRefund:v},payment:{method:p(["信用卡","Line Pay","ATM"]),status:p(["processing","refunded","failed"])},shippingReturn:p([{method:"home",carrier:p(["黑貓","新竹物流"]),trackingNo:`RTRK${g(1e5,999999)}`,address:{postalCode:"100"}},{method:"cvs",provider:"超商退貨",trackingNo:`RCVS${g(1e5,999999)}`,storeId:String(g(1e5,999999)),storeName:"站前門市"}]),invoice:{type:"折讓",number:`CR${g(1e3,9999)}-${g(1e5,999999)}`,issuedAt:c,status:p(["issued","void"])}}})}const Ge={async getOrdersByMember(t){return await new Promise(i=>setTimeout(i,60)),{success:!0,data:cs(t)}},async getRefundsByMember(t){return await new Promise(i=>setTimeout(i,60)),{success:!0,data:ds(t)}}},y=t=>`NT$ ${Number(t||0).toLocaleString()}`,os=({detail:t})=>{var c,n,m,v,$,w,R,I,C,b,M,A,S,h,D,E,T,O,B,F,d,o,u,N,V,q,z,K,G,H,U,Y,W,Z,J,Q,X,ee,se,te,ae,le,ie,ne,re,ce,de,oe,xe,me,he,pe,ge,ue,ve,je,be,Ne,ye,fe,ke,we,Ce,Se,$e,Re,Me,De,Ie,Ae,Te,Le,Ee,Oe,Be,Fe,Ve,Pe,_e;const[i,l]=x.useState("items"),r=t.type==="order",s=t.data,a=f=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",requested:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",refunded:"bg-green-100 text-green-800"})[String(f||"").toLowerCase()]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"space-y-5",children:[e.jsx(He,{mode:"controlled",activeKey:i,onTabChange:f=>l(f.key),layout:"left",tabs:[{key:"overview",label:"總覽"},{key:"items",label:"商品明細"},{key:"shipping",label:"配送細節"},{key:"payment",label:"付款與金額"},{key:"invoice",label:"發票/折讓"}]}),i==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/80 rounded-xl border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[72px]",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500 font-chinese",children:r?"訂單編號":"退款編號"}),e.jsx("div",{className:"font-mono text-sm mt-1 text-gray-900",children:r?s.orderNo||"—":s.refundNo||"—"})]}),e.jsxs("div",{className:"bg-white/80 rounded-xl border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[72px]",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500 font-chinese",children:"建立時間"}),e.jsx("div",{className:"text-sm mt-1 text-gray-900",children:s.createdAt||"—"})]}),e.jsxs("div",{className:"bg-white/80 rounded-xl border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[72px]",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500 font-chinese",children:"狀態"}),e.jsx("div",{className:`mt-1 inline-flex items-center px-2 py-0.5 text-xs rounded-full font-chinese ${a(s.status)}`,children:s.status||"—"})]}),e.jsxs("div",{className:"bg-white/80 rounded-xl border border-gray-200 shadow-sm p-4 flex flex-col justify-between min-h-[72px]",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500 font-chinese",children:r?"金額":"退款金額"}),e.jsx("div",{className:`text-sm mt-1 font-semibold ${r?"text-gray-900":"text-red-600"}`,children:r?y((c=s.totals)==null?void 0:c.grandTotal):`- ${y((n=s.amounts)==null?void 0:n.totalRefund)}`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2 font-chinese",children:[r?"配送":"退貨","資訊"]}),r?e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:["方式：",((m=s.shipping)==null?void 0:m.method)==="home"?"宅配":"超商取貨"]}),((v=s.shipping)==null?void 0:v.method)==="home"?e.jsxs("div",{children:["地址：",(w=($=s.shipping)==null?void 0:$.address)==null?void 0:w.postalCode," ",(I=(R=s.shipping)==null?void 0:R.address)==null?void 0:I.city,(b=(C=s.shipping)==null?void 0:C.address)==null?void 0:b.district,(A=(M=s.shipping)==null?void 0:M.address)==null?void 0:A.streetAddress]}):e.jsxs("div",{children:["門市：",(h=(S=s.shipping)==null?void 0:S.store)==null?void 0:h.name,"（",(E=(D=s.shipping)==null?void 0:D.store)==null?void 0:E.id,"）- ",(O=(T=s.shipping)==null?void 0:T.store)==null?void 0:O.address]}),e.jsxs("div",{children:["物流：",((B=s.shipping)==null?void 0:B.carrier)||"—","　追蹤：",((F=s.shipping)==null?void 0:F.trackingNo)||"—"]})]}):e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:["方式：",((d=s.shippingReturn)==null?void 0:d.method)==="home"?"宅配":"超商寄件"]}),((o=s.shippingReturn)==null?void 0:o.method)==="home"?e.jsxs("div",{children:["地址：",((N=(u=s.shippingReturn)==null?void 0:u.address)==null?void 0:N.postalCode)||"—"]}):e.jsxs("div",{children:["門市：",((V=s.shippingReturn)==null?void 0:V.storeName)||"—","（",((q=s.shippingReturn)==null?void 0:q.storeId)||"—","）"]}),e.jsxs("div",{children:["物流：",((z=s.shippingReturn)==null?void 0:z.carrier)||((K=s.shippingReturn)==null?void 0:K.provider)||"—","　追蹤：",((G=s.shippingReturn)==null?void 0:G.trackingNo)||"—"]})]})]}),e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2 font-chinese",children:[r?"付款":"退款","資訊"]}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:["方式：",((H=s.payment)==null?void 0:H.method)||"—"]}),e.jsxs("div",{children:["狀態：",((U=s.payment)==null?void 0:U.status)||"—"]}),r?e.jsxs("div",{children:["應付：",y((Y=s.totals)==null?void 0:Y.grandTotal)]}):e.jsxs("div",{children:["退款：",y((W=s.amounts)==null?void 0:W.totalRefund)]})]})]})]})]}),i==="items"&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-gray-500 px-2 mb-1",children:[e.jsx("div",{className:"col-span-6",children:"商品"}),e.jsx("div",{className:"col-span-2 text-right",children:"單價"}),e.jsx("div",{className:"col-span-2 text-right",children:"數量"}),e.jsx("div",{className:"col-span-2 text-right",children:"小計"})]}),e.jsx("div",{className:"space-y-2",children:(s.items||[]).map((f,qe)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center bg-white/60 rounded px-2 py-3",children:[e.jsxs("div",{className:"col-span-6 flex items-center gap-3",children:[f.image&&e.jsx("img",{src:f.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:f.name}),e.jsx("div",{className:"text-xs text-gray-500",children:f.sku||""})]})]}),e.jsx("div",{className:"col-span-2 text-right",children:y(f.price)}),e.jsxs("div",{className:"col-span-2 text-right",children:["x ",f.qty]}),e.jsx("div",{className:"col-span-2 text-right font-semibold",children:y((f.price||0)*(f.qty||0))})]},qe))})]}),i==="shipping"&&e.jsx("div",{className:"text-sm grid grid-cols-2 gap-4",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"配送方式"}),e.jsx("div",{className:"font-medium",children:((Z=s.shipping)==null?void 0:Z.method)==="home"?"宅配":"超商取貨"}),((J=s.shipping)==null?void 0:J.method)==="home"?e.jsxs("div",{className:"text-gray-700 mt-2",children:[(X=(Q=s.shipping)==null?void 0:Q.address)==null?void 0:X.postalCode," ",(se=(ee=s.shipping)==null?void 0:ee.address)==null?void 0:se.city,(ae=(te=s.shipping)==null?void 0:te.address)==null?void 0:ae.district,(ie=(le=s.shipping)==null?void 0:le.address)==null?void 0:ie.streetAddress]}):e.jsxs("div",{className:"text-gray-700 mt-2",children:[(re=(ne=s.shipping)==null?void 0:ne.store)==null?void 0:re.name,"（",(de=(ce=s.shipping)==null?void 0:ce.store)==null?void 0:de.id,"）- ",(xe=(oe=s.shipping)==null?void 0:oe.store)==null?void 0:xe.address]})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"物流資訊"}),e.jsxs("div",{children:["物流：",((me=s.shipping)==null?void 0:me.carrier)||"—"]}),e.jsxs("div",{children:["追蹤：",((he=s.shipping)==null?void 0:he.trackingNo)||"—"]}),e.jsxs("div",{children:["狀態：",s.status||"—"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"退貨方式"}),e.jsx("div",{className:"font-medium",children:((pe=s.shippingReturn)==null?void 0:pe.method)==="home"?"宅配":"超商寄件"}),((ge=s.shippingReturn)==null?void 0:ge.method)==="home"?e.jsx("div",{className:"text-gray-700 mt-2",children:((ve=(ue=s.shippingReturn)==null?void 0:ue.address)==null?void 0:ve.postalCode)||""}):e.jsxs("div",{className:"text-gray-700 mt-2",children:[((je=s.shippingReturn)==null?void 0:je.storeName)||"","（",((be=s.shippingReturn)==null?void 0:be.storeId)||"","）"]})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"物流資訊"}),e.jsxs("div",{children:["物流：",((Ne=s.shippingReturn)==null?void 0:Ne.carrier)||((ye=s.shippingReturn)==null?void 0:ye.provider)||"—"]}),e.jsxs("div",{children:["追蹤：",((fe=s.shippingReturn)==null?void 0:fe.trackingNo)||"—"]}),e.jsxs("div",{children:["狀態：",s.status||"—"]})]})]})}),i==="payment"&&e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:r?"付款方式":"退款方式"}),e.jsxs("div",{children:[((ke=s.payment)==null?void 0:ke.method)||"—","（",((we=s.payment)==null?void 0:we.status)||"—","）"]})]}),r?e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"小計"}),e.jsx("div",{className:"font-medium mt-1",children:y((Ce=s.totals)==null?void 0:Ce.subtotal)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"折扣"}),e.jsx("div",{className:"font-medium mt-1",children:y((Se=s.totals)==null?void 0:Se.discount)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"運費"}),e.jsx("div",{className:"font-medium mt-1",children:y(($e=s.totals)==null?void 0:$e.shipping)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"應付金額"}),e.jsx("div",{className:"font-semibold mt-1",children:y((Re=s.totals)==null?void 0:Re.grandTotal)})]})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退貨商品金額"}),e.jsx("div",{className:"font-medium mt-1",children:y((Me=s.amounts)==null?void 0:Me.subtotal)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退運費"}),e.jsx("div",{className:"font-medium mt-1",children:y((De=s.amounts)==null?void 0:De.shippingRefund)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"退款總額"}),e.jsx("div",{className:"font-semibold text-red-600 mt-1",children:y((Ie=s.amounts)==null?void 0:Ie.totalRefund)})]})]})]}),i==="invoice"&&e.jsx("div",{className:"text-sm grid grid-cols-2 gap-3",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"發票類型"}),e.jsx("div",{className:"mt-1",children:((Ae=s.invoice)==null?void 0:Ae.type)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"發票號碼"}),e.jsx("div",{className:"mt-1",children:((Te=s.invoice)==null?void 0:Te.number)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"載具"}),e.jsx("div",{className:"mt-1",children:((Le=s.invoice)==null?void 0:Le.carrier)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"抬頭"}),e.jsx("div",{className:"mt-1",children:((Ee=s.invoice)==null?void 0:Ee.title)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"開立日期"}),e.jsx("div",{className:"mt-1",children:((Oe=s.invoice)==null?void 0:Oe.issuedAt)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1",children:((Be=s.invoice)==null?void 0:Be.status)||"—"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"類型"}),e.jsx("div",{className:"mt-1",children:((Fe=s.invoice)==null?void 0:Fe.type)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"折讓單號"}),e.jsx("div",{className:"mt-1",children:((Ve=s.invoice)==null?void 0:Ve.number)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"開立日期"}),e.jsx("div",{className:"mt-1",children:((Pe=s.invoice)==null?void 0:Pe.issuedAt)||"—"})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1",children:((_e=s.invoice)==null?void 0:_e.status)||"—"})]})]})})]})},xs=["台北市","新北市","桃園市","台中市","台南市","高雄市"];function ms(t){return{台北市:["中正區","大安區","信義區"],新北市:["板橋區","新店區","新莊區"],桃園市:["桃園區","中壢區","龜山區"]}[t]||[]}const hs=({newAddress:t,setNewAddress:i,onSave:l,saving:r})=>{const s=x.useMemo(()=>(xs||[]).map(c=>({value:c,label:c})),[]),a=x.useMemo(()=>t.city?ms(t.city).map(c=>({value:c.name,label:`${c.name}（${c.zip}）`,zip:c.zip})):[],[t.city]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"收件人"}),e.jsx("input",{value:t.contactName||"",onChange:c=>i(n=>({...n,contactName:c.target.value})),className:j.input,placeholder:"王小明"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"電話"}),e.jsx("input",{value:t.phone||"",onChange:c=>i(n=>({...n,phone:c.target.value})),className:j.input,placeholder:"09xx-xxx-xxx"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"縣市"}),e.jsx(L,{options:s,value:t.city||null,onChange:c=>i(n=>({...n,city:c,district:"",postalCode:""})),placeholder:"選擇縣市"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"行政區"}),e.jsx(L,{options:a,value:t.district||null,onChange:(c,n)=>i(m=>({...m,district:c,postalCode:(n==null?void 0:n.zip)||""})),placeholder:"選擇行政區",disabled:!t.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"郵遞區號"}),e.jsx("input",{value:t.postalCode||"",onChange:c=>i(n=>({...n,postalCode:c.target.value})),className:j.input,placeholder:"e.g., 100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"詳細地址"}),e.jsx("input",{value:t.streetAddress||"",onChange:c=>i(n=>({...n,streetAddress:c.target.value})),className:j.input,placeholder:"某某路 123 號 5 樓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.isDefault,onChange:c=>i(n=>({...n,isDefault:c.target.checked}))}),"設為預設地址"]}),e.jsx("button",{onClick:l,disabled:!!r,className:`${j.primaryButton} py-1.5 text-sm`,children:r?"儲存中…":"新增地址"})]})]})},ps=[{value:"711",label:"7-ELEVEN",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-green-600"})},{value:"familymart",label:"全家 FamilyMart",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-emerald-500"})},{value:"hilife",label:"萊爾富 Hi-Life",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-red-500"})},{value:"okmart",label:"OK mart",icon:()=>e.jsx("span",{className:"inline-block w-4 h-4 rounded-sm bg-rose-500"})}],gs=({newAddress:t,setNewAddress:i,onSave:l,saving:r})=>{const s=x.useMemo(()=>ps.map(a=>({value:a.value,label:a.label,icon:a.icon})),[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"取件人"}),e.jsx("input",{value:t.contactName||"",onChange:a=>i(c=>({...c,contactName:a.target.value})),className:j.input,placeholder:"王小明"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"電話"}),e.jsx("input",{value:t.phone||"",onChange:a=>i(c=>({...c,phone:a.target.value})),className:j.input,placeholder:"09xx-xxx-xxx"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"超商"}),e.jsx(L,{options:s,value:t.provider||null,onChange:a=>i(c=>({...c,provider:a})),placeholder:"選擇品牌"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市名稱"}),e.jsx("input",{value:t.storeName||"",onChange:a=>i(c=>({...c,storeName:a.target.value})),className:j.input,placeholder:"如 台北站前門市"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市代號"}),e.jsx("input",{value:t.storeId||"",onChange:a=>i(c=>({...c,storeId:a.target.value})),className:j.input,placeholder:"e.g., 123456"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"門市地址"}),e.jsx("input",{value:t.storeAddress||"",onChange:a=>i(c=>({...c,storeAddress:a.target.value})),className:j.input,placeholder:"完整地址"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.isDefault,onChange:a=>i(c=>({...c,isDefault:a.target.checked}))}),"設為預設門市"]}),e.jsx("button",{onClick:l,disabled:!!r,className:`${j.primaryButton} py-1.5 text-sm`,children:r?"儲存中…":"新增門市"})]})]})},us=({selectedLevel:t,onChangeLevel:i,selectedStatus:l,onChangeStatus:r,total:s})=>e.jsx("div",{className:"glass rounded-2xl p-6 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-gray-400"}),e.jsx(L,{options:[{value:"全部",label:"全部等級"},{value:"VIP",label:"VIP"},{value:"金卡",label:"金卡"},{value:"銀卡",label:"銀卡"},{value:"一般",label:"一般"}],value:t,onChange:i,placeholder:"選擇會員等級",className:"w-36"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Je,{className:"w-5 h-5 text-gray-400"}),e.jsx(L,{options:[{value:"全部",label:"全部狀態"},{value:"active",label:"活動"},{value:"inactive",label:"休眠"}],value:l,onChange:r,placeholder:"選擇會員狀態",className:"w-28"})]}),e.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["共 ",s," 位會員"]})]})}),vs=t=>`NT$ ${Number(t||0).toLocaleString()}`,js=({orders:t,onOpen:i})=>!t||t.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無訂單"}):e.jsx("div",{className:"space-y-3",children:t.map(l=>{var r;return e.jsx("button",{className:"w-full text-left glass rounded-xl p-4 hover:bg-white/60 transition",onClick:()=>i({type:"order",data:l}),children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{className:"font-mono text-sm",children:l.orderNo}),e.jsx("div",{className:"text-sm text-gray-600",children:l.createdAt}),e.jsx("div",{className:"text-sm font-semibold",children:vs(((r=l==null?void 0:l.totals)==null?void 0:r.grandTotal)??(l==null?void 0:l.grandTotal)??(l==null?void 0:l.total))}),e.jsx("div",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-700",children:l.status})]})},l.id)})}),bs=t=>`NT$ ${Number(t||0).toLocaleString()}`,Ns=({refunds:t,onOpen:i})=>!t||t.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無退款紀錄"}):e.jsx("div",{className:"space-y-3",children:t.map(l=>{var r;return e.jsx("button",{className:"w-full text-left glass rounded-xl p-4 hover:bg-white/60 transition",onClick:()=>i({type:"refund",data:l}),children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{className:"font-mono text-sm",children:l.refundNo}),e.jsx("div",{className:"text-sm text-gray-600",children:l.createdAt}),e.jsxs("div",{className:"text-sm font-semibold text-red-600",children:["- ",bs(((r=l==null?void 0:l.amounts)==null?void 0:r.totalRefund)??(l==null?void 0:l.totalRefund)??(l==null?void 0:l.amount))]}),e.jsx("div",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-700",children:l.status})]})},l.id)})}),ys=({addresses:t,memberId:i,refreshAfter:l,dataManager:r})=>{const s=(t||[]).filter(a=>a.type==="home");return s.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無宅配地址"}):e.jsx("div",{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"glass rounded-xl p-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-chinese font-semibold",children:[a.contactName,"（",a.phone,"）",a.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded",children:"預設"})]}),e.jsxs("div",{className:"text-gray-600",children:[a.postalCode," ",a.city,a.district,a.streetAddress]})]}),e.jsxs("div",{className:"flex gap-2 mt-0",children:[!a.isDefault&&e.jsx("button",{className:`${j.primaryButton} py-1 text-xs`,onClick:async()=>{await r.setDefaultShippingAddress(i,a.id),await l()},children:"設為預設"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded-lg bg-red-600 text-white hover:bg-red-700",onClick:async()=>{await r.deleteShippingAddress(i,a.id),await l()},children:"刪除"})]})]},a.id))})},fs=({addresses:t,memberId:i,refreshAfter:l,dataManager:r})=>{const s=(t||[]).filter(a=>a.type==="cvs");return s.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"尚無超商取貨地址"}):e.jsx("div",{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"glass rounded-xl p-4 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-chinese font-semibold",children:[a.provider," 門市",a.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded",children:"預設"})]}),e.jsxs("div",{className:"text-gray-600",children:[a.storeName,"（",a.storeId,"）- ",a.storeAddress]})]}),e.jsxs("div",{className:"flex gap-2 mt-0",children:[!a.isDefault&&e.jsx("button",{className:`${j.primaryButton} py-1 text-xs`,onClick:async()=>{await r.setDefaultShippingAddress(i,a.id),await l()},children:"設為預設"}),e.jsx("button",{className:"px-3 py-1 text-xs rounded-lg bg-red-600 text-white hover:bg-red-700",onClick:async()=>{await r.deleteShippingAddress(i,a.id),await l()},children:"刪除"})]})]},a.id))})},ks=[],qs=()=>{const[t,i]=x.useState("全部"),[l,r]=x.useState("全部"),s=Ye(),[a,c]=x.useState(!1),[n,m]=x.useState(null),[v,$]=x.useState("profile"),[w,R]=x.useState([]),[I,C]=x.useState([]),[b,M]=x.useState(null),[A,S]=x.useState(ks),[h,D]=x.useState({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""});x.useEffect(()=>{(async()=>{const{success:o,data:u}=await k.getMembers();o&&S(u)})()},[]),x.useEffect(()=>{(async()=>{if(n!=null&&n.id){const{success:o,data:u}=await Ge.getOrdersByMember(n.id);o&&R(u);const N=await Ge.getRefundsByMember(n.id);N.success&&C(N.data)}else R([]),C([])})()},[n]);const E=()=>M(null),T=x.useMemo(()=>A.filter(o=>{const u=t==="全部"||o.level===t,N=l==="全部"||o.status===l;return u&&N}),[t,l,A]),O=d=>{const o={VIP:"bg-purple-100 text-purple-800",金卡:"bg-yellow-100 text-yellow-800",銀卡:"bg-gray-100 text-gray-800",一般:"bg-blue-100 text-blue-800"},u=o[d]||o.一般;return e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium font-chinese ${u}`,children:d})},B=d=>{const o="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full font-chinese";return d==="active"?e.jsx("span",{className:`${o} bg-green-100 text-green-800`,children:"活動"}):e.jsx("span",{className:`${o} bg-red-100 text-red-800`,children:"休眠"})},F=[{key:"memberNo",label:"會員編號",sortable:!0,render:d=>e.jsx("span",{className:"font-mono text-sm",children:d})},{key:"name",label:"姓名",sortable:!0,render:d=>e.jsx("span",{className:"font-chinese font-medium",children:d})},{key:"contact",label:"聯絡資料",sortable:!1,render:(d,o)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:o.email}),e.jsx("div",{className:"text-gray-500",children:o.phone})]})},{key:"level",label:"會員等級",sortable:!0,render:d=>O(d)},{key:"totalSpent",label:"消費金額",sortable:!0,render:d=>e.jsxs("span",{className:"font-bold text-green-600",children:["NT$ ",Number(d||0).toLocaleString()]})},{key:"points",label:"積分",sortable:!0,render:d=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(es,{className:"w-4 h-4 text-amber-500 mr-1"}),d]})},{key:"orders",label:"訂單數",sortable:!0},{key:"status",label:"狀態",sortable:!1,render:d=>B(d)},{key:"tags",label:"標籤",sortable:!1,render:(d,o)=>{const u=Array.isArray(d)?d:[];return e.jsx("div",{className:"flex flex-wrap gap-1",children:u.slice(0,2).map((N,V)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 font-chinese",children:[e.jsx(Ke,{className:"w-3 h-3"}),N]},V))})}},{key:"actions",label:"操作",sortable:!1,render:(d,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{Icon:ss,label:"查看詳情",variant:"blue",onClick:()=>m(o)}),e.jsx(P,{Icon:ts,label:"編輯",variant:"amber",onClick:()=>s(`/members/edit/${o.id}`)}),e.jsx(P,{Icon:ns,label:"溝通紀錄",variant:"purple"}),e.jsx(P,{Icon:as,label:"積分管理",variant:"green"})]})}];return e.jsx("div",{className:"bg-[#fdf8f2] min-h-screen",children:e.jsxs("div",{className:j.contentContainerFluid,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:"w-8 h-8 text-amber-500 mr-3"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese",children:"會員管理系統"})]}),e.jsxs("button",{className:`${j.primaryButton} flex items-center`,onClick:()=>c(!0),children:[e.jsx(Xe,{className:"w-5 h-5 mr-2"}),"新增會員"]})]}),e.jsx(us,{selectedLevel:t,onChangeLevel:i,selectedStatus:l,onChangeStatus:r,total:T.length}),e.jsx(We,{data:T,columns:F,title:"會員清單",emptyMessage:"沒有找到符合條件的會員資料",exportFileName:"會員清單"}),e.jsx(ze,{isOpen:!!n,onClose:()=>{M(null),m(null)},title:"會員詳情",size:"max-w-2xl",children:n&&e.jsxs("div",{className:"p-6 pt-0 space-y-4",children:[e.jsx(He,{mode:"controlled",activeKey:v,onTabChange:d=>$(d.key),layout:"left",tabs:[{key:"profile",label:"基本資料"},{key:"orders",label:`訂單 (${w.length})`},{key:"home",label:"宅配地址"},{key:"cvs",label:"超商取貨地址"},{key:"refunds",label:`退款 (${I.length})`}]}),v==="profile"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"會員編號"}),e.jsx("div",{className:"text-gray-900",children:n.memberNo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"姓名"}),e.jsx("div",{className:"text-gray-900 font-chinese",children:n.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"Email"}),e.jsx("div",{className:"text-gray-900",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"電話"}),e.jsx("div",{className:"text-gray-900",children:n.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"性別"}),e.jsx("div",{className:"text-gray-900 font-chinese",children:n.gender})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"生日"}),e.jsx("div",{className:"text-gray-900",children:n.birthday})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"註冊日期"}),e.jsx("div",{className:"text-gray-900",children:n.registerDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 font-chinese mb-1",children:"最後登入"}),e.jsx("div",{className:"text-gray-900",children:n.lastLoginDate})]})]}),e.jsxs("div",{className:"border-t border-white/30 pt-6",children:[e.jsx("h3",{className:"text-lg font-bold font-chinese mb-4",children:"會員標籤"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(n.tags||[]).map((d,o)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-sm bg-blue-100/80 text-blue-700 rounded-full font-chinese backdrop-blur-sm",children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),d]},o))})]})]}),v==="orders"&&e.jsx(js,{orders:w,onOpen:M}),v==="refunds"&&e.jsx(Ns,{refunds:I,onOpen:M}),v==="home"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(ys,{addresses:n.shippingAddresses,memberId:n.id,dataManager:k,refreshAfter:async()=>{const{data:d}=await k.getMembers();S(d),m(d.find(o=>o.id===n.id))}}),e.jsx("div",{className:"mt-2",children:e.jsx(hs,{newAddress:h,setNewAddress:D,onSave:async()=>{const d={type:"home",contactName:h.contactName,phone:h.phone,postalCode:h.postalCode,city:h.city,district:h.district,streetAddress:h.streetAddress,isDefault:!!h.isDefault};await k.addShippingAddress(n.id,d);const{data:o}=await k.getMembers();S(o);const u=o.find(N=>N.id===n.id);m(u),D({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""})}})})]}),v==="cvs"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(fs,{addresses:n.shippingAddresses,memberId:n.id,dataManager:k,refreshAfter:async()=>{const{data:d}=await k.getMembers();S(d),m(d.find(o=>o.id===n.id))}}),e.jsx("div",{className:"mt-2",children:e.jsx(gs,{newAddress:h,setNewAddress:D,onSave:async()=>{const d={type:"cvs",provider:h.provider,storeId:h.storeId,storeName:h.storeName,storeAddress:h.storeAddress,isDefault:!!h.isDefault};await k.addShippingAddress(n.id,d);const{data:o}=await k.getMembers();S(o);const u=o.find(N=>N.id===n.id);m(u),D({type:"home",contactName:"",phone:"",postalCode:"",city:"",district:"",streetAddress:"",provider:"7-ELEVEN",storeId:"",storeName:"",storeAddress:""})}})})]})]})}),b&&e.jsx(ze,{isOpen:!!b,onClose:E,title:b.type==="order"?`訂單詳情：${b.data.orderNo}`:`退款詳情：${b.data.refundNo}`,size:"max-w-4xl",children:e.jsx("div",{className:"p-6 pt-0",children:e.jsx(os,{detail:b})})})]})})};export{qs as default};
