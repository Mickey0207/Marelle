import{r as n,j as e,A as c}from"./index-5be64975.js";const L=()=>{const[b,u]=n.useState(!1),[g,d]=n.useState(""),[w,l]=n.useState(""),[j,p]=n.useState(!0),[m,i]=n.useState(""),[x,f]=n.useState("");n.useEffect(()=>{let t=!1;const r=new URLSearchParams(window.location.search),a=r.get("bind");if(a==="success"){i("已成功綁定 LINE");const s=new URL(window.location.href);s.searchParams.delete("bind"),window.history.replaceState({},"",s.toString())}else if(a==="error"){const s=r.get("reason")||"unknown";i(`綁定失敗：${{line_id_taken:"此 LINE 帳號已被其他管理員綁定",missing_service_key:"伺服器設定不足（缺少 Service Role Key）",update_failed:"更新資料失敗",not_logged_in_for_bind:"請先登入再進行綁定"}[s]||s}`)}return(async()=>{try{const s=window&&window.__MARELLE_API_BASE__||"/",h=await fetch(`${s.replace(/\/$/,"")}/backend/account/line/profile`,{credentials:"include"});if(!h.ok)throw new Error("載入失敗");const o=await h.json();t||(u(!!o.linked),d(o.line_display_name||""),l(o.line_user_id||""),f(o.line_picture_url||""))}catch{t||i("載入綁定資訊失敗")}finally{t||p(!1)}})(),()=>{t=!0}},[]);const _=()=>{const t=window.location.pathname+window.location.search,r=window&&window.__MARELLE_API_BASE__||"/",a=new URL("/backend/auth/line/start",r);a.searchParams.set("mode","bind"),a.searchParams.set("next",t),window.location.href=a.toString()},N=async()=>{try{const t=window&&window.__MARELLE_API_BASE__||"/";if(!(await fetch(`${t.replace(/\/$/,"")}/backend/account/line/unbind`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)throw new Error("解除綁定失敗");u(!1),d(""),l(""),i("已解除綁定")}catch{i("解除綁定失敗")}};return e.jsx("div",{className:c.pageContainer,children:e.jsxs("div",{className:c.contentContainer,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:c.pageTitle,children:"帳號設定 · 第三方登入"}),e.jsx("p",{className:c.pageSubtitle,children:"管理 LINE 等第三方綁定"})]}),e.jsxs("div",{className:"bg-white/40 backdrop-blur-sm rounded-lg p-6 space-y-6",children:[m&&e.jsx("div",{className:"text-sm text-[#2d1e0f] bg-white/60 border border-[#e5ded6] rounded px-3 py-2",children:m}),e.jsxs("div",{className:"flex items-center justify-between bg-white border border-[#e5ded6] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x?e.jsx("img",{src:x,alt:"LINE Avatar",className:"w-8 h-8 rounded object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded bg-[#00c300] text-white flex items-center justify-center font-bold",children:"L"}),e.jsx("div",{className:"font-chinese text-sm text-[#2d1e0f]",children:"LINE"})]}),b?e.jsx("button",{onClick:N,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors font-chinese text-sm",children:"解除綁定"}):e.jsx("button",{onClick:_,className:"bg-[#00c300] text-white px-4 py-2 rounded-lg hover:bg-[#00b300] transition-colors font-chinese text-sm",children:"綁定 LINE"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"LINE 暱稱"}),e.jsx("input",{type:"text",value:g,onChange:t=>d(t.target.value),disabled:!0,className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm text-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"LINE ID"}),e.jsx("input",{type:"text",value:w,onChange:t=>l(t.target.value),disabled:!0,className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm text-gray-700"})]})]})]})]})})};export{L as default};
