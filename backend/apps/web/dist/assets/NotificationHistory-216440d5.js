import{r as i,a as L,u as A,g as B,j as t}from"./index-5be64975.js";import{n as Q}from"./notificationDataManager-7a4ef445.js";import{S as F}from"./StandardTable-046e436b.js";import{I as g}from"./IconActionButton-2bcd0b2a.js";import{M}from"./MagnifyingGlassIcon-34e54beb.js";import{B as P}from"./BellIcon-679cf2a6.js";import{E as W}from"./EyeIcon-db27fda4.js";import{E as $}from"./ExclamationTriangleIcon-5236f94b.js";import{T as y}from"./TrashIcon-c73d815d.js";import"./chevron-down-e41c1b61.js";const X=()=>{const[j,o]=i.useState([]),[v,m]=i.useState(!0),l=L(),b=A(),f=new URLSearchParams(l.search),N=["all","delivered","failed","pending","sent"].includes(f.get("status"))?f.get("status"):"all",[s,d]=i.useState({status:N,type:"all",dateRange:"all",searchQuery:""}),[w,p]=i.useState([]),h=Q.getNotifications(),x=i.useCallback(async()=>{m(!0);try{await new Promise(n=>setTimeout(n,800));let e=[...h];if(s.status!=="all"&&(e=e.filter(n=>n.status===s.status)),s.type!=="all"&&(e=e.filter(n=>n.type===s.type)),s.searchQuery){const n=s.searchQuery.toLowerCase();e=e.filter(c=>c.subject.toLowerCase().includes(n)||c.recipientName.toLowerCase().includes(n)||c.recipientEmail.toLowerCase().includes(n))}const a=new Date,r={"1day":1,"7days":7,"30days":30,"90days":90};if(s.dateRange!=="all"&&r[s.dateRange]){const n=new Date(a.getTime()-r[s.dateRange]*24*60*60*1e3);e=e.filter(c=>new Date(c.createdAt)>=n)}o(e)}catch(e){console.error("Error loading notifications:",e)}finally{m(!1)}},[h,s]);i.useEffect(()=>{x(),B.fromTo(".notification-item",{opacity:0,y:20},{opacity:1,y:0,duration:.6,stagger:.1,ease:"power2.out"})},[s,x]),i.useEffect(()=>{const e=new URLSearchParams(l.search);s.status&&s.status!=="all"?e.set("status",s.status):e.delete("status");const a=e.toString(),r=l.search.startsWith("?")?l.search.slice(1):l.search;a!==r&&b({pathname:l.pathname,search:a?`?${a}`:""},{replace:!0})},[s.status]);const S=e=>{switch(e){case"delivered":return"已送達";case"failed":return"發送失敗";case"pending":return"待發送";case"sent":return"已發送";default:return"未知"}},C=e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";case"sent":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},I=e=>{switch(e){case"order":return"訂單通知";case"payment":return"付款通知";case"shipping":return"物流通知";case"promotion":return"促銷通知";case"system":return"系統通知";default:return"一般通知"}},u=e=>e?new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",k=e=>{!e||e.length===0||confirm(`確定要刪除選中的 ${e.length} 個通知嗎？`)&&(o(a=>a.filter(r=>!e.includes(r.id))),p([]))},T=e=>{confirm("確定要刪除此通知嗎？")&&(o(a=>a.filter(r=>r.id!==e)),p(a=>a.filter(r=>r!==e)))},E=e=>{o(a=>a.map(r=>r.id===e?{...r,status:"pending",errorMessage:null}:r))};if(v)return t.jsx("div",{className:"bg-[#fdf8f2] min-h-screen p-6",children:t.jsxs("div",{className:"flex justify-center items-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#cc824d]"}),t.jsx("span",{className:"ml-3 text-gray-600",children:"載入通知歷史中..."})]})});const R=[{key:"subject",label:"主旨",render:(e,a)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-gray-900 font-medium",children:e}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${C(a.status)}`,children:S(a.status)}),t.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-700 rounded-full",children:I(a.type)})]})},{key:"recipientName",label:"收件人",render:(e,a)=>t.jsxs("div",{className:"text-gray-900",children:[t.jsx("div",{className:"font-medium",children:a.recipientName}),t.jsx("div",{className:"text-xs text-gray-500",children:a.recipientEmail||"-"})]})},{key:"channel",label:"渠道"},{key:"createdAt",label:"建立時間",render:e=>t.jsx("span",{children:u(e)})},{key:"sentAt",label:"發送時間",render:e=>t.jsx("span",{children:u(e)})},{key:"deliveredAt",label:"送達時間",render:e=>t.jsx("span",{children:u(e)})},{key:"openedAt",label:"開啟時間",render:e=>t.jsx("span",{children:u(e)})},{key:"actions",label:"操作",sortable:!1,render:(e,a)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(g,{Icon:W,label:"檢視",variant:"gray"}),a.status==="failed"&&t.jsx(g,{Icon:$,label:"重新發送",variant:"blue",onClick:()=>E(a.id)}),t.jsx(g,{Icon:y,label:"刪除",variant:"red",onClick:()=>T(a.id)})]})}],D=[{label:"刪除選取",variant:"danger",onClick:k,icon:y}];return t.jsxs("div",{className:"bg-[#fdf8f2] min-h-screen p-6",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"通知歷史"}),t.jsx("p",{className:"text-gray-600 mt-2",children:"查看所有已發送的通知記錄"})]}),t.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-lg border border-white/20 p-6 mb-8",children:[t.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[t.jsx("div",{className:"col-span-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(M,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),t.jsx("input",{type:"text",placeholder:"搜尋收件人、主題...",value:s.searchQuery,onChange:e=>d(a=>({...a,searchQuery:e.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#cc824d] focus:border-transparent"})]})}),t.jsx("div",{children:t.jsxs("select",{value:s.status,onChange:e=>d(a=>({...a,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#cc824d] focus:border-transparent",children:[t.jsx("option",{value:"all",children:"所有狀態"}),t.jsx("option",{value:"delivered",children:"已送達"}),t.jsx("option",{value:"failed",children:"發送失敗"}),t.jsx("option",{value:"pending",children:"待發送"}),t.jsx("option",{value:"sent",children:"已發送"})]})}),t.jsx("div",{children:t.jsxs("select",{value:s.type,onChange:e=>d(a=>({...a,type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#cc824d] focus:border-transparent",children:[t.jsx("option",{value:"all",children:"所有類型"}),t.jsx("option",{value:"order",children:"訂單通知"}),t.jsx("option",{value:"payment",children:"付款通知"}),t.jsx("option",{value:"shipping",children:"物流通知"}),t.jsx("option",{value:"promotion",children:"促銷通知"}),t.jsx("option",{value:"system",children:"系統通知"})]})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[t.jsx("div",{children:t.jsxs("select",{value:s.dateRange,onChange:e=>d(a=>({...a,dateRange:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#cc824d] focus:border-transparent",children:[t.jsx("option",{value:"all",children:"所有時間"}),t.jsx("option",{value:"1day",children:"最近1天"}),t.jsx("option",{value:"7days",children:"最近7天"}),t.jsx("option",{value:"30days",children:"最近30天"}),t.jsx("option",{value:"90days",children:"最近90天"})]})}),t.jsx("div",{className:"col-span-2"})]})]}),t.jsx(F,{data:j,columns:R,title:"通知列表",exportFileName:"通知歷史",enableBatchSelection:!0,selectedItems:w,onSelectedItemsChange:e=>p(e),batchActions:D,getRowId:e=>e.id,emptyIcon:P})]})};export{X as default};
