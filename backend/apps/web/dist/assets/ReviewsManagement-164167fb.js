import{r as o,j as e,A as k}from"./index-5be64975.js";import{S as C}from"./StandardTable-046e436b.js";import{G as M}from"./GlassModal-8d9cbd14.js";import{I as b}from"./IconActionButton-2bcd0b2a.js";import{E as R}from"./EyeIcon-db27fda4.js";import{T as A}from"./TrashIcon-c73d815d.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";function I({title:a,titleId:r,...s},c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":r},s),a?o.createElement("title",{id:r},a):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"}))}const S=o.forwardRef(I),E=S,h=a=>String(a).padStart(2,"0"),p=(a,r)=>Math.floor(Math.random()*(r-a+1))+a,m=a=>a[Math.floor(Math.random()*a.length)],d=Array.from({length:60}).map((a,r)=>{const s=new Date(Date.now()-p(0,240)*864e5),c=`${s.getFullYear()}-${h(s.getMonth()+1)}-${h(s.getDate())}`;return{id:`RV-${1e3+r}`,orderNo:`O-${2e3+r}`,sku:`SKU-${1e3+r%20}`,productName:m(["經典帆布包","保溫杯","無線滑鼠","藍牙耳機","運動毛巾","筆記本"]),rating:p(1,5),title:m(["很喜歡","普通","品質不錯","性價比高","有點瑕疵"]),content:m(["出貨快、品質好，會再回購。","一般般，沒有太大驚喜。","設計很好看，容量也夠用。","包裝完整，客服回覆也很快。","有些小刮痕，但可接受。"]),images:[],createdAt:c,status:m(["published","hidden","pending"]),author:m(["王小明","李小美","陳大文","林靜怡","張雅婷"])}}),g={async list(){return await new Promise(a=>setTimeout(a,80)),{success:!0,data:[...d]}},async update(a,r){const s=d.findIndex(c=>c.id===a);return s===-1?{success:!1}:(d[s]={...d[s],...r},await new Promise(c=>setTimeout(c,60)),{success:!0,data:{...d[s]}})},async delete(a){const r=d.findIndex(s=>s.id===a);return r===-1?{success:!1}:(d.splice(r,1),await new Promise(s=>setTimeout(s,40)),{success:!0})}};function O(){const[a,r]=o.useState([]),[s,c]=o.useState(null);o.useEffect(()=>{(async()=>{const t=await g.list();t.success&&r(t.data)})()},[]);const f=o.useMemo(()=>{const t=new Map;for(const n of a){const l=n.sku||n.productName;t.has(l)||t.set(l,{sku:n.sku,productName:n.productName,reviews:[]}),t.get(l).reviews.push(n)}return Array.from(t.values()).map(n=>{const l=n.reviews.length,v=l?n.reviews.reduce((u,x)=>u+(x.rating||0),0)/l:0,w=n.reviews.reduce((u,x)=>u>x.createdAt?u:x.createdAt,"");return{...n,reviewCount:l,avgRating:Number(v.toFixed(2)),lastReviewedAt:w}})},[a]),N=o.useMemo(()=>[{key:"productName",label:"商品",sortable:!0,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 font-chinese",children:i.productName||"-"}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:i.sku||"-"})]})},{key:"reviewCount",label:"評價數",sortable:!0,render:t=>e.jsx("span",{className:"text-gray-900 font-semibold",children:t})},{key:"avgRating",label:"平均評分",sortable:!0,render:t=>e.jsx("div",{className:"text-amber-600 font-semibold",children:Number(t||0).toFixed(2)})},{key:"lastReviewedAt",label:"最近評價日期",sortable:!0}],[]),j=async t=>{(await g.delete(t.id)).success&&r(n=>n.filter(l=>l.id!==t.id))},y=o.useMemo(()=>[{key:"createdAt",label:"日期",sortable:!0},{key:"author",label:"作者",sortable:!0},{key:"rating",label:"評分",sortable:!0,render:t=>e.jsxs("div",{className:"text-amber-600 font-semibold",children:["★".repeat(t),e.jsx("span",{className:"text-gray-300",children:"★".repeat(5-t)})]})},{key:"title",label:"標題",sortable:!0},{key:"status",label:"狀態",sortable:!0,render:t=>{const n={published:"已發布",pending:"待審核",hidden:"隱藏"}[t]||t,l=t==="published"?"bg-green-100 text-green-800":t==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return e.jsx("span",{className:`inline-flex items-center px-2 py-1 text-xs rounded-full font-chinese ${l}`,children:n})}},{key:"actions",label:"操作",sortable:!1,render:(t,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{Icon:R,label:"查看",variant:"blue",onClick:()=>c(i)}),e.jsx(b,{Icon:A,label:"刪除",variant:"red",onClick:()=>j(i)})]})}],[]);return e.jsx("div",{className:"min-h-screen bg-[#fdf8f2]",children:e.jsxs("div",{className:k.contentContainerFluid,children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-8 h-8 text-amber-500"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese",children:"評價管理"})]})}),e.jsx(C,{title:"商品評價概覽",data:f,columns:N,exportFileName:"商品評價概覽",enableRowExpansion:!0,getSubRows:t=>t.reviews||[],subColumns:y,renderSubtableHeader:t=>e.jsxs("div",{className:"text-sm text-gray-600",children:[t.productName||"-","（",t.sku||"-","）的評價列表（",t.reviewCount," 筆）"]}),subtableClassName:"bg-white/70 rounded-xl",getRowId:t=>t.sku||t.productName}),e.jsx(M,{isOpen:!!s,onClose:()=>c(null),title:`評價詳情：${s==null?void 0:s.id}`,size:"max-w-3xl",children:s&&e.jsx("div",{className:"p-6 pt-0 space-y-4",children:e.jsx("div",{className:"glass rounded-xl p-4",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"商品："}),s.productName,"（",s.sku,"）"]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"訂單："}),s.orderNo]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"評分："}),"★".repeat(s.rating),e.jsx("span",{className:"text-gray-300",children:"★".repeat(5-s.rating)})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"標題："}),s.title]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"內容："}),s.content]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"作者："}),s.author]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"日期："}),s.createdAt]})]})})})})]})})}export{O as default};
