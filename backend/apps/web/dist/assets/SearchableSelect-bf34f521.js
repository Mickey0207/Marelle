import{r,g as q,j as t,c as B}from"./index-09c3368c.js";import{c as k,C as X}from"./chevron-down-5d12351e.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],J=k("check",G);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],z=k("search",K);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],A=k("x",Q),U=({options:j=[],value:i="",onChange:p=()=>{},placeholder:E="請選擇...",searchPlaceholder:D="搜尋選項...",className:P="",disabled:L=!1,allowClear:_=!1,multiple:l=!1,maxDisplayOptions:b=10,createNewOption:N=null})=>{const[a,v]=r.useState(!1),[c,y]=r.useState(""),[h,O]=r.useState(j),[n,d]=r.useState(l?Array.isArray(i)?i:[]:[i]),[C,F]=r.useState({top:0,left:0,width:0}),m=r.useRef(null),I=r.useRef(null),x=r.useRef(null),M=e=>e.map(s=>typeof s=="string"?{value:s,label:s}:s),u=r.useMemo(()=>M(j),[j]);r.useEffect(()=>{const e=u.filter(s=>s.label.toLowerCase().includes(c.toLowerCase())||s.value.toLowerCase().includes(c.toLowerCase()));O(e)},[c,u]),r.useEffect(()=>{d(l?Array.isArray(i)?i:[]:[i])},[i,l]);const w=()=>{if(m.current){const e=m.current.getBoundingClientRect(),s=window.innerHeight,o=300;let f=e.bottom+2,g=e.left;f+o>s&&(f=e.top-o-2),g+e.width>window.innerWidth&&(g=window.innerWidth-e.width-10),g<10&&(g=10),F({top:Math.max(f,10),left:g,width:e.width})}},T=()=>{L||(a?v(!1):(v(!0),requestAnimationFrame(()=>{w()})))};r.useEffect(()=>{a&&x.current&&(w(),q.fromTo(x.current,{opacity:0,y:-10,scale:.95},{opacity:1,y:0,scale:1,duration:.2,ease:"power2.out"}))},[a]),r.useEffect(()=>{const e=f=>{m.current&&!m.current.contains(f.target)&&x.current&&!x.current.contains(f.target)&&(v(!1),y(""))},s=()=>{a&&w()},o=()=>{a&&w()};return a&&(document.addEventListener("mousedown",e),document.addEventListener("scroll",s,!0),window.addEventListener("scroll",s),window.addEventListener("resize",o),requestAnimationFrame(w)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("scroll",s,!0),window.removeEventListener("scroll",s),window.removeEventListener("resize",o)}},[a]);const S=e=>{if(l){const s=n.includes(e.value)?n.filter(o=>o!==e.value):[...n,e.value];d(s),p(s)}else d([e.value]),p(e.value),v(!1),y("")},V=e=>{e.stopPropagation(),l?(d([]),p([])):(d([""]),p(""))},W=()=>{if(N&&c.trim()){const e=N(c.trim());e&&(S(e),y(""))}},H=()=>{if(l){if(n.length===0)return E;if(n.length===1){const e=u.find(s=>s.value===n[0]);return e?e.label:n[0]}return`已選擇 ${n.length} 項`}else{if(!n[0])return E;const e=u.find(s=>s.value===n[0]);return e?e.label:n[0]}},$=e=>n.includes(e),R=N&&c.trim()&&!h.some(e=>e.label.toLowerCase()===c.toLowerCase());return t.jsxs("div",{ref:m,className:`relative ${P}`,style:{zIndex:a?9999:"auto"},children:[t.jsxs("div",{onClick:T,className:`
          relative w-full px-4 py-2.5 bg-white border border-gray-300 rounded-lg 
          cursor-pointer transition-all duration-200 font-chinese
          glass-light hover:border-button-300 hover:shadow-md
          ${L?"opacity-50 cursor-not-allowed":""}
          ${a?"border-button-500 shadow-lg ring-2 ring-button-100":""}
        `,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 truncate",children:[!l&&n[0]&&(()=>{const e=u.find(s=>s.value===n[0]);return e!=null&&e.icon?t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4",children:e.icon}):null})(),t.jsx("span",{className:`truncate ${!n[0]&&!l?"text-gray-500":"text-gray-900"}`,children:H()})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[_&&(n[0]||l&&n.length>0)&&t.jsx("button",{onClick:V,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",type:"button",children:t.jsx(A,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})}),t.jsx(X,{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${a?"transform rotate-180":""}`})]})]}),l&&n.length>1&&t.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[n.slice(0,3).map(e=>{const s=u.find(o=>o.value===e);return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-button-100 text-button-800 text-xs rounded-full",children:[s?s.label:e,t.jsx("button",{onClick:o=>{o.stopPropagation(),S({value:e})},className:"hover:bg-button-200 rounded-full p-0.5",children:t.jsx(A,{className:"w-3 h-3"})})]},e)}),n.length>3&&t.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",n.length-3," 更多"]})]})]}),a&&B.createPortal(t.jsxs("div",{ref:x,className:"fixed z-[200000] glass-dropdown",style:{top:`${C.top}px`,left:`${C.left}px`,width:`${C.width}px`,zIndex:2e5,minWidth:"200px"},children:[t.jsx("div",{className:"glass-dropdown-search",children:t.jsxs("div",{className:"relative",children:[t.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4 z-10"}),t.jsx("input",{ref:I,type:"text",value:c,onChange:e=>y(e.target.value),placeholder:D,className:"font-chinese",autoFocus:!0})]})}),t.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[R&&t.jsxs("button",{onClick:W,className:"glass-dropdown-create font-chinese group",children:[t.jsx("div",{className:"w-4 h-4 border-2 rounded-full flex items-center justify-center transition-colors",style:{borderColor:"#CC824D"},children:t.jsx("div",{className:"w-1 h-1 rounded-full transition-colors",style:{backgroundColor:"#CC824D"}})}),t.jsxs("span",{className:"group-hover:text-orange-800",children:['創建 "',c,'"']})]}),h.slice(0,b).map(e=>t.jsxs("button",{onClick:()=>S(e),className:`glass-dropdown-option font-chinese ${$(e.value)?"selected":""}`,children:[t.jsxs("span",{className:"truncate flex items-center gap-2",children:[e.icon&&t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4",children:e.icon}),t.jsx("span",{className:"truncate",children:e.label})]}),$(e.value)&&t.jsx(J,{className:"w-4 h-4 flex-shrink-0 ml-2",style:{color:"#CC824D"}})]},e.value)),h.length===0&&!R&&t.jsxs("div",{className:"glass-dropdown-empty font-chinese",children:[t.jsx(z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{className:"text-sm",children:"沒有找到符合的選項"})]}),h.length>b&&t.jsxs("div",{className:"glass-dropdown-more font-chinese",children:["還有 ",h.length-b," 個選項..."]})]})]}),document.body)]})},ee=U;export{ee as S};
