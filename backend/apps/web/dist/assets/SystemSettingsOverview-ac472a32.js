import{r as c,l as K,f as X,h as ee,j as e,i as te,k as se,m as ae,n as ne,o as re,p as le,q as ie,s as ce,t as oe}from"./index-09c3368c.js";import{S as me}from"./SearchableSelect-bf34f521.js";import{C as de}from"./ChartBarIcon-50296ea8.js";import{A as ue}from"./AdjustmentsHorizontalIcon-4b269a48.js";import{C as ge}from"./Cog6ToothIcon-f8515c56.js";import{C as V}from"./ClockIcon-bab15198.js";import{U as xe}from"./UserIcon-d302ce60.js";import{E as H}from"./ExclamationTriangleIcon-8f54841e.js";import{C as he}from"./CheckCircleIcon-377c1a08.js";import"./chevron-down-5d12351e.js";function pe({title:n,titleId:r,...l},i){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},l),n?c.createElement("title",{id:r},n):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const ye=c.forwardRef(pe),be=ye;function fe({title:n,titleId:r,...l},i){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},l),n?c.createElement("title",{id:r},n):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const je=c.forwardRef(fe),ve=je,S=()=>new Date().toISOString(),d={system_core:{"system.name":{value:"Marelle 管理系統",label:"系統名稱"},"system.timezone":{value:"Asia/Taipei",label:"時區"},"system.language":{value:"zh-TW",label:"語系"}},system_security:{"security.password_min_length":{value:8,label:"密碼最小長度"},"security.login_max_attempts":{value:5,label:"登入最大嘗試次數"},"security.session_timeout":{value:30,label:"工作階段逾時(分鐘)"}},notification_management:{"notification.email_enabled":{value:!0,label:"啟用 Email 通知"},"notification.sms_enabled":{value:!1,label:"啟用 SMS 通知"}},payment_management:{"payment.currency":{value:"TWD",label:"預設貨幣"},"payment.tax_rate":{value:5,label:"稅率(%)"}},shipping_management:{"shipping.free_shipping_threshold":{value:2e3,label:"免運費門檻"},"shipping.default_carrier":{value:"EZShip",label:"預設物流"},"shipping.enable_express":{value:!1,label:"啟用快捷"}}},N=[{settingId:"system_core.system.name",changedAt:S(),changedBy:"admin",oldValue:"Marelle",newValue:"Marelle 管理系統"}];function w(n,r){var l,i;return(i=(l=d==null?void 0:d[n])==null?void 0:l[r])==null?void 0:i.value}function J(n,r,l,i="admin"){var o;d[n]||(d[n]={});const g=(o=d[n][r])==null?void 0:o.value;return d[n][r]=d[n][r]||{value:void 0},d[n][r].value=l,N.unshift({settingId:`${n}.${r}`,changedAt:S(),changedBy:i,oldValue:g,newValue:l}),N.length>50&&(N.length=50),{success:!0}}function we(n){return{...d[n]||{}}}function Ne(){const n=Object.keys(d),r=n.reduce((i,g)=>i+Object.keys(d[g]).length,0),l=n.map(i=>({category:i,count:Object.keys(d[i]).length}));return{totalSettings:r,categories:n.length,categoryBreakdown:l,recentChanges:[...N],generatedAt:S()}}function Se(){const n={};for(const r of Object.keys(d)){n[r]={};for(const l of Object.keys(d[r]))n[r][l]=d[r][l].value}return JSON.stringify({version:"mock-1.0",exportedAt:S(),settings:n},null,2)}function _e(n,r="admin"){try{const l=JSON.parse(n),i=l.settings||l;return Object.keys(i||{}).forEach(o=>{Object.keys(i[o]||{}).forEach(h=>{J(o,h,i[o][h],r)})}),{success:!0}}catch(l){return{success:!1,error:(l==null?void 0:l.message)||"Invalid JSON"}}}function ke(n){const r=String(n||"").toLowerCase();if(!r)return[];const l=[];for(const i of Object.keys(d))for(const g of Object.keys(d[i])){const o=d[i][g],x=String(o==null?void 0:o.value),h=String((o==null?void 0:o.label)||"");(g.toLowerCase().includes(r)||x.toLowerCase().includes(r)||h.toLowerCase().includes(r)||i.toLowerCase().includes(r))&&l.push({settingId:`${i}.${g}`,category:i,key:g,value:o==null?void 0:o.value,label:o==null?void 0:o.label})}return l}const u={getSystemSettings(){return{siteName:w("system_core","system.name")||"Marelle 管理系統",timezone:w("system_core","system.timezone")||"Asia/Taipei",language:w("system_core","system.language")||"zh-TW"}},getSettingsStatistics:Ne,getSettingsByCategory:we,getSetting:w,updateSetting:J,exportSettings:Se,importSettings:_e,searchSettings:ke},Be=()=>{const[n,r]=c.useState({}),[l,i]=c.useState([]),[g,o]=c.useState({}),[x,h]=c.useState({}),[_,Ce]=c.useState(""),[De,O]=c.useState([]),[I,y]=c.useState([]),[R,b]=c.useState([]),[E,f]=c.useState([]),[P,T]=c.useState(!1),[k,A]=c.useState(""),[C,L]=c.useState(""),[D,M]=c.useState(""),j=c.useCallback(()=>{const t=u.getSettingsStatistics();r(t),i(t.recentChanges);const s=q();o(s);const a=F();h(a)},[]);c.useEffect(()=>{j()},[j]),c.useEffect(()=>{(async()=>{try{T(!0);const[t,s,a]=await Promise.all([K(),X(),ee()]);y(t||[]),b(s||[]),f(a||[])}catch(t){console.error("載入系統選項失敗",t)}finally{T(!1)}})()},[]),c.useEffect(()=>{if(_.trim()){const t=u.searchSettings(_);O(t)}else O([])},[_]);const q=()=>{var a,m,p,$,B,W,z;const t=u.getSettingsByCategory("system_security"),s=u.getSettingsByCategory("notification_management");return{security:{status:"healthy",message:"安全設定正常",lastCheck:new Date().toISOString(),details:{passwordPolicy:((a=t["security.password_min_length"])==null?void 0:a.value)>=8,loginProtection:((m=t["security.login_max_attempts"])==null?void 0:m.value)<=5,sessionTimeout:((p=t["security.session_timeout"])==null?void 0:p.value)<=60}},notifications:{status:($=s["notification.email_enabled"])!=null&&$.value?"active":"warning",message:(B=s["notification.email_enabled"])!=null&&B.value?"通知系統正常運作":"部分通知功能未啟用",lastCheck:new Date().toISOString(),details:{email:(W=s["notification.email_enabled"])==null?void 0:W.value,sms:(z=s["notification.sms_enabled"])==null?void 0:z.value}},performance:{status:"healthy",message:"系統效能良好",lastCheck:new Date().toISOString(),details:{responseTime:"< 200ms",uptime:"99.9%",memoryUsage:"65%"}}}},F=()=>({"system.name":u.getSetting("system_core","system.name"),"security.password_min_length":u.getSetting("system_security","security.password_min_length"),"notification.email_enabled":u.getSetting("notification_management","notification.email_enabled"),"payment.currency":u.getSetting("payment_management","payment.currency"),"shipping.free_shipping_threshold":u.getSetting("shipping_management","shipping.free_shipping_threshold")}),v=(t,s,a)=>{u.updateSetting(t,s,a),j()},Q=()=>{const t=u.exportSettings(),s=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(s),m=document.createElement("a");m.href=a,m.download=`marelle-settings-${new Date().toISOString().split("T")[0]}.json`,m.click(),URL.revokeObjectURL(a)},Z=t=>{const s=t.target.files[0];if(s){const a=new FileReader;a.onload=m=>{const p=u.importSettings(m.target.result);p.success?(alert("設定匯入成功！"),j()):alert(`匯入失敗：${p.error}`)},a.readAsText(s)}},U=t=>new Date(t).toLocaleString("zh-TW"),Y=t=>{switch(t){case"healthy":case"active":return e.jsx(he,{className:"h-5 w-5 text-green-500"});case"warning":return e.jsx(H,{className:"h-5 w-5 text-yellow-500"});case"error":return e.jsx(H,{className:"h-5 w-5 text-red-500"});default:return e.jsx(V,{className:"h-5 w-5 text-gray-500"})}},G=t=>{switch(t){case"healthy":case"active":return"text-green-600 bg-green-50 border-green-200";case"warning":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"error":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return e.jsx("div",{className:"min-h-screen",style:{backgroundColor:"#fdf8f2"},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"系統設定總覽"}),e.jsx("p",{className:"text-gray-600",children:"集中管理所有系統配置與設定項目"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:Q,className:"bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors flex items-center font-medium",children:[e.jsx(be,{className:"h-5 w-5 mr-2"}),"匯出設定"]}),e.jsxs("label",{className:"bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors flex items-center font-medium cursor-pointer",children:[e.jsx(ve,{className:"h-5 w-5 mr-2"}),"匯入設定",e.jsx("input",{type:"file",accept:".json",onChange:Z,className:"hidden"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(de,{className:"h-5 w-5 mr-2 text-[#cc824d]"}),"系統狀態監控"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(g).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[Y(s.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 capitalize",children:t}),e.jsx("p",{className:"text-sm text-gray-600",children:s.message})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${G(s.status)}`,children:s.status==="healthy"?"正常":s.status==="active"?"運作中":s.status==="warning"?"警告":"錯誤"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:U(s.lastCheck)})]})]},t))})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2 text-[#cc824d]"}),"快速設定"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"系統名稱"}),e.jsx("input",{type:"text",value:x["system.name"]||"",onChange:t=>v("system_core","system.name",t.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#cc824d] focus:border-transparent"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"密碼最小長度"}),e.jsx("input",{type:"number",value:x["security.password_min_length"]||"",onChange:t=>v("system_security","security.password_min_length",Number(t.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#cc824d] focus:border-transparent"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"預設貨幣"}),e.jsx(me,{options:[{value:"TWD",label:"新台幣 (TWD)"},{value:"USD",label:"美元 (USD)"},{value:"EUR",label:"歐元 (EUR)"},{value:"JPY",label:"日圓 (JPY)"}],value:x["payment.currency"]||"TWD",onChange:t=>v("payment_management","payment.currency",t),placeholder:"選擇貨幣",className:"w-full"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"免運費門檻"}),e.jsx("input",{type:"number",value:x["shipping.free_shipping_threshold"]||"",onChange:t=>v("shipping_management","shipping.free_shipping_threshold",Number(t.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#cc824d] focus:border-transparent"})]})]})})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 mr-2 text-[#cc824d]"}),"系統選項（部門 / 角色 / 模組）"]}),P?e.jsx("p",{className:"text-sm text-gray-500",children:"載入中..."}):e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"部門"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border border-gray-300 rounded px-2 py-1 text-sm",placeholder:"新增部門",value:k,onChange:t=>A(t.target.value)}),e.jsx("button",{className:"text-white bg-amber-600 hover:bg-amber-700 text-sm px-3 py-1 rounded",onClick:async()=>{if(k.trim())try{const t=await te(k.trim());y(s=>[{id:t.id,name:t.name},...s]),A("")}catch(t){alert((t==null?void 0:t.message)||"新增失敗")}},children:"新增"})]})]}),e.jsxs("ul",{className:"space-y-2",children:[I.map(t=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 rounded px-3 py-2",children:[e.jsx("span",{className:"text-sm text-gray-800",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-amber-700 hover:bg-amber-100 rounded px-2 py-1 text-sm",onClick:async()=>{const s=prompt("重新命名部門",t.name);if(s&&s!==t.name)try{await se(t.id,s),y(a=>a.map(m=>m.id===t.id?{...m,name:s}:m))}catch(a){alert((a==null?void 0:a.message)||"更新失敗")}},children:"重新命名"}),e.jsx("button",{className:"text-red-700 hover:bg-red-100 rounded px-2 py-1 text-sm",onClick:async()=>{if(confirm(`確定刪除部門「${t.name}」？`))try{await ae(t.id),y(s=>s.filter(a=>a.id!==t.id))}catch(s){alert((s==null?void 0:s.message)||"刪除失敗")}},children:"刪除"})]})]},t.id)),I.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:"尚無部門"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"角色"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border border-gray-300 rounded px-2 py-1 text-sm",placeholder:"新增角色",value:C,onChange:t=>L(t.target.value)}),e.jsx("button",{className:"text-white bg-amber-600 hover:bg-amber-700 text-sm px-3 py-1 rounded",onClick:async()=>{if(C.trim())try{const t=await ne(C.trim());b(s=>[{id:t.id,name:t.name},...s]),L("")}catch(t){alert((t==null?void 0:t.message)||"新增失敗")}},children:"新增"})]})]}),e.jsxs("ul",{className:"space-y-2",children:[R.map(t=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 rounded px-3 py-2",children:[e.jsx("span",{className:"text-sm text-gray-800",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-amber-700 hover:bg-amber-100 rounded px-2 py-1 text-sm",onClick:async()=>{const s=prompt("重新命名角色",t.name);if(s&&s!==t.name)try{await re(t.id,s),b(a=>a.map(m=>m.id===t.id?{...m,name:s}:m))}catch(a){alert((a==null?void 0:a.message)||"更新失敗")}},children:"重新命名"}),e.jsx("button",{className:"text-red-700 hover:bg-red-100 rounded px-2 py-1 text-sm",onClick:async()=>{if(confirm(`確定刪除角色「${t.name}」？`))try{await le(t.id),b(s=>s.filter(a=>a.id!==t.id))}catch(s){alert((s==null?void 0:s.message)||"刪除失敗")}},children:"刪除"})]})]},t.id)),R.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:"尚無角色"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"模組"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border border-gray-300 rounded px-2 py-1 text-sm",placeholder:"新增模組",value:D,onChange:t=>M(t.target.value)}),e.jsx("button",{className:"text-white bg-amber-600 hover:bg-amber-700 text-sm px-3 py-1 rounded",onClick:async()=>{if(D.trim())try{const t=await ie(D.trim());f(s=>[{id:t.id,name:t.name},...s]),M("")}catch(t){alert((t==null?void 0:t.message)||"新增失敗")}},children:"新增"})]})]}),e.jsxs("ul",{className:"space-y-2",children:[E.map(t=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 rounded px-3 py-2",children:[e.jsx("span",{className:"text-sm text-gray-800",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-amber-700 hover:bg-amber-100 rounded px-2 py-1 text-sm",onClick:async()=>{const s=prompt("重新命名模組",t.name);if(s&&s!==t.name)try{await ce(t.id,s),f(a=>a.map(m=>m.id===t.id?{...m,name:s}:m))}catch(a){alert((a==null?void 0:a.message)||"更新失敗")}},children:"重新命名"}),e.jsx("button",{className:"text-red-700 hover:bg-red-100 rounded px-2 py-1 text-sm",onClick:async()=>{if(confirm(`確定刪除模組「${t.name}」？`))try{await oe(t.id),f(s=>s.filter(a=>a.id!==t.id))}catch(s){alert((s==null?void 0:s.message)||"刪除失敗")}},children:"刪除"})]})]},t.id)),E.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:"尚無模組"})]})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(V,{className:"h-5 w-5 mr-2 text-[#cc824d]"}),"最近變更"]}),e.jsxs("div",{className:"space-y-3",children:[l.slice(0,5).map((t,s)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.settingId}),e.jsx("span",{className:"text-xs text-gray-500",children:U(t.changedAt)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:t.changedBy})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"變更："}),e.jsx("span",{className:"text-red-600 line-through mr-2",children:String(t.oldValue)}),e.jsx("span",{className:"text-green-600",children:String(t.newValue)})]})]},s)),l.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"暫無變更記錄"})]})]})})]})]})})};export{Be as default};
