import{e as le,u as ce,r as w,j as e,A as u}from"./index-5be64975.js";import{I as de,P as me}from"./ImageUpload-68adf005.js";import{A as he,P as pe,C as ue,S as ge,a as xe}from"./AlertBox-2a4097d0.js";import{N as _e}from"./NestedSKUManager-d9e30a19.js";import{X as Y}from"./XMarkIcon-404a829f.js";import{P as Z}from"./PlusIcon-86b6a2f5.js";import{C as fe}from"./CubeIcon-717b6b1f.js";import{C as be}from"./ChevronRightIcon-bd983f70.js";import{C as ye}from"./CheckCircleIcon-3b5f52cb.js";import{I as je}from"./InformationCircleIcon-0b71784e.js";import{T as L}from"./TagIcon-a7572c43.js";import"./ChevronDownIcon-47739443.js";import"./CheckIcon-8874d163.js";import"./ExclamationTriangleIcon-5236f94b.js";import"./PencilIcon-0921d86f.js";import"./Cog6ToothIcon-88b00cb1.js";import"./TrashIcon-c73d815d.js";const ve={name:"",slug:"",shortDescription:"",categories:[],tags:[],promotionLabel:"",promotionLabelBgColor:"#CC824D",promotionLabelTextColor:"#FFFFFF",productTagBgColor:"#CC824D",productTagTextColor:"#FFFFFF",autoHideWhenOOS:!1,enablePreorder:!1,preorderStartAt:"",preorderEndAt:"",preorderMaxQty:"",price:"",comparePrice:"",costPrice:"",profit:"",profitMargin:"",baseSKU:"",hasVariants:!1,skuVariants:[],images:[],status:"draft",visibility:"visible",featured:!1,metaTitle:"",metaDescription:"",sitemapIndexing:!0,customCanonicalUrl:"",openGraphTitle:"",openGraphDescription:"",openGraphImage:"",useMetaTitleForOG:!0,useMetaDescriptionForOG:!0,excludeFromSearch:!1,searchTitle:"",searchDescription:"",searchImage:"",useMetaTitleForSearch:!0,useMetaDescriptionForSearch:!0,useOpenGraphImageForSearch:!0},Le=()=>{var J;const{sku:$}=le(),A=ce(),[m,V]=w.useState(null),[R,P]=w.useState(!0),[D,B]=w.useState(null);w.useEffect(()=>{$&&(async()=>{try{P(!0);const g=await fetch("/backend/products",{credentials:"include"});if(!g.ok)throw new Error("Failed to fetch products");const S=(await g.json()||[]).find(d=>d.base_sku===$);if(!S){B(`找不到 SKU: ${$} 的商品`),P(!1);return}const C=await fetch(`/backend/products/${S.id}`,{credentials:"include"});if(!C.ok)V(S);else{const d=await C.json();V(d)}}catch(g){B(g.message)}finally{P(!1)}})()},[$]);const O=w.useCallback(t=>{if(!t)return{...ve};let g=[];const x=t.prices||[],S=t.inventory||[];if(S.length>0){const b=new Map(x.map(f=>[f.sku_key,f])),_=Array.isArray(t.variant_photos)?t.variant_photos:[],a=new Map;for(const f of S){const r=f.sku_key||null;a.has(r)||a.set(r,f)}for(const[f,r]of a.entries()){if(!f)continue;const v=b.get(f),N=[];for(let l=1;l<=5;l++){const n=r[`sku_level_${l}_name`]||r[`sku_level_${l}`],h=r[`spec_level_${l}_name`]||(n?`層級${l}`:null),c=r[`sku_level_${l}`]||"";n&&h&&N.push({level:h,option:n,code:c})}const i=[],o=[r.variant_photo_url_1,r.variant_photo_url_2,r.variant_photo_url_3].filter(Boolean);if(o.length>0)o.forEach((l,n)=>{i.push({id:`vimg_${r.id}_${n+1}`,url:l,name:`variant-${n+1}.jpg`,size:0,type:"image/jpeg"})});else{const l=_.find(n=>n.inventory_id===r.id);l&&[l.variant_photo_url_1,l.variant_photo_url_2,l.variant_photo_url_3].filter(Boolean).forEach((h,c)=>{i.push({id:`vimg_${r.id}_${c+1}`,url:h,name:`variant-${c+1}.jpg`,size:0,type:"image/jpeg"})})}g.push({sku:f,name:N.length>0?N[N.length-1].option:f,path:N,pathDisplay:N.map(l=>`${l.level}: ${l.option}`).join(" → "),price:(v==null?void 0:v.sale_price)??"",comparePrice:(v==null?void 0:v.compare_at_price)??"",costPrice:(v==null?void 0:v.cost_price)??"",quantity:r.current_stock_qty??"",barcode:r.barcode??"",hsCode:r.hs_code??"",origin:r.origin??"",isActive:!0,trackQuantity:!0,allowBackorder:!1,lowStockThreshold:r.low_stock_threshold??"",weight:r.weight??"",dimensions:{length:r.length_cm??"",width:r.width_cm??"",height:r.height_cm??""},config:{weight:r.weight??"",dimensions:{length:r.length_cm??"",width:r.width_cm??"",height:r.height_cm??""},isActive:!0,hsCode:r.hs_code??"",origin:r.origin??"",note:r.notes??"",variantImages:i}})}}else if(x.length>0){const b=new Map(S.map(_=>[_.sku_key,_]));for(const _ of x){const a=b.get(_.sku_key),f=[];if(a)for(let r=1;r<=5;r++){const v=a[`sku_level_${r}_name`]||a[`sku_level_${r}`],N=a[`spec_level_${r}_name`]||(v?`層級${r}`:null),i=a[`sku_level_${r}`]||"";v&&N&&f.push({level:N,option:v,code:i})}g.push({sku:_.sku_key||t.base_sku,name:f.length>0?f[f.length-1].option:_.sku_key||t.base_sku,path:f,pathDisplay:f.map(r=>`${r.level}: ${r.option}`).join(" → "),price:_.sale_price??"",comparePrice:_.compare_at_price??"",costPrice:_.cost_price??"",quantity:(a==null?void 0:a.current_stock_qty)??"",barcode:(a==null?void 0:a.barcode)??"",hsCode:(a==null?void 0:a.hs_code)??"",origin:(a==null?void 0:a.origin)??"",isActive:!0,trackQuantity:!0,allowBackorder:!1,lowStockThreshold:(a==null?void 0:a.low_stock_threshold)??"",weight:(a==null?void 0:a.weight)??"",dimensions:{length:(a==null?void 0:a.length_cm)??"",width:(a==null?void 0:a.width_cm)??"",height:(a==null?void 0:a.height_cm)??""},config:{weight:(a==null?void 0:a.weight)??"",dimensions:{length:(a==null?void 0:a.length_cm)??"",width:(a==null?void 0:a.width_cm)??"",height:(a==null?void 0:a.height_cm)??""},isActive:!0,hsCode:(a==null?void 0:a.hs_code)??"",origin:(a==null?void 0:a.origin)??"",note:(a==null?void 0:a.notes)??"",variantImages:[]}})}}let C=[];if(t.photos)for(let b=1;b<=10;b++){const _=t.photos[`photo_url_${b}`];_&&C.push({id:`photo_${b}`,url:_,name:`image-${b}.jpg`,size:0,type:"image/jpeg"})}else Array.isArray(t.images)?C=t.images.map((b,_)=>({id:b.id||Date.now()+_,url:b.url||b,name:b.name||`image-${_}.jpg`,size:b.size||0,type:b.type||"image/jpeg"})):t.image&&(C=[{id:Date.now(),url:t.image,name:"cover.jpg",size:0,type:"image/jpeg"}]);const d=t.seo||{};return{name:t.name||"",slug:t.slug||"",description:t.description||"",shortDescription:t.short_description||"",categories:Array.isArray(t.category_ids)?t.category_ids:[],tags:Array.isArray(t.tags)?t.tags:[],promotionLabel:t.promotion_label||"",promotionLabelBgColor:t.promotion_label_bg_color||"#CC824D",promotionLabelTextColor:t.promotion_label_text_color||"#FFFFFF",productTagBgColor:t.product_tag_bg_color||"#CC824D",productTagTextColor:t.product_tag_text_color||"#FFFFFF",autoHideWhenOOS:!!t.auto_hide_when_oos,enablePreorder:!!t.enable_preorder,preorderStartAt:t.preorder_start_at?new Date(t.preorder_start_at).toISOString().slice(0,16):"",preorderEndAt:t.preorder_end_at?new Date(t.preorder_end_at).toISOString().slice(0,16):"",preorderMaxQty:t.preorder_max_qty??"",price:t.price??"",comparePrice:t.compare_at_price??"",costPrice:t.cost_price??"",profit:t.profit??"",profitMargin:t.profit_margin??"",baseSKU:t.base_sku||"",hasVariants:t.has_variants||g.length>0,skuVariants:g,images:C,status:t.status||"draft",visibility:t.visibility||"visible",featured:!!t.is_featured,metaTitle:d.meta_title||t.meta_title||"",metaDescription:d.meta_description||t.meta_description||"",sitemapIndexing:d.sitemap_indexing!==void 0?!!d.sitemap_indexing:t.sitemap_indexing!==!1,customCanonicalUrl:d.custom_canonical_url||t.custom_canonical_url||"",openGraphTitle:d.og_title||t.open_graph_title||"",openGraphDescription:d.og_description||t.open_graph_description||"",openGraphImage:d.og_image_url||t.open_graph_image||"",useMetaTitleForOG:d.use_meta_title_for_og!==void 0?!!d.use_meta_title_for_og:t.use_meta_title_for_og!==!1,useMetaDescriptionForOG:d.use_meta_description_for_og!==void 0?!!d.use_meta_description_for_og:t.use_meta_description_for_og!==!1,excludeFromSearch:d.exclude_from_search!==void 0?!!d.exclude_from_search:!!t.exclude_from_search,searchTitle:d.search_title||t.search_title||"",searchDescription:d.search_description||t.search_description||"",searchImage:d.search_image_url||t.search_image||"",useMetaTitleForSearch:d.use_meta_title_for_search!==void 0?!!d.use_meta_title_for_search:t.use_meta_title_for_search!==!1,useMetaDescriptionForSearch:d.use_meta_description_for_search!==void 0?!!d.use_meta_description_for_search:t.use_meta_description_for_search!==!1,useOpenGraphImageForSearch:d.use_og_image_for_search!==void 0?!!d.use_og_image_for_search:t.use_open_graph_image_for_search!==!1}},[]),[k,U]=w.useState(0),[s,G]=w.useState(O(m)),[j,K]=w.useState({}),[M,z]=w.useState(""),[q,ee]=w.useState([]),[F,I]=w.useState({show:!1,message:"",type:"warning"});w.useEffect(()=>{m&&G(O(m))},[m,O]);const T=[{id:"basic",title:"基本資訊",description:"設定產品名稱、描述和基礎 SKU",icon:je,isCompleted:!1},{id:"variants",title:"SKU 變體管理",description:"設定五層巢狀 SKU 變體和庫存",icon:L,isCompleted:!1},{id:"categories",title:"商品分類",description:"設定商品分類歸屬",icon:L,isCompleted:!1},{id:"media",title:"圖片媒體",description:"上傳產品圖片和媒體",icon:me,isCompleted:!1},{id:"seo",title:"SEO 設定",description:"搜尋引擎優化設定",icon:L,isCompleted:!1}],p=(t,g)=>{G(x=>({...x,[t]:g})),j[t]&&K(x=>({...x,[t]:null}))},te=(t,g)=>p(t,g),H=()=>{M.trim()&&(p("tags",[M.trim()]),z(""))},se=t=>p("tags",s.tags.filter(g=>g!==t)),ae=t=>{U(t),K({})},E=t=>t?t.toLowerCase().trim().replace(/[\u4e00-\u9fff]/g,g=>`char-${g.charCodeAt(0)}`).replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").substring(0,50):"",Q=t=>{const g=T[t],x={};switch(g.id){case"basic":s.name.trim()||(x.name="產品名稱為必填項目"),s.slug.trim()?/^[a-z0-9-]+$/.test(s.slug)||(x.slug="路由只能包含小寫英文、數字和連字符"):x.slug="產品路由為必填項目",s.description.trim()||(x.description="產品描述為必填項目"),s.baseSKU.trim()?/^[a-z0-9]+$/.test(s.baseSKU)||(x.baseSKU="基礎 SKU 只能包含小寫英文和數字"):x.baseSKU="基礎 SKU 為必填項目";break;case"variants":s.hasVariants&&(s.skuVariants||[]).length===0&&(x.skuVariants="請設定至少一個 SKU 變體");break}return K(x),Object.keys(x).length===0},re=()=>{Q(k)&&(q.includes(k)||ee(t=>[...t,k]),U(t=>Math.min(t+1,T.length-1)))},oe=()=>U(t=>Math.max(t-1,0)),ie=async()=>{var t,g,x,S,C,d,b,_,a,f;for(let r=0;r<T.length;r++)if(!Q(r)){U(r);return}try{I({show:!0,type:"warning",message:"正在保存..."});const r=(Array.isArray(s.categories)?s.categories:[]).filter(i=>i!=null&&i!=="").map(i=>i!==null&&typeof i=="object"?i.id??i.value??i:i).map(i=>typeof i=="string"&&/^\d+$/.test(i)?Number(i):i).filter(i=>typeof i=="number"&&Number.isFinite(i)),v={name:s.name,slug:s.slug,description:s.description,short_description:s.shortDescription,status:s.status,visibility:s.visibility,is_featured:!!s.featured,has_variants:s.hasVariants,base_sku:s.baseSKU,tags:Array.isArray(s.tags)?s.tags:[],promotion_label:s.promotionLabel||null,promotion_label_bg_color:s.promotionLabelBgColor||null,promotion_label_text_color:s.promotionLabelTextColor||null,product_tag_bg_color:s.productTagBgColor||null,product_tag_text_color:s.productTagTextColor||null,auto_hide_when_oos:!!s.autoHideWhenOOS,enable_preorder:!!s.enablePreorder,preorder_start_at:s.preorderStartAt?new Date(s.preorderStartAt).toISOString():null,preorder_end_at:s.preorderEndAt?new Date(s.preorderEndAt).toISOString():null,preorder_max_qty:s.preorderMaxQty===""?null:Number(s.preorderMaxQty),meta_title:s.metaTitle,meta_description:s.metaDescription,open_graph_title:s.openGraphTitle,open_graph_description:s.openGraphDescription,open_graph_image:s.openGraphImage,search_title:s.searchTitle,search_description:s.searchDescription,search_image:s.searchImage,sitemap_indexing:!!s.sitemapIndexing,custom_canonical_url:s.customCanonicalUrl||null,use_meta_title_for_og:!!s.useMetaTitleForOG,use_meta_description_for_og:!!s.useMetaDescriptionForOG,use_meta_title_for_search:!!s.useMetaTitleForSearch,use_meta_description_for_search:!!s.useMetaDescriptionForSearch,use_og_image_for_search:!!s.useOpenGraphImageForSearch,exclude_from_search:!!s.excludeFromSearch};r.length>0&&(v.category_ids=r);const N=await fetch(`/backend/products/${m.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(v)});if(!N.ok){let i="";try{i=((t=await N.json())==null?void 0:t.error)||""}catch{}throw new Error(`更新商品基本信息失敗${i?`：${i}`:""}`)}if(s.images&&s.images.length>0){const i=[],o=[];for(let n=0;n<s.images.length;n++){const h=s.images[n];h.file||h instanceof File?i.push(h.file||h):h.url&&o.push(h.url)}const l=[...o];if(i.length>0)for(const n of i){const h=new FormData;h.append("file",n);const c=await fetch(`/backend/products/${m.id}/storage-upload`,{method:"POST",credentials:"include",body:h});if(c.ok){const{url:y}=await c.json();l.push(y)}}if(l.length>0){const n={};for(let c=0;c<10;c++)n[`photo_url_${c+1}`]=l[c]||null;(await fetch(`/backend/products/${m.id}/photos`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)})).ok||console.warn("更新商品圖片失敗")}}if(s.hasVariants&&s.skuVariants&&s.skuVariants.length>0){if(m.inventory&&m.inventory.length>0)for(const o of m.inventory)await fetch(`/backend/products/${m.id}/inventory/${o.id}`,{method:"DELETE",credentials:"include"}).catch(l=>console.warn("刪除舊庫存記錄失敗:",l));if(m.prices&&m.prices.length>0)for(const o of m.prices)await fetch(`/backend/products/${m.id}/prices/${o.id}`,{method:"DELETE",credentials:"include"}).catch(l=>console.warn("刪除舊定價記錄失敗:",l));const i=new Map;for(const o of s.skuVariants){if(!o.isActive)continue;{const n={sku_key:o.sku||null,warehouse:"主倉",current_stock_qty:parseInt(o.quantity)||0,safety_stock_qty:o.lowStockThreshold?parseInt(o.lowStockThreshold):10,low_stock_threshold:o.lowStockThreshold?parseInt(o.lowStockThreshold):5,track_inventory:o.trackQuantity!==!1,allow_backorder:o.allowBackorder===!0,allow_preorder:!1,barcode:o.barcode||null,hs_code:o.hsCode||null,origin:o.origin||null,weight:o.weight!==void 0&&o.weight!==""?parseFloat(o.weight):null,length_cm:(g=o.dimensions)!=null&&g.length?parseFloat(o.dimensions.length):null,width_cm:(x=o.dimensions)!=null&&x.width?parseFloat(o.dimensions.width):null,height_cm:(S=o.dimensions)!=null&&S.height?parseFloat(o.dimensions.height):null};if(o.path&&Array.isArray(o.path))for(let c=0;c<5;c++){const y=o.path[c];y?(n[`sku_level_${c+1}`]=y.option||null,n[`sku_level_${c+1}_name`]=y.option||null,n[`spec_level_${c+1}_name`]=y.level||null):(n[`sku_level_${c+1}`]=null,n[`sku_level_${c+1}_name`]=null,n[`spec_level_${c+1}_name`]=null)}else for(let c=0;c<5;c++)n[`sku_level_${c+1}`]=null,n[`sku_level_${c+1}_name`]=null,n[`spec_level_${c+1}_name`]=null;const h=await fetch(`/backend/products/${m.id}/inventory`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}).catch(c=>console.warn("創建庫存記錄失敗:",c));try{if(h&&h.ok){const c=await h.json();c&&o.sku&&i.set(o.sku,c.id)}}catch{}}if(o.price){const n={sku_key:o.sku!==s.baseSKU?o.sku:null,sale_price:parseFloat(o.price)||0,compare_at_price:parseFloat(o.comparePrice)||null,cost_price:parseFloat(o.costPrice)||null};await fetch(`/backend/products/${m.id}/prices`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}).catch(h=>console.warn("創建定價記錄失敗:",h))}const l=Array.isArray((C=o.config)==null?void 0:C.variantImages)?o.config.variantImages:[];if(l.length>0){const n=i.get(o.sku);if(n){const h=[];for(const y of l.slice(0,3))if(y!=null&&y.file){const W=new FormData;W.append("file",y.file);const X=await fetch(`/backend/products/${m.id}/variant-photos/${n}/upload`,{method:"POST",credentials:"include",body:W});if(X.ok){const{url:ne}=await X.json();h.push(ne)}}else y!=null&&y.url&&h.push(y.url);const c={variant_photo_url_1:h[0]||null,variant_photo_url_2:h[1]||null,variant_photo_url_3:h[2]||null};await fetch(`/backend/products/${m.id}/variant-photos/${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}).catch(y=>console.warn("更新變體圖片失敗:",y))}}}}else if(!s.hasVariants){const i=(d=m.inventory)==null?void 0:d.find(l=>!l.sku_key),o=(b=m.prices)==null?void 0:b.find(l=>!l.sku_key);if(i){const l=await fetch(`/backend/products/${m.id}/inventory/${i.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({current_stock_qty:parseInt(s.quantity)||0,barcode:s.barcode||null,hs_code:s.hsCode||null,origin:s.origin||null,weight:s.weight!==void 0&&s.weight!==""?parseFloat(s.weight):null,length_cm:(_=s.dimensions)!=null&&_.length?parseFloat(s.dimensions.length):null,width_cm:(a=s.dimensions)!=null&&a.width?parseFloat(s.dimensions.width):null,height_cm:(f=s.dimensions)!=null&&f.height?parseFloat(s.dimensions.height):null})}).catch(n=>console.warn("更新庫存記錄失敗:",n))}o&&await fetch(`/backend/products/${m.id}/prices/${o.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({sale_price:parseFloat(s.price)||0,compare_at_price:parseFloat(s.comparePrice)||null,cost_price:parseFloat(s.costPrice)||null})}).catch(l=>console.warn("更新定價記錄失敗:",l))}I({show:!0,type:"success",title:"儲存成功",message:`商品「${s.name}」已更新。`}),setTimeout(()=>A("/products"),1200)}catch(r){console.error("保存失敗:",r),I({show:!0,type:"error",title:"儲存失敗",message:r.message||"更新時發生錯誤，請稍後重試。"})}};return R?e.jsx("div",{className:u.pageContainer,children:e.jsx("div",{className:u.contentContainerFluid,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"正在加載商品信息..."}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["SKU: ",$]})]})})}):D||!m?e.jsx("div",{className:u.pageContainer,children:e.jsx("div",{className:u.contentContainerFluid,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"找不到此商品"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["SKU: ",$]}),D&&e.jsx("p",{className:"text-red-600 mt-2",children:D}),e.jsx("button",{onClick:()=>A("/products"),className:"mt-6 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800",children:"返回商品列表"})]})})}):e.jsx("div",{className:u.pageContainer,children:e.jsxs("div",{className:u.contentContainerFluid,children:[e.jsx(he,{show:F.show,onClose:()=>I({...F,show:!1}),title:F.title,message:F.message,type:F.type,autoClose:F.type==="success"?3e3:0}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"w-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"編輯商品"}),e.jsxs("p",{className:"text-gray-600 font-chinese mt-1",children:["SKU：",e.jsx("span",{className:"font-mono",children:s.baseSKU})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1 bg-[#cc824d]/10 text-[#cc824d] rounded-full text-sm font-medium",children:["步驟 ",k+1," / ",T.length,": ",(J=T[k])==null?void 0:J.title]})})]}),e.jsx("div",{className:"flex-1",children:e.jsx(pe,{steps:T,currentStep:k,onStepClick:ae,completedSteps:q,compact:!0})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-8",children:[k===0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:u.sectionTitle,children:"基本資訊"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品名稱 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",id:"name",value:s.name,onChange:t=>{if(p("name",t.target.value),!s.slug||s.slug===E(s.name)){const g=E(t.target.value);p("slug",g)}},className:`${u.input} ${j.name?"border-red-500":""}`,placeholder:"輸入產品名稱"}),j.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品路由 (Slug) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",name:"slug",id:"slug",value:s.slug,onChange:t=>p("slug",t.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-")),className:`${u.input} ${j.slug?"border-red-500":""}`,placeholder:"product-slug",pattern:"[a-z0-9-]+"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"/products/"})})]}),e.jsx("button",{type:"button",onClick:()=>p("slug",E(s.name)),className:"px-3 py-2 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors",disabled:!s.name,children:"自動生成"})]}),j.slug&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.slug}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["產品網址將是: ",window.location.origin,"/products/",s.slug||"product-slug"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["基礎 SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"baseSKU",id:"baseSKU",value:s.baseSKU,onChange:t=>p("baseSKU",t.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")),className:`${u.input} ${j.baseSKU?"border-red-500":""}`,placeholder:"例如：iphone",maxLength:20}),j.baseSKU&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.baseSKU}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["基礎 SKU 將作為所有變體的前綴，例如：",s.baseSKU||"iphone","bkpro"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"簡短描述"}),e.jsx("input",{type:"text",value:s.shortDescription,onChange:t=>p("shortDescription",t.target.value),className:u.input,placeholder:"一句話描述產品特色"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品描述 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"description",id:"description",value:s.description,onChange:t=>p("description",t.target.value),rows:4,className:`${u.input} ${j.description?"border-red-500":""}`,placeholder:"詳細描述產品功能、特色和使用方法"}),j.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品標籤"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:s.tags.map(t=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm",style:{background:s.productTagBgColor,color:s.productTagTextColor},children:[t,e.jsx("button",{type:"button",onClick:()=>se(t),className:"ml-2",style:{color:s.productTagTextColor},children:e.jsx(Y,{className:"w-4 h-4"})})]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:M,onChange:t=>z(t.target.value),onKeyPress:t=>t.key==="Enter"&&(t.preventDefault(),H()),className:u.input,placeholder:"輸入標籤名稱"}),e.jsx("button",{type:"button",onClick:H,className:u.btnSecondary,children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"產品標籤背景色"}),e.jsx("input",{type:"color",value:s.productTagBgColor,onChange:t=>p("productTagBgColor",t.target.value),className:"w-16 h-10 p-0 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"產品標籤字體色"}),e.jsx("input",{type:"color",value:s.productTagTextColor,onChange:t=>p("productTagTextColor",t.target.value),className:"w-16 h-10 p-0 border rounded"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"優惠標籤"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-end",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.promotionLabel,onChange:t=>p("promotionLabel",t.target.value),className:`flex-1 ${u.input}`,placeholder:"如：滿千折百 / 限時優惠"}),e.jsx("button",{type:"button",onClick:()=>p("promotionLabel",(s.promotionLabel||"").trim()),className:u.btnSecondary,title:"新增優惠標籤",children:e.jsx(Z,{className:"w-4 h-4"})}),s.promotionLabel&&e.jsx("button",{type:"button",onClick:()=>p("promotionLabel",""),className:u.btnSecondary,title:"清除優惠標籤",children:e.jsx(Y,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"text-right",children:s.promotionLabel&&e.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-sm",style:{background:s.promotionLabelBgColor,color:s.promotionLabelTextColor},children:s.promotionLabel})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"優惠標籤背景色"}),e.jsx("input",{type:"color",value:s.promotionLabelBgColor,onChange:t=>p("promotionLabelBgColor",t.target.value),className:"w-16 h-10 p-0 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"優惠標籤字體色"}),e.jsx("input",{type:"color",value:s.promotionLabelTextColor,onChange:t=>p("promotionLabelTextColor",t.target.value),className:"w-16 h-10 p-0 border rounded"})]})]})]}),e.jsxs("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"缺貨與預購"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"autoHideWhenOOS",className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded focus:ring-[#cc824d]",checked:s.autoHideWhenOOS,onChange:t=>p("autoHideWhenOOS",t.target.checked)}),e.jsx("span",{className:"text-sm text-gray-700",children:"缺貨自動下架"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enablePreorder",className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded focus:ring-[#cc824d]",checked:s.enablePreorder,onChange:t=>p("enablePreorder",t.target.checked)}),e.jsx("span",{className:"text-sm text-gray-700",children:"啟用預購"})]}),s.enablePreorder&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",htmlFor:"preorderStartAt",children:"預購開始時間"}),e.jsx("input",{id:"preorderStartAt",type:"datetime-local",value:s.preorderStartAt,onChange:t=>p("preorderStartAt",t.target.value),className:u.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",htmlFor:"preorderEndAt",children:"預購結束時間"}),e.jsx("input",{id:"preorderEndAt",type:"datetime-local",value:s.preorderEndAt,onChange:t=>p("preorderEndAt",t.target.value),className:u.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",htmlFor:"preorderMaxQty",children:"最大預購數"}),e.jsx("input",{id:"preorderMaxQty",type:"number",min:"0",value:s.preorderMaxQty,onChange:t=>p("preorderMaxQty",t.target.value),className:u.input,placeholder:"例如 100"})]})]})]})]})]})]})]}),k===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:u.sectionTitle,children:"SKU 變體管理"}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"hasVariants",checked:s.hasVariants,onChange:t=>p("hasVariants",t.target.checked),className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded focus:ring-[#cc824d]"}),e.jsx("label",{htmlFor:"hasVariants",className:"ml-2 text-sm text-gray-700",children:"此產品有多個 SKU 變體 (如不同顏色、尺寸、規格等)"})]}),!s.hasVariants&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"此商品為單一 SKU 商品"}),e.jsx("p",{className:"text-sm text-gray-500",children:"如果商品有不同的變體選項，請勾選上方的變體選項"}),s.baseSKU&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded border",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"商品 SKU:"}),e.jsx("p",{className:"font-mono text-lg text-[#cc824d]",children:s.baseSKU})]})]}),s.hasVariants&&e.jsx(_e,{baseSKU:s.baseSKU,skuVariants:s.skuVariants,onChange:t=>p("skuVariants",t),productName:s.name,productCategories:s.categories,productId:m==null?void 0:m.id}),j.skuVariants&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.skuVariants})]})]}),k===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:u.sectionTitle,children:"商品分類"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"選擇商品分類 (可複選)"}),e.jsx(ue,{selectedCategories:s.categories,onChange:t=>p("categories",t)})]})]}),k===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:u.sectionTitle,children:"圖片媒體"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品圖片"}),e.jsx(de,{images:s.images,onChange:t=>p("images",t),maxImages:10})]})]}),k===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:u.sectionTitle,children:"SEO 設定"}),e.jsx(ge,{productData:s,onChange:te,errors:j,categories:s.categories})]})]}),e.jsxs("div",{className:"border-t border-gray-200 px-8 py-6 flex items-center justify-between bg-gray-50 rounded-b-xl",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>A("/products"),className:u.btnSecondary,children:"取消"}),k>0&&e.jsxs("button",{type:"button",onClick:oe,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," 上一步"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["步驟 ",k+1," / ",T.length]}),e.jsx("div",{className:"flex space-x-3",children:k<T.length-1?e.jsxs("button",{type:"button",onClick:re,className:"inline-flex items-center px-6 py-2 bg-[#cc824d] text-white rounded-lg text-sm font-medium hover:bg-[#b86c37] transition-colors shadow-sm",children:["下一步 ",e.jsx(be,{className:"w-4 h-4 ml-2"})]}):e.jsxs("button",{type:"button",onClick:ie,className:"inline-flex items-center px-8 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"})," 儲存變更"]})})]})]})]})]})})};export{Le as default};
