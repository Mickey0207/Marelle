import{r,g as J,j as t,c as K}from"./index-5be64975.js";import{c as k,C as Q}from"./chevron-down-e41c1b61.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Y=k("check",U);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],O=k("search",Z);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],T=k("x",ee),te=({options:N=[],value:u="",onChange:y=()=>{},placeholder:L="請選擇...",searchPlaceholder:z="搜尋選項...",className:P="",disabled:$=!1,allowClear:_=!1,multiple:l=!1,maxDisplayOptions:se=10,createNewOption:C=null})=>{const[o,v]=r.useState(!1),[c,b]=r.useState(""),[S,q]=r.useState(N),[n,f]=r.useState(l?Array.isArray(u)?u:[]:[u]),[j,I]=r.useState({top:0,left:0,width:0,mode:"fixed"}),[R,M]=r.useState(null),m=r.useRef(null),V=r.useRef(null),g=r.useRef(null),W=e=>e.map(s=>typeof s=="string"?{value:s,label:s}:s),h=r.useMemo(()=>W(N),[N]);r.useEffect(()=>{const e=h.filter(s=>s.label.toLowerCase().includes(c.toLowerCase())||s.value.toLowerCase().includes(c.toLowerCase()));q(e)},[c,h]),r.useEffect(()=>{f(l?Array.isArray(u)?u:[]:[u])},[u,l]);const d=()=>{if(m.current){const e=m.current.getBoundingClientRect(),s=window.innerHeight,a=300;let i=R;if(!i){const w=m.current.closest(".glass-modal-root");i=(w?w.querySelector(".glass-modal-portal"):null)||document.body,M(i)}let x=e.bottom+2,p=e.left,F="fixed";if(i&&i!==document.body){const w=i.getBoundingClientRect();x=e.bottom-w.top+2,p=e.left-w.left,F="absolute"}else x+a>s&&(x=e.top-a-2),p+e.width>window.innerWidth&&(p=window.innerWidth-e.width-10),p<10&&(p=10),x=Math.max(x,10);I({top:x,left:p,width:e.width,mode:F})}},H=()=>{$||(o?v(!1):(v(!0),requestAnimationFrame(()=>{d()})))};r.useEffect(()=>{if(o&&g.current){d();let e=requestAnimationFrame(d),s=requestAnimationFrame(d);const a=setTimeout(d,200);return J.fromTo(g.current,{opacity:0,y:-10,scale:.95},{opacity:1,y:0,scale:1,duration:.2,ease:"power2.out"}),()=>{cancelAnimationFrame(e),cancelAnimationFrame(s),clearTimeout(a)}}},[o]),r.useEffect(()=>{const e=i=>{m.current&&!m.current.contains(i.target)&&g.current&&!g.current.contains(i.target)&&(v(!1),b(""))},s=()=>{o&&d()},a=()=>{o&&d()};return o&&(document.addEventListener("mousedown",e),document.addEventListener("scroll",s,!0),window.addEventListener("scroll",s),window.addEventListener("resize",a),requestAnimationFrame(d)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("scroll",s,!0),window.removeEventListener("scroll",s),window.removeEventListener("resize",a)}},[o]);const E=e=>{if(l){const s=n.includes(e.value)?n.filter(a=>a!==e.value):[...n,e.value];f(s),y(s)}else f([e.value]),y(e.value),v(!1),b("")},B=e=>{e.stopPropagation(),l?(f([]),y([])):(f([""]),y(""))},X=()=>{if(C&&c.trim()){const e=C(c.trim());e&&(E(e),b(""))}},G=()=>{if(l){if(n.length===0)return L;if(n.length===1){const e=h.find(s=>s.value===n[0]);return e?e.label:n[0]}return`已選擇 ${n.length} 項`}else{if(!n[0])return L;const e=h.find(s=>s.value===n[0]);return e?e.label:n[0]}},A=e=>n.includes(e),D=C&&c.trim()&&!S.some(e=>e.label.toLowerCase()===c.toLowerCase());return t.jsxs("div",{ref:m,className:`relative ${P}`,style:{zIndex:o?9999:"auto"},children:[t.jsxs("div",{onClick:H,className:`
          relative w-full px-4 py-2.5 bg-white border border-gray-300 rounded-lg 
          cursor-pointer transition-all duration-200 font-chinese
          glass-light hover:border-button-300 hover:shadow-md
          ${$?"opacity-50 cursor-not-allowed":""}
          ${o?"border-button-500 shadow-lg ring-2 ring-button-100":""}
        `,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 truncate",children:[!l&&n[0]&&(()=>{const e=h.find(s=>s.value===n[0]);return e!=null&&e.icon?t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4",children:e.icon}):null})(),t.jsx("span",{className:`truncate ${!n[0]&&!l?"text-gray-500":"text-gray-900"}`,children:G()})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[_&&(n[0]||l&&n.length>0)&&t.jsx("button",{onClick:B,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",type:"button",children:t.jsx(T,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})}),t.jsx(Q,{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${o?"transform rotate-180":""}`})]})]}),l&&n.length>1&&t.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[n.slice(0,3).map(e=>{const s=h.find(a=>a.value===e);return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-button-100 text-button-800 text-xs rounded-full",children:[s?s.label:e,t.jsx("button",{onClick:a=>{a.stopPropagation(),E({value:e})},className:"hover:bg-button-200 rounded-full p-0.5",children:t.jsx(T,{className:"w-3 h-3"})})]},e)}),n.length>3&&t.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",n.length-3," 更多"]})]})]}),o&&K.createPortal(t.jsxs("div",{ref:g,className:`glass-dropdown ${j.mode==="fixed"?"fixed":"absolute"} z-[200000] pointer-events-auto`,style:{top:`${j.top}px`,left:`${j.left}px`,width:`${j.width}px`,zIndex:2e5,minWidth:"200px"},children:[t.jsx("div",{className:"glass-dropdown-search",children:t.jsxs("div",{className:"relative",children:[t.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4 z-10"}),t.jsx("input",{ref:V,type:"text",value:c,onChange:e=>b(e.target.value),placeholder:z,className:"font-chinese",autoFocus:!0})]})}),t.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[D&&t.jsxs("button",{onClick:X,className:"glass-dropdown-create font-chinese group",children:[t.jsx("div",{className:"w-4 h-4 border-2 rounded-full flex items-center justify-center transition-colors",style:{borderColor:"#CC824D"},children:t.jsx("div",{className:"w-1 h-1 rounded-full transition-colors",style:{backgroundColor:"#CC824D"}})}),t.jsxs("span",{className:"group-hover:text-orange-800",children:['創建 "',c,'"']})]}),S.map(e=>t.jsxs("button",{onClick:()=>E(e),className:`glass-dropdown-option font-chinese ${A(e.value)?"selected":""}`,children:[t.jsxs("span",{className:"truncate flex items-center gap-2",children:[e.icon&&t.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4",children:e.icon}),t.jsx("span",{className:"truncate",children:e.label})]}),A(e.value)&&t.jsx(Y,{className:"w-4 h-4 flex-shrink-0 ml-2",style:{color:"#CC824D"}})]},e.value)),S.length===0&&!D&&t.jsxs("div",{className:"glass-dropdown-empty font-chinese",children:[t.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{className:"text-sm",children:"沒有找到符合的選項"})]})]})]}),R||document.body)]})},oe=te;export{oe as S};
