import{r as l,j as t,A as h}from"./index-5be64975.js";import{S as y}from"./StandardTable-046e436b.js";import{S as d}from"./SearchableSelect-06cd3eb3.js";import{G as f}from"./GlassModal-8d9cbd14.js";import{g,E as m,a as j,S,D as v}from"./dataManager-5e949847.js";import{I as N}from"./IconActionButton-2bcd0b2a.js";import{S as E}from"./Charts-5dd86497.js";import{E as k}from"./EyeIcon-db27fda4.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";const V=()=>{const[a,n]=l.useState({types:[],sources:[],devices:[]}),[i,p]=l.useState(null),r=l.useMemo(()=>g(a),[a]),[c,u]=l.useState("table"),x=l.useMemo(()=>{const e=new Map;for(const s of r){const o=m[s.type]||s.type;e.set(o,(e.get(o)||0)+1)}return Array.from(e.entries()).map(([s,o])=>({type:s,value:o}))},[r]),b=[{key:"ts",label:"時間",sortable:!0,render:e=>new Date(e).toLocaleString("zh-TW")},{key:"type",label:"事件",sortable:!0,render:e=>m[e]||e},{key:"userId",label:"用戶",sortable:!0},{key:"sessionId",label:"會話",sortable:!0},{key:"source",label:"來源",sortable:!0},{key:"device",label:"裝置",sortable:!0},{key:"path",label:"路徑/商品",sortable:!0,render:(e,s)=>s.path||s.productId||"-"},{key:"value",label:"金額",sortable:!0,render:e=>e!=null?`NT$${Number(e).toLocaleString()}`:"-"},{key:"actions",label:"操作",render:(e,s)=>t.jsx(N,{Icon:k,label:"詳情",variant:"blue",onClick:()=>p(s)})}];return t.jsx("div",{className:"bg-[#fdf8f2] min-h-screen",children:t.jsxs("div",{className:h.contentContainerFluid,children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese mb-6",children:"事件流"}),t.jsxs("div",{className:"glass rounded-2xl p-4 mb-4 flex flex-wrap gap-4 items-center",children:[t.jsx(d,{multiple:!0,placeholder:"事件類型",options:j.map(e=>({value:e,label:m[e]||e})),value:a.types,onChange:e=>n(s=>({...s,types:e}))}),t.jsx(d,{multiple:!0,placeholder:"來源",options:S.map(e=>({value:e,label:e})),value:a.sources,onChange:e=>n(s=>({...s,sources:e}))}),t.jsx(d,{multiple:!0,placeholder:"裝置",options:v.map(e=>({value:e,label:e})),value:a.devices,onChange:e=>n(s=>({...s,devices:e}))})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["共 ",r.length," 筆"]}),t.jsxs("div",{className:"space-x-2",children:[t.jsx("button",{className:`px-3 py-1 rounded text-sm ${c==="table"?"bg-[#cc824d] text-white":"border text-gray-700"}`,onClick:()=>u("table"),children:"表格"}),t.jsx("button",{className:`px-3 py-1 rounded text-sm ${c==="chart"?"bg-[#cc824d] text-white":"border text-gray-700"}`,onClick:()=>u("chart"),children:"圖表"})]})]}),c==="table"?t.jsx(y,{data:r,columns:b,title:"事件列表",exportFileName:"事件列表"}):t.jsx("div",{className:"glass rounded-2xl p-4",children:t.jsx(E,{data:x,xField:"type",yField:"value"})}),t.jsx(f,{isOpen:!!i,onClose:()=>p(null),title:"事件詳情",size:"max-w-3xl",children:t.jsx("pre",{className:"text-xs whitespace-pre-wrap break-all",children:i?JSON.stringify(i,null,2):""})})]})})};export{V as default};
