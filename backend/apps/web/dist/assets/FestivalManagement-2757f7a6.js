import{r as n,j as e}from"./index-09c3368c.js";import{I as k}from"./IconActionButton-fd764fa6.js";import{G as O}from"./GlassModal-a6c5f610.js";import{S as ee}from"./StandardTable-d1cd024c.js";import{S as h}from"./SearchableSelect-bf34f521.js";import{P as te}from"./PlusIcon-3d2e3b30.js";import{C as se}from"./CalendarDaysIcon-03ce9b2f.js";import{P as ae}from"./PencilIcon-619ae986.js";import{E as re}from"./EyeIcon-bb65ea7b.js";import{T as le}from"./TrashIcon-41cd83e4.js";import"./XMarkIcon-93d59038.js";import"./chevron-down-5d12351e.js";let i=[{id:"FES-1",name:"雙11活動",type:"traditional",status:"planning",startDate:"2025-11-01",endDate:"2025-11-11",description:"雙11特賣",bannerImage:"",themeColor:"#ff6b6b",targetProducts:[],promotionSettings:{discountType:"percentage",discountValue:10,freeShipping:!1,giftThreshold:0,giftItems:[]}}];const ne=[{value:"traditional",label:"傳統節慶"},{value:"western",label:"西洋節日"},{value:"custom",label:"自訂活動"}],oe=[{value:"draft",label:"草稿"},{value:"planning",label:"規劃中"},{value:"active",label:"進行中"},{value:"ended",label:"已結束"}],ce=[{value:"apparel",label:"服飾"},{value:"accessories",label:"配件"},{value:"jewelry",label:"珠寶"}],u={getFestivalTypes(){return ne},getStatusOptions(){return oe},getProductCategories(){return ce},getAllFestivals(){return i.map(l=>({...l}))},createFestival(l){const c={id:`FES-${Date.now()}`,...l};return i.unshift(c),c},updateFestival(l,o){const c=i.findIndex(S=>S.id===l);return c===-1?null:(i[c]={...i[c],...o},i[c])},deleteFestival(l){return i=i.filter(o=>o.id!==l),!0}},je=()=>{const[l,o]=n.useState([]),[c,S]=n.useState([]),[p,_]=n.useState(""),[x,V]=n.useState("all"),[g,$]=n.useState("all"),[b,f]=n.useState(!1),[A,y]=n.useState(!1),[R,v]=n.useState(!1),[m,j]=n.useState(null),[U,D]=n.useState(!0),[a,r]=n.useState({name:"",type:"traditional",startDate:"",endDate:"",status:"draft",description:"",bannerImage:"",themeColor:"#ff6b6b",targetProducts:[],promotionSettings:{discountType:"percentage",discountValue:0,freeShipping:!1,giftThreshold:0,giftItems:[]}}),w=u.getFestivalTypes(),C=u.getStatusOptions(),B=u.getProductCategories(),G=[{value:"percentage",label:"百分比折扣"},{value:"fixed",label:"固定金額"},{value:"buy-one-get-one",label:"買一送一"}];n.useEffect(()=>{Q()},[]),n.useEffect(()=>{F()},[l,p,x,g,F]);const Q=()=>{try{const t=u.getAllFestivals();o(t),D(!1)}catch(t){console.error("載入節慶數據失敗:",t),D(!1)}},F=n.useCallback(()=>{let t=[...l];p&&(t=t.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())||s.description.toLowerCase().includes(p.toLowerCase()))),x!=="all"&&(t=t.filter(s=>s.status===x)),g!=="all"&&(t=t.filter(s=>s.type===g)),S(t)},[l,p,x,g]),W=t=>_(t.target.value),z=()=>{try{const t=u.createFestival(a);o([...l,t]),f(!1),N()}catch(t){console.error("創建節慶失敗:",t)}},Y=()=>{try{const t=u.updateFestival(m.id,a);o(l.map(s=>s.id===m.id?t:s)),y(!1),j(null),N()}catch(t){console.error("更新節慶失敗:",t)}},q=()=>{try{u.deleteFestival(m.id),o(l.filter(t=>t.id!==m.id)),v(!1),j(null)}catch(t){console.error("刪除節慶失敗:",t)}},N=()=>{r({name:"",type:"traditional",startDate:"",endDate:"",status:"draft",description:"",bannerImage:"",themeColor:"#ff6b6b",targetProducts:[],promotionSettings:{discountType:"percentage",discountValue:0,freeShipping:!1,giftThreshold:0,giftItems:[]}})},H=t=>{j(t),r({name:t.name,type:t.type,startDate:t.startDate,endDate:t.endDate,status:t.status,description:t.description,bannerImage:t.bannerImage||"",themeColor:t.themeColor||"#ff6b6b",targetProducts:t.targetProducts||[],promotionSettings:t.promotionSettings||{discountType:"percentage",discountValue:0,freeShipping:!1,giftThreshold:0,giftItems:[]}}),y(!0)},J=t=>{j(t),v(!0)},I=t=>new Date(t).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}),K=t=>{const s=w.find(d=>d.value===t);return s?s.label:t},X=t=>{const s=C.find(d=>d.value===t);return s?s.label:t},Z=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-gray-100 text-gray-800";case"scheduled":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"ended":case"inactive":case"completed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#cc824d]"})}):e.jsxs("div",{className:"min-h-screen bg-[#fdf8f2] p-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"節慶管理"}),e.jsx("p",{className:"text-gray-600",children:"管理所有節慶活動的詳細設定"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center px-4 py-2 bg-[#cc824d] text-white font-medium rounded-lg hover:bg-[#b8734a] transition-colors",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"新建節慶"]})})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl p-6 mb-8 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(h,{className:"w-full",options:[{value:"all",label:"所有狀態"},...C],value:x,onChange:t=>V(t),placeholder:"選擇狀態"})}),e.jsx("div",{children:e.jsx(h,{className:"w-full",options:[{value:"all",label:"所有類型"},...w],value:g,onChange:t=>$(t),placeholder:"選擇類型"})})]})}),e.jsx(ee,{title:"節慶列表",data:c,columns:[{key:"name",label:"節慶資訊",sortable:!0,render:(t,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg flex-shrink-0 flex items-center justify-center",style:{backgroundColor:(s.themeColor||"#999")+"20"},children:e.jsx(se,{className:"h-6 w-6",style:{color:s.themeColor||"#999"}})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:s.description})]})]})},{key:"type",label:"類型",sortable:!0,render:(t,s)=>e.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:K(s.type)})},{key:"status",label:"狀態",sortable:!0,render:(t,s)=>e.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs font-medium ${Z(s.status)}`,children:X(s.status)})},{key:"startDate",label:"開始時間",sortable:!0,render:(t,s)=>e.jsx("span",{className:"text-sm text-gray-900",children:I(s.startDate)})},{key:"endDate",label:"結束時間",sortable:!0,render:(t,s)=>e.jsx("span",{className:"text-sm text-gray-900",children:I(s.endDate)})},{key:"metrics",label:"效果數據",sortable:!1,render:(t,s)=>{var d,T,P,L,E,M;return e.jsxs("div",{className:"space-y-1 text-sm text-gray-900",children:[e.jsxs("div",{children:["瀏覽: ",((T=(d=s.analytics)==null?void 0:d.views)==null?void 0:T.toLocaleString())||0]}),e.jsxs("div",{children:["參與: ",((L=(P=s.analytics)==null?void 0:P.participation)==null?void 0:L.toLocaleString())||0]}),e.jsxs("div",{children:["收益: NT$",((M=(E=s.analytics)==null?void 0:E.revenue)==null?void 0:M.toLocaleString())||0]})]})}},{key:"actions",label:"操作",sortable:!1,render:(t,s)=>e.jsxs("div",{className:"flex space-x-2 text-sm font-medium",children:[e.jsx(k,{Icon:ae,label:"編輯",variant:"amber",onClick:()=>H(s)}),e.jsx(k,{Icon:re,label:"查看詳情",variant:"blue"}),e.jsx(k,{Icon:le,label:"刪除",variant:"red",onClick:()=>J(s)})]})}],showExport:!0,exportFileName:"節慶列表",className:"bg-white/70 backdrop-blur-sm border border-white/50 rounded-xl shadow-sm"})]}),e.jsx(O,{isOpen:b||A,title:b?"新建節慶":"編輯節慶",onClose:()=>{f(!1),y(!1),N()},footer:null,actions:[{label:"取消",variant:"secondary",onClick:()=>{f(!1),y(!1),N()}},{label:b?"創建":"更新",onClick:b?z:Y}],children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"節慶名稱"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>r({...a,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]",placeholder:"輸入節慶名稱"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"節慶類型"}),e.jsx(h,{className:"w-full",options:w,value:a.type,onChange:t=>r({...a,type:t}),placeholder:"選擇節慶類型"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"狀態"}),e.jsx(h,{className:"w-full",options:C,value:a.status,onChange:t=>r({...a,status:t}),placeholder:"選擇狀態"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"開始日期"}),e.jsx("input",{type:"date",value:a.startDate,onChange:t=>r({...a,startDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"結束日期"}),e.jsx("input",{type:"date",value:a.endDate,onChange:t=>r({...a,endDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"主題顏色"}),e.jsx("input",{type:"color",value:a.themeColor,onChange:t=>r({...a,themeColor:t.target.value}),className:"w-full h-10 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"描述"}),e.jsx("textarea",{value:a.description,onChange:t=>r({...a,description:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]",placeholder:"輸入節慶描述"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"橫幅圖片 URL"}),e.jsx("input",{type:"url",value:a.bannerImage,onChange:t=>r({...a,bannerImage:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]",placeholder:"輸入圖片 URL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"目標商品類別"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-32 border border-gray-300 rounded-md p-2 hide-scrollbar",style:{overflowY:"scroll",scrollbarWidth:"none",msOverflowStyle:"none"},children:B.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.targetProducts.includes(t),onChange:s=>{s.target.checked?r({...a,targetProducts:[...a.targetProducts,t]}):r({...a,targetProducts:a.targetProducts.filter(d=>d!==t)})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:t})]},t))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"促銷設定"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"折扣類型"}),e.jsx(h,{className:"w-full",options:G,value:a.promotionSettings.discountType,onChange:t=>r({...a,promotionSettings:{...a.promotionSettings,discountType:t}}),placeholder:"選擇折扣類型"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"折扣值"}),e.jsx("input",{type:"number",value:a.promotionSettings.discountValue,onChange:t=>r({...a,promotionSettings:{...a.promotionSettings,discountValue:Number(t.target.value)}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[#cc824d] focus:border-[#cc824d]",placeholder:"輸入折扣值"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.promotionSettings.freeShipping,onChange:t=>r({...a,promotionSettings:{...a.promotionSettings,freeShipping:t.target.checked}}),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"免費運送"})]})})]})]})]})]})}),e.jsx(O,{isOpen:R,title:"確認刪除",onClose:()=>v(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-700",children:`確定要刪除節慶「${(m==null?void 0:m.name)??""}」嗎？此操作將同時刪除相關的促銷活動和優惠券，且無法復原。`}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"取消"}),e.jsx("button",{type:"button",onClick:q,className:"px-4 py-2 rounded-md text-white bg-red-600 hover:bg-red-700",children:"確認刪除"})]})]})})]})};export{je as default};
