import{r as d,j as e,A as N,a as S,R as T}from"./index-5be64975.js";import{I as m}from"./IconActionButton-2bcd0b2a.js";import{E as A}from"./EyeIcon-db27fda4.js";import{P as C}from"./PencilIcon-0921d86f.js";import{P as M}from"./PrinterIcon-a02c5600.js";import{T as P}from"./TrashIcon-c73d815d.js";function p({endpoint:l}){const[i,r]=d.useState([]),[b,o]=d.useState(!0),[u,$]=d.useState(1),v=10;d.useEffect(()=>{w()},[l,u]);async function w(){o(!0);try{const t=await fetch(`${l}?page=${u}&pageSize=${v}`,{credentials:"include"});if(!t.ok)throw new Error("load failed");const a=await t.json(),c=(Array.isArray(a==null?void 0:a.items)?a.items:[]).map(s=>({id:s.merchant_trade_no||s.id,amount:s.trade_amt??0,createdAt:s.created_at||s.trade_date||"-",ecpay:{RtnCode:s.rtn_code??"",RtnMsg:s.rtn_msg??"",TradeNo:s.trade_no??"",PaymentDate:s.payment_date??"",PaymentType:s.payment_type??""}}));r(c)}catch(t){console.error(t)}finally{o(!1)}}function y(t){var c;const a=(((c=t==null?void 0:t.ecpay)==null?void 0:c.PaymentType)||(t==null?void 0:t.paymentMethod)||"").toString(),n=a.toUpperCase();return n.includes("CREDIT")?"信用卡":n.includes("WEBATM")?"WebATM":n.includes("ATM")?"ATM 轉帳":n.includes("CVS")?"超商代碼":a||"-"}function k({order:t}){var h,f,g;const a=String(((h=t==null?void 0:t.ecpay)==null?void 0:h.RtnCode)??""),n=(((f=t==null?void 0:t.ecpay)==null?void 0:f.RtnMsg)||"").toString(),c=y(t);let s="—",x="bg-gray-100 text-gray-800";if(a==="1")s="已付款",x="bg-green-100 text-green-800";else if(a)s=n?`失敗：${n}`:"付款失敗",x="bg-red-100 text-red-800";else{const j=(c.includes("ATM")||c.includes("超商"))&&!((g=t==null?void 0:t.ecpay)!=null&&g.PaymentDate);s=j?"待付款":"處理中",x=j?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x}`,title:n,children:s})}return b?e.jsx("div",{className:`${N.glassCard} p-6`,children:e.jsxs("div",{className:"flex justify-center items-center h-32",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-[#cc824d]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"載入中..."})]})}):e.jsx("div",{className:`${N.glassCard} overflow-hidden`,children:e.jsxs("div",{className:"",style:{overflowX:"scroll",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx("style",{children:"div::-webkit-scrollbar{display:none;}"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50/80 border-b border-gray-200/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"訂單編號"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"付款方式"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"總金額"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"付款狀態"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"代碼"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"綠界交易編號"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"下單時間"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"付款時間"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200/60",children:i.map(t=>{var a,n,c;return e.jsxs("tr",{className:"hover:bg-gray-50/40 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:y(t)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Number(t.amount||0).toLocaleString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(k,{order:t})}),e.jsx("td",{className:"px-2 py-4",children:e.jsx("div",{className:"text-xs text-gray-700",children:((a=t==null?void 0:t.ecpay)==null?void 0:a.RtnCode)??"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-xs text-gray-900",children:((n=t==null?void 0:t.ecpay)==null?void 0:n.TradeNo)||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.createdAt||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:((c=t==null?void 0:t.ecpay)==null?void 0:c.PaymentDate)||"-"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx(m,{Icon:A,label:"檢視詳情",variant:"blue"}),e.jsx(m,{Icon:C,label:"編輯",variant:"amber"}),e.jsx(m,{Icon:M,label:"列印",variant:"green"}),e.jsx(m,{Icon:P,label:"刪除",variant:"red",onClick:()=>alert("請改由後端 API 或 DB 處理刪除")})]})})]},t.id)})})]})]})})}function I(){return e.jsx(p,{endpoint:"/backend/orders/credit"})}function _(){return e.jsx(p,{endpoint:"/backend/orders/atm"})}function R(){return e.jsx(p,{endpoint:"/backend/orders/cvscode"})}function E(){return e.jsx(p,{endpoint:"/backend/orders/webatm"})}const V=()=>{const l=S(),i=T.useMemo(()=>{const r=(l.pathname||"").toLowerCase();return r.includes("/orders/atm")?"atm":r.includes("/orders/cvscode")?"cvscode":r.includes("/orders/webatm")?"webatm":"credit"},[l.pathname]);return e.jsxs("div",{className:"bg-[#fdf8f2] min-h-screen p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"訂單管理"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"依付款方式檢視與管理"})]}),i==="credit"&&e.jsx(I,{}),i==="atm"&&e.jsx(_,{}),i==="cvscode"&&e.jsx(R,{}),i==="webatm"&&e.jsx(E,{})]})};export{V as default};
