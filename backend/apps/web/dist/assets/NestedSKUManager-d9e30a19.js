import{r as f,j as e,A as ie}from"./index-5be64975.js";import{I as ae}from"./ImageUpload-68adf005.js";import{P as le}from"./PlusIcon-86b6a2f5.js";import{C as oe}from"./CubeIcon-717b6b1f.js";import{X as ee}from"./XMarkIcon-404a829f.js";import{P as re}from"./PencilIcon-0921d86f.js";import{C as de}from"./ChevronDownIcon-47739443.js";import{C as ue}from"./ChevronRightIcon-bd983f70.js";import{C as me}from"./Cog6ToothIcon-88b00cb1.js";import{T as xe}from"./TrashIcon-c73d815d.js";function fe({title:s,titleId:N,...u},C){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:C,"aria-labelledby":N},u),s?f.createElement("title",{id:N},s):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const he=f.forwardRef(fe),ge=he,ne=()=>Date.now()+Math.random(),R=()=>({weight:"",dimensions:{length:"",width:"",height:""},isActive:!0,hsCode:"",origin:"",note:"",variantImages:[]}),Ee=({baseSKU:s,skuVariants:N,onChange:u,productName:C="",productCategories:F=[],productId:M=null,singleVariant:y=!1,variantSelected:j=null})=>{const[v,b]=f.useState([]),[z,I]=f.useState(new Set),[S,k]=f.useState(null),[V,T]=f.useState(!1),[L,A]=f.useState({}),[E,D]=f.useState(!1);f.useEffect(()=>{b([]),A({}),I(new Set),k(null),T(!1),D(!1)},[M,s]),f.useEffect(()=>{if(E||!N||N.length===0)return;const t=[],r={};N.forEach(l=>{if(l.path&&l.path.length>0){let i=t;l.path.forEach((a,d)=>{const c=d+1;a.level&&(r[c]=a.level);let o=i.find(x=>x.name===a.option&&x.level===c);o||(o={id:ne(),name:a.option,skuCode:(a.code||"").toLowerCase(),fullSKU:(s||"")+(a.code||""),level:c,children:[],config:R()},i.push(o)),d===l.path.length-1&&(l.config&&(o.config={...R(),...l.config}),l.sku&&(o.fullSKU=l.sku)),i=o.children})}}),b(t),A(r),D(!0);const n=w(t);u&&u(n)},[s,N,E]),f.useEffect(()=>{if(!y||!j)return;const t=j||{},r={id:t.id||`var-${Date.now()}`,fullSKU:t.sku||s||"",sku:t.sku||s||"",name:t.name||"",config:{...R(),...t.config||{}},pathInfo:Array.isArray(t.path)?t.path.map(n=>({level:n.level,option:n.option})):[]};k(r),T(!0)},[y,j,s]);const X=(t,r)=>{A(n=>({...n,[t]:r}))},K=t=>L[t]||`第 ${t} 層`,P=(t,r="")=>({id:ne(),name:"",skuCode:"",fullSKU:r,level:t,children:[],config:R(),isEditing:!0}),_=()=>{const t=P(1,s||"");b(r=>{const n=[...r,t],l=w(n);return u&&u(l),n})},$=(t,r,n,l=t)=>t.map(i=>{if(i.id===r){const a={...i,...n};if("skuCode"in n||"name"in n){const c=B(l,r).slice(0,-1),o=G(c);a.fullSKU=o+(n.skuCode||a.skuCode||""),a.children=H(a.children,a.fullSKU)}return a}return{...i,children:$(i.children,r,n,l)}}),B=(t,r)=>{const n=(l,i,a=[])=>{for(const d of l){const c=[...a,d];if(d.id===i)return c;if(d.children){const o=n(d.children,i,c);if(o)return o}}return null};return n(t,r)||[]},G=(t,r=null)=>{let n=s||"";for(let l=0;l<t.length;l++){const i=t[l],a=l===t.length-1&&r!==null?r:i.skuCode||"";n+=a}return n},H=(t,r)=>!Array.isArray(t)||t.length===0?[]:t.map(n=>{const l=r+(n.skuCode||"");return{...n,fullSKU:l,children:H(n.children,l)}}),O=(t,r,n)=>{b(l=>{let i;if(r.includes(".")){const[a,d]=r.split(".");if(a==="config"){const c=x=>{for(const m of x){if(m.id===t)return m;const h=c(m.children);if(h)return h}return null},o=c(l);i=$(l,t,{config:{...o==null?void 0:o.config,[d]:n}})}else i=l}else i=$(l,t,{[r]:n});{const a=w(i);if(u&&u(a),S&&S.id===t){const d=o=>{for(const x of o){if(x.id===t)return x;const m=d(x.children||[]);if(m)return m}return null},c=d(i);if(c){const o=(m,h,g=[])=>{for(const U of m){const Z=K(U.level),te=[...g,{level:Z,option:U.name||"未命名"}];if(U.id===h)return te;const se=o(U.children||[],h,te);if(se)return se}return null},x=o(i,t)||[];k({...c,pathInfo:x})}}}return i})},Y=t=>{b(r=>{const n=o=>{for(const x of o){if(x.id===t)return x;const m=n(x.children);if(m)return m}return null},l=n(r);if(!l)return r;const i=B(r,t),a=G(i),d=$(r,t,{children:[...l.children||[],P(l.level+1,a)]}),c=w(d);return u&&u(c),d})},q=t=>{b(r=>{const n=m=>{for(const h of m){if(h.id===t)return h;const g=n(h.children);if(g)return g}return null},l=n(r);if(!l)return r;const i=(m,h)=>{for(const g of m){if(g.children.some(Z=>Z.id===h))return g.fullSKU;const U=i(g.children,h);if(U!=null)return U}return null},a=i(r,t)??(s||""),d=P(l.level,a),c=m=>{const h=m.findIndex(g=>g.id===t);if(h!==-1){const g=[...m];return g.splice(h+1,0,d),g}return m.map(g=>({...g,children:c(g.children)}))},o=c(r),x=w(o);return u&&u(x),o})},J=t=>{b(r=>{const n=a=>a.filter(d=>d.id!==t).map(d=>({...d,children:n(d.children)})),l=n(r),i=w(l);return u&&u(i),l})},W=t=>{I(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n})},Q=t=>{const r=p(t.id);k({...t,pathInfo:r}),T(!0)},p=t=>{const r=[],n=(l,i,a=[])=>{for(const d of l){const c=K(d.level),o=[...a,{level:c,option:d.name||"未命名"}];if(d.id===i)return r.push(...o),!0;if(n(d.children,i,o))return!0}return!1};return n(v,t),r},w=f.useCallback((t=null)=>{const r=t||v,n=[],l=(i,a=s||"",d=[])=>{i.forEach(c=>{const o=a+(c.skuCode||""),x=[...d,{level:L[c.level]||`層級${c.level}`,option:c.name||"未命名選項"}];if(!c.children||c.children.length===0){if(c.skuCode&&c.skuCode.trim()){const m=c.config||R();n.push({id:`sku-${c.id}`,sku:o,name:c.name||"未命名選項",path:x,pathDisplay:x.map(h=>`${h.level}: ${h.option}`).join(" → "),config:m,isActive:m.isActive})}}else l(c.children,o,x)})};return l(r),n},[v,s,L]);return f.useEffect(()=>{if(v.length>0&&E){const t=w();u&&u(t)}},[v,s,E,w,u]),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex gap-6",children:[!y&&e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg transition-all duration-300 ${V?"w-2/3":"w-full"}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"SKU 結構樹"}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:_,className:`${ie.btnPrimary} text-sm inline-flex items-center whitespace-nowrap`,children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"添加根層級"]})})]})}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:v.length>0?e.jsx("div",{className:"space-y-2",children:v.map((t,r)=>e.jsx(ce,{node:t,expandedItems:z,onToggleExpand:W,onUpdateNode:O,onDeleteNode:J,onAddChild:Y,onAddSibling:q,onSelectForConfig:Q,isFirstInLevel:r===0,levelTitle:K(t.level),onUpdateLevelTitle:X,getLevelTitle:K},t.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(oe,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"還沒有建立 SKU 結構"}),e.jsx("p",{className:"text-sm",children:"點擊「添加根層級」開始建立 SKU 樹狀結構"})]})})]}),V&&S&&e.jsxs("div",{className:`${y?"w-full":"w-1/3"} bg-white border border-gray-200 rounded-lg`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"SKU 詳細設定"}),e.jsx("button",{onClick:()=>T(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:S.fullSKU})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:e.jsx(pe,{sku:S,onUpdate:(t,r)=>O(S.id,t,r),baseSKU:s,getLevelTitle:K,productName:C,productCategories:F})})]})]})})},ce=({node:s,expandedItems:N,onToggleExpand:u,onUpdateNode:C,onDeleteNode:F,onAddChild:M,onAddSibling:y,onSelectForConfig:j,isFirstInLevel:v=!1,levelTitle:b="",onUpdateLevelTitle:z,getLevelTitle:I})=>{const[S,k]=f.useState(s.isEditing||!1),[V,T]=f.useState(!1),[L,A]=f.useState(""),[E,D]=f.useState(""),[X,K]=f.useState(""),P=s.children&&s.children.length>0,_=N.has(s.id),$=s.level<5,B=!P,G=()=>{A(s.name||""),D(s.skuCode||""),k(!0)},H=()=>{L!==s.name&&C(s.id,"name",L),E!==s.skuCode&&C(s.id,"skuCode",E),C(s.id,"isEditing",!1),k(!1)},O=()=>{k(!1)},Y=()=>{K(b),T(!0)},q=()=>{z(s.level,X),T(!1)},J=()=>{T(!1)},W=()=>({1:"pl-0",2:"pl-6",3:"pl-12",4:"pl-18",5:"pl-24"})[s.level]||"pl-0",Q=()=>({1:"bg-blue-100 text-blue-800",2:"bg-green-100 text-green-800",3:"bg-purple-100 text-purple-800",4:"bg-orange-100 text-orange-800",5:"bg-red-100 text-red-800"})[s.level]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"select-none",children:[v&&e.jsx("div",{className:`mb-2 ${W()}`,children:V?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:X,onChange:p=>K(p.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm font-medium",placeholder:`第 ${s.level} 層標題`,autoFocus:!0}),e.jsx("button",{onClick:q,className:"text-green-600 hover:text-green-700 p-1",children:e.jsx(CheckCircleIcon,{className:"w-4 h-4"})}),e.jsx("button",{onClick:J,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(ee,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center justify-between py-1 px-2 bg-gray-100 rounded cursor-pointer hover:bg-gray-200",onClick:Y,children:[e.jsx("h6",{className:"text-sm font-medium text-gray-700",children:b||`第 ${s.level} 層`}),e.jsx(re,{className:"w-3 h-3 text-gray-400"})]})}),e.jsxs("div",{className:`flex items-center py-2 hover:bg-gray-50 rounded-lg transition-colors ${W()}`,children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 mr-2",children:P?e.jsx("button",{onClick:()=>u(s.id),className:"p-1 hover:bg-gray-200 rounded",children:_?e.jsx(de,{className:"w-4 h-4 text-gray-500"}):e.jsx(ue,{className:"w-4 h-4 text-gray-500"})}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium mr-3 ${Q()}`,children:["L",s.level]}),e.jsx("div",{className:"flex-1 flex items-center space-x-3",children:S?e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("input",{type:"text",value:L,onChange:p=>A(p.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm flex-1",placeholder:"選項名稱 (例如：黑色、大號)",autoFocus:!0}),e.jsx("input",{type:"text",value:E,onChange:p=>D(p.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")),className:"px-2 py-1 border border-gray-300 rounded text-sm w-20",placeholder:"sku",maxLength:3}),e.jsx("button",{onClick:H,className:"text-green-600 hover:text-green-700 p-1",title:"保存",children:"✓"}),e.jsx("button",{onClick:O,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(ee,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.name||"未命名選項",s.skuCode&&e.jsxs("span",{className:"ml-2 text-sm font-mono text-gray-600",children:["[",s.skuCode,"]"]})]}),s.fullSKU&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:["完整 SKU: ",s.fullSKU]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:G,className:"text-gray-400 hover:text-blue-600 p-1 rounded",title:"編輯選項",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(s.id),className:"text-gray-400 hover:text-orange-600 p-1 rounded",title:"添加同層級選項",children:e.jsx(le,{className:"w-4 h-4"})}),$&&e.jsx("button",{onClick:()=>M(s.id),className:"text-gray-400 hover:text-green-600 p-1 rounded",title:"添加下一層級",children:e.jsx(ge,{className:"w-4 h-4"})}),B&&e.jsx("button",{onClick:()=>j(s),className:"text-gray-400 hover:text-[#cc824d] p-1 rounded",title:"設定 SKU 詳細資訊",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(s.id),className:"text-gray-400 hover:text-red-600 p-1 rounded",title:"刪除",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})})]}),P&&_&&e.jsx("div",{className:"ml-2",children:s.children.map((p,w)=>e.jsx(ce,{node:p,expandedItems:N,onToggleExpand:u,onUpdateNode:C,onDeleteNode:F,onAddChild:M,onAddSibling:y,onSelectForConfig:j,isFirstInLevel:w===0,levelTitle:I?I(p.level):`第 ${p.level} 層`,onUpdateLevelTitle:z,getLevelTitle:I},p.id))})]})},pe=({sku:s,onUpdate:N,baseSKU:u,getLevelTitle:C,productName:F="",productCategories:M=[]})=>{const y=s.pathInfo||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h6",{className:"text-sm font-medium text-blue-900 mb-3",children:"SKU 組成資訊"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"基礎 SKU: "}),e.jsx("span",{className:"font-mono text-blue-800 bg-white px-2 py-1 rounded",children:u||"N/A"})]}),y.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"層級路徑: "}),e.jsx("div",{className:"mt-1 space-y-1",children:y.map((j,v)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded mr-2",children:["L",v+1]}),e.jsxs("span",{className:"text-sm text-gray-800",children:[j.level,":"]}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:j.option})]},v))})]}),e.jsxs("div",{className:"text-sm pt-2 border-t border-blue-200",children:[e.jsx("span",{className:"text-gray-600",children:"最終 SKU: "}),e.jsx("span",{className:"font-mono text-lg font-bold text-blue-800 bg-white px-2 py-1 rounded",children:s.fullSKU||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-gray-900 mb-3",children:"基本設定"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.config.isActive,onChange:j=>N("config.isActive",j.target.checked),className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"啟用此變體"})]})})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-medium text-gray-900 mb-3",children:"變體圖片"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"此處設定「此變體」專屬圖片。若未設定，將回退使用商品圖片或無圖。"}),e.jsx(ae,{images:Array.isArray(s.config.variantImages)?s.config.variantImages:[],onChange:j=>N("config.variantImages",j),maxImages:3})]})]})};export{Ee as N};
