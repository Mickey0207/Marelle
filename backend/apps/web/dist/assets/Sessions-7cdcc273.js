import{r as l,j as s,A as b}from"./index-5be64975.js";import{S as h}from"./StandardTable-046e436b.js";import{S as m}from"./SearchableSelect-06cd3eb3.js";import{G as j}from"./GlassModal-8d9cbd14.js";import{S as y}from"./Charts-5dd86497.js";import{I as f}from"./IconActionButton-2bcd0b2a.js";import{b as g,S,D as v}from"./dataManager-5e949847.js";import{E as N}from"./EyeIcon-db27fda4.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";const z=()=>{const[r,i]=l.useState({sources:[],devices:[]}),[a,c]=l.useState(null),o=l.useMemo(()=>g(r),[r]),[n,d]=l.useState("table"),x=l.useMemo(()=>{const e=new Map;for(const t of o)e.set(t.source,(e.get(t.source)||0)+1);return Array.from(e.entries()).map(([t,p])=>({type:t,value:p}))},[o]),u=[{key:"sessionId",label:"會話",sortable:!0},{key:"userId",label:"用戶",sortable:!0},{key:"source",label:"來源",sortable:!0},{key:"device",label:"裝置",sortable:!0},{key:"startedAt",label:"開始時間",sortable:!0,render:e=>new Date(e).toLocaleString("zh-TW")},{key:"durationSec",label:"時長(秒)",sortable:!0},{key:"pageCount",label:"頁數",sortable:!0},{key:"eventCount",label:"事件數",sortable:!0},{key:"actions",label:"操作",render:(e,t)=>s.jsx(f,{Icon:N,label:"時間軸",variant:"blue",onClick:()=>c(t)})}];return s.jsx("div",{className:"bg-[#fdf8f2] min-h-screen",children:s.jsxs("div",{className:b.contentContainerFluid,children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese mb-6",children:"會話"}),s.jsxs("div",{className:"glass rounded-2xl p-4 mb-4 flex flex-wrap gap-4 items-center",children:[s.jsx(m,{multiple:!0,placeholder:"來源",options:S.map(e=>({value:e,label:e})),value:r.sources,onChange:e=>i(t=>({...t,sources:e}))}),s.jsx(m,{multiple:!0,placeholder:"裝置",options:v.map(e=>({value:e,label:e})),value:r.devices,onChange:e=>i(t=>({...t,devices:e}))})]}),s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"text-sm text-gray-500 font-chinese",children:["共 ",o.length," 筆"]}),s.jsxs("div",{className:"space-x-2",children:[s.jsx("button",{className:`px-3 py-1 rounded text-sm ${n==="table"?"bg-[#cc824d] text-white":"border text-gray-700"}`,onClick:()=>d("table"),children:"表格"}),s.jsx("button",{className:`px-3 py-1 rounded text-sm ${n==="chart"?"bg-[#cc824d] text-white":"border text-gray-700"}`,onClick:()=>d("chart"),children:"圖表"})]})]}),n==="table"?s.jsx(h,{data:o,columns:u,title:"會話列表",exportFileName:"會話列表"}):s.jsx("div",{className:"glass rounded-2xl p-4",children:s.jsx(y,{data:x,xField:"type",yField:"value"})}),s.jsx(j,{isOpen:!!a,onClose:()=>c(null),title:"Session Timeline",size:"max-w-3xl",children:a&&s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"text-gray-700",children:["Session: ",a.sessionId," / User: ",a.userId]}),s.jsx("ul",{className:"space-y-2",children:a.events.sort((e,t)=>e.ts-t.ts).map(e=>s.jsxs("li",{className:"p-2 rounded border bg-white",children:[s.jsx("div",{className:"text-gray-500 text-xs",children:new Date(e.ts).toLocaleString("zh-TW")}),s.jsx("div",{className:"font-medium",children:e.type}),s.jsx("div",{className:"text-xs text-gray-600 break-all",children:e.path||e.sku||e.productId||"-"})]},e.id))})]})})]})})};export{z as default};
