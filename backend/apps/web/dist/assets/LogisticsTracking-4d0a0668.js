import{r as u,A as c,j as e}from"./index-5be64975.js";import{S as Q}from"./StandardTable-046e436b.js";import{T as X}from"./TabNavigation-b0ee78ba.js";import{G as Y}from"./GlassModal-8d9cbd14.js";import{S as O}from"./SearchableSelect-06cd3eb3.js";import{E as Z}from"./EyeIcon-db27fda4.js";import{A as ee}from"./ArrowPathIcon-3cac90dc.js";import{T as se}from"./TruckIcon-5bf0fb42.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";const te=t=>{const r=[{LogisticsType:"Home",LogisticsSubType:"TCAT"},{LogisticsType:"Home",LogisticsSubType:"POST"},{LogisticsType:"CVS",LogisticsSubType:"UNIMART"},{LogisticsType:"CVS",LogisticsSubType:"FAMI"},{LogisticsType:"CVS",LogisticsSubType:"HILIFE"},{LogisticsType:"CVS",LogisticsSubType:"OKMART"}],o=r[t%r.length],d=Date.now()-t*36e5;return{MerchantID:"2000132",MerchantTradeNo:`T${(1e5+t).toString(36).toUpperCase()}`,TradeNo:`TN${3e5+t}`,TradeDate:new Date(d-864e5).toISOString(),UpdateStatusDate:new Date(d).toISOString(),RtnCode:t%7===0?0:1,RtnMsg:t%7===0?"失敗":"成功",LogisticsID:`L${4e5+t}`,AllPayLogisticsID:`AL${4e5+t}`,Status:t%6,LogisticsStatus:t%6,GoodsAmount:100+t%9*50,ReceiverName:`客戶${t+1}`,ReceiverEmail:`user${t+1}@example.com`,ReceiverCellPhone:`09${(1e7+t).toString().slice(0,8)}`,ReceiverPhone:`02-77${(3e5+t).toString().slice(0,4)}`,SenderName:"瑪黑商店",SenderCellPhone:"02-00000000",SenderPhone:"02-00000000",ReceiverAddress:`台北市信義區松高路 ${t+1} 號`,CVSStoreID:`S${1e3+t}`,CVSStoreName:["松高門市","信義門市","市府門市"][t%3],CVSAddress:`台北市信義區 ${["松高","信義","市府"][t%3]} 路 100 號`,HandlingCharge:60,CollectionAmount:t%2?0:300+t%5*50,CollectionChargeFee:t%2?0:10,CollectionAllocateDate:new Date(d+864e5).toISOString(),CollectionAllocateAmount:t%2?0:300+t%5*50,GoodsWeight:1+t%4*.5,ActualWeight:1+t%4*.6,ShipChargeDate:new Date(d+2*864e5).toISOString(),BookingNote:`BN${5e5+t}`,ShipmentNo:`SP${6e5+t}`,CVSPaymentNo:t%3===0?`PM${7e5+t}`:"",...o}},A={rows:Array.from({length:40}).map((t,r)=>te(r)),cursor:0};function F(t){return new Promise(r=>setTimeout(r,t))}async function ae(t={}){return await F(120),{success:!0,data:[...A.rows]}}async function E(t=0){await F(80);const r=Math.max(0,Math.min(A.rows.length-1,t)),o=A.rows[r];if(o){const d=((Number(o.Status)||0)+1)%6;o.Status=d,o.LogisticsStatus=d,o.UpdateStatusDate=new Date().toISOString()}return{success:!0,nextIndex:(r+1)%A.rows.length}}async function le(t=0){return E(t)}const R={queryLogisticsOrders:ae,refreshFromIndex:E,updateOneAndNext:le},g={0:"待處理",1:"已成立",2:"配送中",3:"已配達",4:"已取件",5:"配送失敗",6:"退回"},v={Home:{TCAT:{...g},POST:{...g}},CVS:{UNIMART:{...g},UNIMARTC2C:{...g},FAMI:{...g},FAMIC2C:{...g},HILIFE:{...g},HILIFEC2C:{...g},OKMART:{...g},OKMARTC2C:{...g}}};function ne(){return v}function re(){const t={};return Object.values(v).forEach(r=>{Object.values(r).forEach(o=>{Object.assign(t,o)})}),t}function L(t,r="Home",o="TCAT"){var b;const d=String(r||"").trim(),s=String(o||"").trim(),f=Number(t);return(((b=v==null?void 0:v[d])==null?void 0:b[s])||g)[f]||String(t)}function I(t,r){const o={Home:{TCAT:"黑貓宅配",POST:"郵局宅配"},CVS:{UNIMART:"7-11 B2C",UNIMARTC2C:"7-11 C2C",FAMI:"全家 B2C",FAMIC2C:"全家 C2C",HILIFE:"萊爾富 B2C",HILIFEC2C:"萊爾富 C2C",OKMART:"OK 超商 B2C",OKMARTC2C:"OK 超商 C2C"}};return o[t]&&o[t][r]?o[t][r]:t&&r?`${t}/${r}`:t||r||"-"}function Se(){const[t,r]=u.useState(!1),[o,d]=u.useState([]),[s,f]=u.useState(null),[p,b]=u.useState("overview"),[w,P]=u.useState(""),[h,$]=u.useState("all"),[y,U]=u.useState("all"),C=u.useRef(0),M=u.useRef(null),H=async(a={})=>{r(!0);try{const l=await R.queryLogisticsOrders(a);l.success&&d(l.data)}finally{r(!1)}};u.useEffect(()=>{H();const a=async()=>{const l=await R.refreshFromIndex(C.current);C.current=l.nextIndex||0,d(i=>i.map(m=>({...m}))),M.current=setTimeout(a,2e3)};return a(),()=>{M.current&&clearTimeout(M.current)}},[]);const V=async a=>{C.current=a;const l=await R.updateOneAndNext(a);C.current=l.nextIndex||0,d(i=>i.map(m=>({...m})))},K=u.useMemo(()=>{const a=new Map;return o.forEach(l=>{const i=`${l.LogisticsType}:${l.LogisticsSubType}`;a.has(i)||a.set(i,I(l.LogisticsType,l.LogisticsSubType))}),[{value:"all",label:"全部物流方式"},...Array.from(a.entries()).map(([l,i])=>({value:l,label:i}))]},[o]),B=u.useMemo(()=>{var x;const a={value:"all",label:"全部狀態"},l=ne(),i=re(),m=new Set;if(h&&h!=="all"){const[S,G]=String(h).split(":"),q=String(S||"").toUpperCase(),J=String(G||"").toUpperCase(),z=((x=l==null?void 0:l[q])==null?void 0:x[J])||{};Object.values(z).forEach(D=>D&&m.add(D))}else Object.values(i).forEach(S=>S&&m.add(S));const T=Array.from(m);return[a,...T.map(S=>({value:S,label:S}))]},[h]),_=u.useMemo(()=>{const a=(w||"").toLowerCase().trim();return o.filter(l=>{const i=a?JSON.stringify(l).toLowerCase().includes(a):!0,m=`${l.LogisticsType}:${l.LogisticsSubType}`,T=h==="all"?!0:m===h,x=L(l.LogisticsStatus||l.Status,l.LogisticsType,l.LogisticsSubType)||"";return i&&T&&(y==="all"?!0:x===y)})},[o,w,h,y]),k=u.useCallback(a=>{if(!a)return c.statusInfo;const l=String(a),i=["成功","完成","已配達","已取件","領取","撥款"],m=["待","處理","配送","運送","轉運","重新"];return["失敗","取消","逾期","異常","未取","退回"].some(x=>l.includes(x))?c.statusError:i.some(x=>l.includes(x))?c.statusSuccess:m.some(x=>l.includes(x))?c.statusWarning:c.statusInfo},[]),N=u.useCallback(a=>e.jsx("span",{className:k(a),children:a||"未知狀態"}),[k]),j=u.useCallback((a,l)=>a==="Home"?c.statusInfo:a==="CVS"?{UNIMART:c.statusSuccess,UNIMARTC2C:c.statusSuccess,FAMI:c.statusInfo,FAMIC2C:c.statusInfo,HILIFE:c.statusWarning,HILIFEC2C:c.statusWarning,OKMART:c.statusInactive,OKMARTC2C:c.statusInactive}[l]||c.statusInfo:c.statusInfo,[]),W=u.useMemo(()=>[{key:"TradeDate",label:"訂單成立時間",sortable:!0,render:a=>a||"-"},{key:"UpdateStatusDate",label:"更新時間",sortable:!0},{key:"LogisticsType",label:"物流方式",sortable:!0,render:(a,l)=>e.jsx("span",{className:j(l.LogisticsType,l.LogisticsSubType),children:I(l.LogisticsType,l.LogisticsSubType)})},{key:"LogisticsStatus",label:"物流狀態",sortable:!1,render:(a,l)=>N(L(a||l.Status,l.LogisticsType,l.LogisticsSubType))},{key:"GoodsAmount",label:"商品金額",sortable:!0},{key:"ReceiverName",label:"收件人",sortable:!0},{key:"ReceiverCellPhone",label:"手機",sortable:!1},{key:"RtnCode",label:"回應代碼",sortable:!0,render:a=>{if(a==null||a==="")return"-";const l=Number(a);if(!Number.isNaN(l)){const i=l===1?"text-green-600 font-mono":"text-red-600 font-mono";return e.jsx("span",{className:i,children:l})}return String(a)}},{key:"actions",label:"操作",sortable:!1,render:(a,l,i)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{f(l),b("overview")},className:"p-2 text-gray-400 hover:text-blue-500 transition-colors",title:"檢視詳情","aria-label":"檢視詳情",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>V(i),className:"p-2 text-gray-400 hover:text-amber-600 transition-colors",title:"更新此筆後繼續","aria-label":"更新此筆後繼續",children:e.jsx(ee,{className:"w-4 h-4"})})]})}],[j,N]);return e.jsx("div",{className:"bg-[#fdf8f2] min-h-screen",children:e.jsxs("div",{className:c.contentContainerFluid,children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"w-8 h-8 text-amber-500 mr-3"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese",children:"物流追蹤"})]})}),e.jsx("div",{className:"glass rounded-2xl p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{value:w,onChange:a=>P(a.target.value),className:`${c.input} flex-1`,placeholder:"輸入關鍵字，搜尋所有欄位"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("div",{className:"min-w-[14rem]",children:e.jsx(O,{value:h,onChange:a=>$(a),options:K,placeholder:"選擇物流方式",searchPlaceholder:"搜尋物流方式...",className:"font-chinese",maxDisplayOptions:9999})}),e.jsx("div",{className:"w-[30rem]",children:e.jsx(O,{value:y,onChange:a=>U(a),options:B,placeholder:"選擇狀態",searchPlaceholder:"搜尋狀態...",className:"font-chinese",maxDisplayOptions:9999})})]})]})}),e.jsx(Q,{data:_,columns:W,title:t?"載入中…":"物流清單",emptyMessage:"沒有找到符合條件的物流資料",exportFileName:"物流清單"}),s&&e.jsx(Y,{isOpen:!!s,onClose:()=>f(null),title:"物流詳情",size:"max-w-5xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx(X,{mode:"controlled",activeKey:p,onTabChange:a=>b(a.key||a.label),tabs:[{key:"overview",label:"概要"},{key:"order",label:"訂單/交易"},{key:"logistics",label:"物流"},{key:"receiver",label:"收件/寄件"},{key:"address",label:"門市/地址"},{key:"fees",label:"費用/重量"},{key:"raw",label:"原始資料"}],className:"mb-4",layout:"left"}),p==="overview"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm font-chinese",children:[e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"訂單成立時間"}),e.jsx("div",{className:"font-medium",children:s.TradeDate||"-"})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"更新時間"}),e.jsx("div",{className:"font-medium",children:s.UpdateStatusDate||"-"})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"物流方式"}),e.jsx("div",{className:j(s.LogisticsType,s.LogisticsSubType),children:I(s.LogisticsType,s.LogisticsSubType)})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"物流狀態"}),e.jsx("div",{className:"font-medium",children:N(L(s.LogisticsStatus||s.Status,s.LogisticsType,s.LogisticsSubType))})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"商品金額"}),e.jsx("div",{className:"font-medium",children:s.GoodsAmount})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"收件人"}),e.jsx("div",{className:"font-medium",children:s.ReceiverName})]})]}),p==="order"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-chinese",children:[e.jsx(n,{label:"特店編號",value:s.MerchantID}),e.jsx(n,{label:"商店訂單",value:s.MerchantTradeNo}),e.jsx(n,{label:"綠界交易",value:s.TradeNo}),e.jsx(n,{label:"訂單成立時間",value:s.TradeDate}),e.jsx(n,{label:"回應代碼",value:s.RtnCode}),e.jsx(n,{label:"回應訊息",value:s.RtnMsg})]}),p==="logistics"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-chinese",children:[e.jsx(n,{label:"綠界物流編號",value:s.LogisticsID||s.AllPayLogisticsID}),e.jsx(n,{label:"更新時間",value:s.UpdateStatusDate}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"物流方式"}),e.jsx("div",{className:j(s.LogisticsType,s.LogisticsSubType),children:I(s.LogisticsType,s.LogisticsSubType)})]}),e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"狀態"}),N(L(s.LogisticsStatus||s.Status,s.LogisticsType,s.LogisticsSubType))]}),e.jsx(n,{label:"寄貨/配送編號",value:s.CVSPaymentNo||s.ShipmentNo}),e.jsx(n,{label:"托運單號",value:s.BookingNote})]}),p==="receiver"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-chinese",children:[e.jsx(n,{label:"收件人",value:s.ReceiverName}),e.jsx(n,{label:"Email",value:s.ReceiverEmail}),e.jsx(n,{label:"手機",value:s.ReceiverCellPhone}),e.jsx(n,{label:"電話",value:s.ReceiverPhone}),e.jsx(n,{label:"寄件人",value:s.SenderName}),e.jsx(n,{label:"寄件人手機",value:s.SenderCellPhone}),e.jsx(n,{label:"寄件人電話",value:s.SenderPhone})]}),p==="address"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-chinese",children:[e.jsx(n,{label:"收件地址",value:s.ReceiverAddress}),e.jsx(n,{label:"門市代碼",value:s.CVSStoreID}),e.jsx(n,{label:"門市名稱",value:s.CVSStoreName}),e.jsx(n,{label:"門市地址",value:s.CVSAddress})]}),p==="fees"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-chinese",children:[e.jsx(n,{label:"物流費",value:s.HandlingCharge}),e.jsx(n,{label:"代收金額",value:s.CollectionAmount}),e.jsx(n,{label:"代收手續費",value:s.CollectionChargeFee}),e.jsx(n,{label:"撥款日",value:s.CollectionAllocateDate}),e.jsx(n,{label:"撥款金額",value:s.CollectionAllocateAmount}),e.jsx(n,{label:"商品重量(kg)",value:s.GoodsWeight}),e.jsx(n,{label:"實際重量(kg)",value:s.ActualWeight}),e.jsx(n,{label:"運費扣款日",value:s.ShipChargeDate})]}),p==="raw"&&e.jsx("pre",{className:"text-xs bg-gray-50 p-3 rounded overflow-auto max-h-[60vh]",children:JSON.stringify(s,null,2)})]})})]})})}const n=({label:t,value:r})=>e.jsxs("div",{className:"glass p-4 rounded-xl",children:[e.jsx("div",{className:"text-gray-500 mb-1",children:t}),e.jsx("div",{className:"font-medium break-words",children:r??"-"})]});export{Se as default};
