import{r as i,j as e,A as c}from"./index-09c3368c.js";import{S as H}from"./StandardTable-d1cd024c.js";import{G as D}from"./GlassModal-a6c5f610.js";import{S as x}from"./SearchableSelect-bf34f521.js";import{I as C}from"./IconActionButton-fd764fa6.js";import{S as t,a as r,s as f}from"./supplierDataManager-ea137c91.js";import{P as z}from"./PlusIcon-3d2e3b30.js";import{M as W}from"./MagnifyingGlassIcon-0e31f702.js";import{E as Y}from"./EyeIcon-bb65ea7b.js";import{P as q}from"./PencilIcon-619ae986.js";import{T as J}from"./TrashIcon-41cd83e4.js";import"./chevron-down-5d12351e.js";import"./XMarkIcon-93d59038.js";function X({title:b,titleId:p,...E},v){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":p},E),b?i.createElement("title",{id:p},b):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const Z=i.forwardRef(X),ee=Z,pe=()=>{const[b,p]=i.useState([]),[E,v]=i.useState(!0),[d,I]=i.useState({search:"",status:"all",grade:"all"}),[P,A]=i.useState(!1),[U,g]=i.useState(!1),[_,N]=i.useState(!1),[l,w]=i.useState(null),[u,j]=i.useState({status:"",grade:"",website:""}),[n,m]=i.useState({companyName:"",industry:"",taxId:"",website:"",establishedDate:"",status:t.PENDING,grade:r.E_UNQUALIFIED}),[k,L]=i.useState(!1),[T,B]=i.useState(!1),h=i.useCallback(()=>{v(!0);try{const s=(f.getAllSuppliers()||[]).filter(o=>{const y=(d.search||"").toLowerCase(),S=!y||[o.companyName,o.companyNameEn,o.taxId,o.industry,o.website].some(K=>String(K||"").toLowerCase().includes(y)),Q=d.status==="all"||o.status===d.status,V=d.grade==="all"||o.grade===d.grade;return S&&Q&&V});p(s)}catch(a){console.error("Error loading suppliers:",a),p([])}finally{v(!1)}},[d]);i.useEffect(()=>{h()},[d,h]);const F=a=>{const s={[t.ACTIVE]:"bg-green-100 text-green-800",[t.PENDING]:"bg-yellow-100 text-yellow-800",[t.SUSPENDED]:"bg-red-100 text-red-800",[t.BLACKLISTED]:"bg-red-100 text-red-900",inactive:"bg-gray-100 text-gray-800"},o={[t.ACTIVE]:"活躍",[t.PENDING]:"待審核",[t.SUSPENDED]:"暫停",[t.BLACKLISTED]:"黑名單",inactive:"停用"},y=s[a]||"bg-gray-100 text-gray-800",S=o[a]||a;return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${y}`,children:S})},O=a=>{w(a),A(!0)},G=a=>{w(a),j({status:a.status||t.PENDING,grade:a.grade||r.E_UNQUALIFIED,website:a.website||""}),g(!0)},R=()=>{if(l){L(!0);try{const a=f.updateSupplier(l.id,{status:u.status,grade:u.grade,website:u.website});a!=null&&a.success||alert("儲存失敗："+((a==null?void 0:a.error)||"未知錯誤")),h(),g(!1)}catch(a){console.error("更新供應商失敗",a),alert("更新供應商失敗")}finally{L(!1)}}},M=a=>{if(window.confirm("確定要刪除這個供應商嗎？此操作會一併刪除相關聯絡人和採購記錄。")){const s=f.deleteSupplier(a);s.success?h():alert("刪除失敗："+s.error)}},$=()=>{if(!n.companyName||!n.companyName.trim()){alert("請輸入供應商名稱");return}B(!0);try{const a={companyName:n.companyName.trim(),industry:n.industry||"",taxId:n.taxId||"",website:n.website||"",establishedDate:n.establishedDate||"",status:n.status,grade:n.grade},s=f.createSupplier(a);s!=null&&s.success?(h(),N(!1),m({companyName:"",industry:"",taxId:"",website:"",establishedDate:"",status:t.PENDING,grade:r.E_UNQUALIFIED})):alert("建立失敗："+((s==null?void 0:s.error)||"未知錯誤"))}catch(a){console.error("建立供應商失敗",a),alert("建立供應商失敗")}finally{B(!1)}};return E?e.jsx("div",{className:"bg-[#fdf8f2] min-h-screen p-6",children:e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#cc824d]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"載入供應商數據中..."})]})}):e.jsxs("div",{className:"bg-[#fdf8f2] min-h-screen p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"供應商管理"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"管理所有供應商信息與合作關係"})]}),e.jsx("div",{children:e.jsxs("button",{className:`${c.primaryButton} inline-flex items-center`,onClick:()=>N(!0),children:[e.jsx(z,{className:"w-5 h-5 mr-2"})," 新增供應商"]})})]}),e.jsx("div",{className:`${c.glassCard} mb-6`,children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"搜尋供應商名稱、統編、產業...",value:d.search,onChange:a=>I(s=>({...s,search:a.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#cc824d] focus:border-transparent"})]})}),e.jsx("div",{children:e.jsx(x,{placeholder:"狀態",value:d.status,onChange:a=>I(s=>({...s,status:a})),options:[{value:"all",label:"所有狀態"},{value:t.ACTIVE,label:"活躍"},{value:t.PENDING,label:"待審核"},{value:t.SUSPENDED,label:"暫停"},{value:t.BLACKLISTED,label:"黑名單"},{value:"inactive",label:"停用"}],size:"sm"})}),e.jsx("div",{children:e.jsx(x,{placeholder:"分級",value:d.grade,onChange:a=>I(s=>({...s,grade:a})),options:[{value:"all",label:"所有分級"},{value:r.A_STRATEGIC,label:"A"},{value:r.B_PREFERRED,label:"B"},{value:r.C_QUALIFIED,label:"C"},{value:r.D_CONDITIONAL,label:"D"},{value:r.E_UNQUALIFIED,label:"E"}],size:"sm"})})]})}),e.jsx(H,{title:"供應商列表",data:b,exportFileName:"供應商列表",emptyIcon:ee,emptyTitle:"沒有找到供應商",emptyDescription:"請調整搜尋/篩選條件或新增第一筆供應商",columns:[{key:"companyName",label:"供應商名稱",sortable:!0},{key:"industry",label:"產業",sortable:!0},{key:"status",label:"狀態",sortable:!0,render:a=>F(a)},{key:"grade",label:"分級",sortable:!0},{key:"overallRating",label:"評分",sortable:!0,render:a=>e.jsx("span",{className:"text-gray-900",children:a!=null?Number(a).toFixed(1):"-"})},{key:"taxId",label:"統一編號",sortable:!0},{key:"establishedDate",label:"成立日期",sortable:!0},{key:"createdAt",label:"建立時間",sortable:!0},{key:"actions",label:"操作",sortable:!1,render:(a,s)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{Icon:Y,label:"檢視",variant:"blue",onClick:()=>O(s)}),e.jsx(C,{Icon:q,label:"編輯",variant:"amber",onClick:()=>G(s)}),e.jsx(C,{Icon:J,label:"刪除",variant:"red",onClick:()=>M(s.id)})]})}]}),e.jsx(D,{isOpen:P&&!!l,onClose:()=>A(!1),title:l?`檢視供應商：${l.companyName}`:"檢視供應商",children:l&&e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"供應商名稱"}),e.jsx("div",{className:"font-medium",children:l.companyName})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"產業"}),e.jsx("div",{className:"font-medium",children:l.industry||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"狀態"}),e.jsx("div",{className:"font-medium",children:F(l.status)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"分級"}),e.jsx("div",{className:"font-medium",children:l.grade||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"統一編號"}),e.jsx("div",{className:"font-medium",children:l.taxId||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"網站"}),e.jsx("div",{className:"font-medium",children:l.website||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"成立日期"}),e.jsx("div",{className:"font-medium",children:l.establishedDate||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"建立時間"}),e.jsx("div",{className:"font-medium",children:l.createdAt||"-"})]})]})})}),e.jsx(D,{isOpen:U&&!!l,onClose:()=>g(!1),title:l?`編輯供應商：${l.companyName}`:"編輯供應商",children:l&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"狀態"}),e.jsx(x,{value:u.status,onChange:a=>j(s=>({...s,status:a})),options:[{value:t.ACTIVE,label:"活躍"},{value:t.PENDING,label:"待審核"},{value:t.SUSPENDED,label:"暫停"},{value:t.BLACKLISTED,label:"黑名單"},{value:"inactive",label:"停用"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"分級"}),e.jsx(x,{value:u.grade,onChange:a=>j(s=>({...s,grade:a})),options:[{value:r.A_STRATEGIC,label:"A"},{value:r.B_PREFERRED,label:"B"},{value:r.C_QUALIFIED,label:"C"},{value:r.D_CONDITIONAL,label:"D"},{value:r.E_UNQUALIFIED,label:"E"}]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"網站"}),e.jsx("input",{type:"text",className:c.input,value:u.website,onChange:a=>j(s=>({...s,website:a.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:c.secondaryButton,onClick:()=>g(!1),children:"取消"}),e.jsx("button",{className:`${c.primaryButton} ${k?"opacity-70 pointer-events-none":""}`,onClick:R,children:k?"儲存中…":"儲存變更"})]})]})}),e.jsx(D,{isOpen:_,onClose:()=>N(!1),title:"新增供應商",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"供應商名稱"}),e.jsx("input",{type:"text",className:c.input,value:n.companyName,onChange:a=>m(s=>({...s,companyName:a.target.value})),placeholder:"例如：美妝世界股份有限公司"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"產業"}),e.jsx("input",{type:"text",className:c.input,value:n.industry,onChange:a=>m(s=>({...s,industry:a.target.value})),placeholder:"例如：化妝品批發"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"統一編號"}),e.jsx("input",{type:"text",className:c.input,value:n.taxId,onChange:a=>m(s=>({...s,taxId:a.target.value})),placeholder:"例如：12345678"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"網站"}),e.jsx("input",{type:"text",className:c.input,value:n.website,onChange:a=>m(s=>({...s,website:a.target.value})),placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"成立日期"}),e.jsx("input",{type:"date",className:c.input,value:n.establishedDate,onChange:a=>m(s=>({...s,establishedDate:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"狀態"}),e.jsx(x,{value:n.status,onChange:a=>m(s=>({...s,status:a})),options:[{value:t.ACTIVE,label:"活躍"},{value:t.PENDING,label:"待審核"},{value:t.SUSPENDED,label:"暫停"},{value:t.BLACKLISTED,label:"黑名單"},{value:"inactive",label:"停用"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"分級"}),e.jsx(x,{value:n.grade,onChange:a=>m(s=>({...s,grade:a})),options:[{value:r.A_STRATEGIC,label:"A"},{value:r.B_PREFERRED,label:"B"},{value:r.C_QUALIFIED,label:"C"},{value:r.D_CONDITIONAL,label:"D"},{value:r.E_UNQUALIFIED,label:"E"}]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:c.secondaryButton,onClick:()=>N(!1),children:"取消"}),e.jsx("button",{className:`${c.primaryButton} ${T?"opacity-70 pointer-events-none":""}`,onClick:$,children:T?"建立中…":"建立供應商"})]})]})})]})};export{pe as default};
