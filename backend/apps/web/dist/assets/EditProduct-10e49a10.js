import{e as G,u as A,r as o,j as e,A as r}from"./index-09c3368c.js";import{m as O}from"./mockProductData-8411f5af.js";import{N as E,I as z,P as B}from"./NestedSKUManager-f82465e3.js";import{A as L,P as q,C as Q,S as R,a as X}from"./AlertBox-ad9089e9.js";import{X as Y}from"./XMarkIcon-93d59038.js";import{P as _}from"./PlusIcon-3d2e3b30.js";import{C as H}from"./CubeIcon-1f7f940f.js";import{C as J}from"./ChevronRightIcon-4b094a17.js";import{C as W}from"./CheckCircleIcon-377c1a08.js";import{I as Z}from"./InformationCircleIcon-90a29bbe.js";import{C as ee}from"./CurrencyDollarIcon-a9a09c91.js";import{T as S}from"./TagIcon-88ee5672.js";import"./QRCodeGenerator-edf9c63c.js";import"./GlassModal-a6c5f610.js";import"./QrCodeIcon-0fb2cc7f.js";import"./ArrowDownTrayIcon-2accbe6b.js";import"./PencilIcon-619ae986.js";import"./ChevronDownIcon-05511def.js";import"./Cog6ToothIcon-f8515c56.js";import"./TrashIcon-41cd83e4.js";import"./ExclamationTriangleIcon-8f54841e.js";import"./categoryDataManager-0be0a985.js";import"./CheckIcon-ef591eb6.js";const se={name:"",slug:"",description:"",shortDescription:"",categories:[],tags:[],price:"",comparePrice:"",costPrice:"",profit:"",profitMargin:"",baseSKU:"",hasVariants:!1,skuVariants:[],images:[],status:"draft",visibility:"visible",featured:!1,metaTitle:"",metaDescription:"",sitemapIndexing:!0,customCanonicalUrl:"",openGraphTitle:"",openGraphDescription:"",openGraphImage:"",useMetaTitleForOG:!0,useMetaDescriptionForOG:!0,excludeFromSearch:!1,searchTitle:"",searchDescription:"",searchImage:"",useMetaTitleForSearch:!0,useMetaDescriptionForSearch:!0,useOpenGraphImageForSearch:!0},ke=()=>{const{sku:b}=G(),j=A(),x=o.useMemo(()=>O.find(s=>s.baseSKU===b),[b]),f=o.useCallback(s=>s?{name:s.name||"",slug:s.slug||"",description:s.description||"",shortDescription:s.shortDescription||"",categories:Array.isArray(s.categories)?s.categories:s.category?[{name:s.category,slug:s.category}]:[],tags:Array.isArray(s.tags)?s.tags:[],price:s.price??"",comparePrice:s.comparePrice??s.originalPrice??"",costPrice:s.costPrice??"",profit:s.profit??"",profitMargin:s.profitMargin??"",baseSKU:s.baseSKU||"",hasVariants:!!s.hasVariants,skuVariants:Array.isArray(s.skuVariants)?s.skuVariants:[],images:Array.isArray(s.images)?s.images:s.image?[{id:Date.now(),url:s.image,name:"cover.jpg",size:0,type:"image/jpeg"}]:[],status:s.status||"draft",visibility:s.visibility||"visible",featured:!!s.featured,metaTitle:s.metaTitle||"",metaDescription:s.metaDescription||"",sitemapIndexing:s.sitemapIndexing!==!1,customCanonicalUrl:s.customCanonicalUrl||"",openGraphTitle:s.openGraphTitle||"",openGraphDescription:s.openGraphDescription||"",openGraphImage:s.openGraphImage||"",useMetaTitleForOG:s.useMetaTitleForOG!==!1,useMetaDescriptionForOG:s.useMetaDescriptionForOG!==!1,excludeFromSearch:!!s.excludeFromSearch,searchTitle:s.searchTitle||"",searchDescription:s.searchDescription||"",searchImage:s.searchImage||"",useMetaTitleForSearch:s.useMetaTitleForSearch!==!1,useMetaDescriptionForSearch:s.useMetaDescriptionForSearch!==!1,useOpenGraphImageForSearch:s.useOpenGraphImageForSearch!==!1}:{...se},[]),[n,h]=o.useState(0),[t,C]=o.useState(f(x)),[c,y]=o.useState({}),[u,k]=o.useState(""),[w,K]=o.useState([]),[d,N]=o.useState({show:!1,message:"",type:"warning"});o.useEffect(()=>{C(f(x))},[x,f]);const g=[{id:"basic",title:"基本資訊",description:"設定產品名稱、描述和基礎 SKU",icon:Z,isCompleted:!1},{id:"pricing",title:"定價設定",description:"設定價格、成本和利潤（無變體商品）",icon:ee,isCompleted:!1},{id:"variants",title:"SKU 變體管理",description:"設定五層巢狀 SKU 變體和庫存",icon:S,isCompleted:!1},{id:"categories",title:"商品分類",description:"設定商品分類歸屬",icon:S,isCompleted:!1},{id:"media",title:"圖片媒體",description:"上傳產品圖片和媒體",icon:B,isCompleted:!1},{id:"seo",title:"SEO 設定",description:"搜尋引擎優化設定",icon:S,isCompleted:!1}],l=(s,a)=>{C(i=>({...i,[s]:a})),c[s]&&y(i=>({...i,[s]:null}))},F=(s,a)=>l(s,a),U=()=>{u.trim()&&!t.tags.includes(u.trim())&&(l("tags",[...t.tags,u.trim()]),k(""))},I=s=>l("tags",t.tags.filter(a=>a!==s)),V=s=>{h(s),y({})},T=()=>{const s=parseFloat(t.price)||0,a=parseFloat(t.costPrice)||0,i=s-a,p=s>0?(i/s*100).toFixed(2):0;l("profit",i.toFixed(2)),l("profitMargin",p)},v=s=>s?s.toLowerCase().trim().replace(/[\u4e00-\u9fff]/g,a=>`char-${a.charCodeAt(0)}`).replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").substring(0,50):"",P=s=>{const a=g[s],i={};switch(a.id){case"basic":t.name.trim()||(i.name="產品名稱為必填項目"),t.slug.trim()?/^[a-z0-9-]+$/.test(t.slug)||(i.slug="路由只能包含小寫英文、數字和連字符"):i.slug="產品路由為必填項目",t.description.trim()||(i.description="產品描述為必填項目"),t.baseSKU.trim()?/^[a-z0-9]+$/.test(t.baseSKU)||(i.baseSKU="基礎 SKU 只能包含小寫英文和數字"):i.baseSKU="基礎 SKU 為必填項目";break;case"pricing":t.hasVariants||(!t.price||parseFloat(t.price)<=0)&&(i.price="請輸入有效的銷售價格");break;case"variants":t.hasVariants&&((t.skuVariants||[]).length===0?i.skuVariants="請設定至少一個 SKU 變體":t.skuVariants.filter(m=>m.isActive&&(!m.price||m.trackQuantity&&!m.quantity)).length>0&&(i.skuVariants="請為所有啟用的變體設定價格和庫存"));break}return y(i),Object.keys(i).length===0},D=()=>{P(n)&&(w.includes(n)||K(s=>[...s,n]),h(s=>Math.min(s+1,g.length-1)))},M=()=>h(s=>Math.max(s-1,0)),$=async()=>{for(let s=0;s<g.length;s++)if(!P(s)){h(s);return}try{const s={...t,price:parseFloat(t.price)||0,comparePrice:parseFloat(t.comparePrice)||0,costPrice:parseFloat(t.costPrice)||0,images:(t.images||[]).map(a=>({id:a.id,url:a.url,name:a.name,size:a.size,isMain:a===t.images[0]})),skuVariants:t.hasVariants?(t.skuVariants||[]).map(a=>{var i,p,m;return{...a,price:parseFloat(a.price)||0,comparePrice:parseFloat(a.comparePrice)||0,costPrice:parseFloat(a.costPrice)||0,quantity:parseInt(a.quantity)||0,lowStockThreshold:parseInt(a.lowStockThreshold)||0,weight:parseFloat(a.weight)||0,dimensions:{length:parseFloat((i=a.dimensions)==null?void 0:i.length)||0,width:parseFloat((p=a.dimensions)==null?void 0:p.width)||0,height:parseFloat((m=a.dimensions)==null?void 0:m.height)||0},trackQuantity:!!a.trackQuantity,allowBackorder:!!a.allowBackorder,isActive:!!a.isActive}}):[]};console.log("更新產品資料 payload:",s),await new Promise(a=>setTimeout(a,800)),N({show:!0,type:"success",title:"儲存成功",message:`商品「${t.name}」已更新。`}),setTimeout(()=>j("/products"),1200)}catch(s){console.error(s),N({show:!0,type:"error",title:"儲存失敗",message:"更新時發生錯誤，請稍後重試。"})}};return x?e.jsx("div",{className:r.pageContainer,children:e.jsxs("div",{className:r.contentContainerFluid,children:[e.jsx(L,{show:d.show,onClose:()=>N({...d,show:!1}),title:d.title,message:d.message,type:d.type,autoClose:d.type==="success"?3e3:0}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"w-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"編輯商品"}),e.jsxs("p",{className:"text-gray-600 font-chinese mt-1",children:["SKU：",e.jsx("span",{className:"font-mono",children:t.baseSKU})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1 bg-[#cc824d]/10 text-[#cc824d] rounded-full text-sm font-medium",children:["步驟 ",n+1," / ",6,": ",["基本資訊","定價設定","SKU 變體管理","商品分類","圖片媒體","SEO 設定"][n]]})})]}),e.jsx("div",{className:"flex-1",children:e.jsx(q,{steps:g,currentStep:n,onStepClick:V,completedSteps:w,compact:!0})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-8",children:[n===0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"基本資訊"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品名稱 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",id:"name",value:t.name,onChange:s=>{if(l("name",s.target.value),!t.slug||t.slug===v(t.name)){const a=v(s.target.value);l("slug",a)}},className:`${r.input} ${c.name?"border-red-500":""}`,placeholder:"輸入產品名稱"}),c.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品路由 (Slug) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",name:"slug",id:"slug",value:t.slug,onChange:s=>l("slug",s.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-")),className:`${r.input} ${c.slug?"border-red-500":""}`,placeholder:"product-slug",pattern:"[a-z0-9-]+"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"/products/"})})]}),e.jsx("button",{type:"button",onClick:()=>l("slug",v(t.name)),className:"px-3 py-2 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors",disabled:!t.name,children:"自動生成"})]}),c.slug&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.slug}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["產品網址將是: ",window.location.origin,"/",t.categories.length>0?t.categories[0].slug||"category":"products","/",t.slug||"product-slug"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["基礎 SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"baseSKU",id:"baseSKU",value:t.baseSKU,onChange:s=>l("baseSKU",s.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")),className:`${r.input} ${c.baseSKU?"border-red-500":""}`,placeholder:"例如：iphone",maxLength:20}),c.baseSKU&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.baseSKU}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["基礎 SKU 將作為所有變體的前綴，例如：",t.baseSKU||"iphone","bkpro"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"簡短描述"}),e.jsx("input",{type:"text",value:t.shortDescription,onChange:s=>l("shortDescription",s.target.value),className:r.input,placeholder:"一句話描述產品特色"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品描述 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"description",id:"description",value:t.description,onChange:s=>l("description",s.target.value),rows:4,className:`${r.input} ${c.description?"border-red-500":""}`,placeholder:"詳細描述產品功能、特色和使用方法"}),c.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品標籤"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.tags.map(s=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-[#cc824d] text-white",children:[s,e.jsx("button",{type:"button",onClick:()=>I(s),className:"ml-2 text-white hover:text-gray-200",children:e.jsx(Y,{className:"w-4 h-4"})})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:s=>k(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),U()),className:r.input,placeholder:"輸入標籤名稱"}),e.jsx("button",{type:"button",onClick:U,className:r.btnSecondary,children:e.jsx(_,{className:"w-4 h-4"})})]})]})]})]}),n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"定價設定"}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-amber-800",children:["💡 ",e.jsx("strong",{children:"注意："}),"有多個變體時，基礎價會與變體差額相加，最終價格顯示在變體面板。"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["銷售價格 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",name:"price",id:"price",value:t.price,onChange:s=>{l("price",s.target.value),setTimeout(T,100)},className:`${r.input} pl-12 ${c.price?"border-red-500":""}`,placeholder:"0",min:"0",step:"0.01"})]}),c.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"比較價格（原價）"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",value:t.comparePrice,onChange:s=>l("comparePrice",s.target.value),className:`${r.input} pl-12`,placeholder:"0",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"成本價格"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",value:t.costPrice,onChange:s=>{l("costPrice",s.target.value),setTimeout(T,100)},className:`${r.input} pl-12`,placeholder:"0",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利潤"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"text",value:t.profit,readOnly:!0,className:`${r.input} pl-12 bg-gray-50`,placeholder:"0"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利潤率"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.profitMargin,readOnly:!0,className:`${r.input} pr-8 bg-gray-50`,placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]})]})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"SKU 變體管理"}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"hasVariants",checked:t.hasVariants,onChange:s=>l("hasVariants",s.target.checked),className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded focus:ring-[#cc824d]"}),e.jsx("label",{htmlFor:"hasVariants",className:"ml-2 text-sm text-gray-700",children:"此產品有多個 SKU 變體 (如不同顏色、尺寸、規格等)"})]}),!t.hasVariants&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"此商品為單一 SKU 商品"}),e.jsx("p",{className:"text-sm text-gray-500",children:"如果商品有不同的變體選項，請勾選上方的變體選項"}),t.baseSKU&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded border",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"商品 SKU:"}),e.jsx("p",{className:"font-mono text-lg text-[#cc824d]",children:t.baseSKU})]})]}),t.hasVariants&&e.jsx(E,{baseSKU:t.baseSKU,skuVariants:t.skuVariants,onChange:s=>l("skuVariants",s),basePrice:t.price,baseComparePrice:t.comparePrice,baseCostPrice:t.costPrice,productName:t.name,productCategories:t.categories}),c.skuVariants&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.skuVariants})]})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"商品分類設定"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"選擇商品分類 (可複選)"}),e.jsx(Q,{selectedCategories:t.categories,onChange:s=>l("categories",s)})]})]}),n===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"圖片媒體"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品圖片"}),e.jsx(z,{images:t.images,onChange:s=>l("images",s),maxImages:10})]})]}),n===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:r.sectionTitle,children:"SEO 設定"}),e.jsx(R,{productData:t,onChange:F,errors:c,categories:t.categories})]})]}),e.jsxs("div",{className:"border-t border-gray-200 px-8 py-6 flex items-center justify-between bg-gray-50 rounded-b-xl",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>j("/products"),className:r.btnSecondary,children:"取消"}),n>0&&e.jsxs("button",{type:"button",onClick:M,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," 上一步"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["步驟 ",n+1," / 6"]}),e.jsx("div",{className:"flex space-x-3",children:n<5?e.jsxs("button",{type:"button",onClick:D,className:"inline-flex items-center px-6 py-2 bg-[#cc824d] text-white rounded-lg text-sm font-medium hover:bg-[#b86c37] transition-colors shadow-sm",children:["下一步 ",e.jsx(J,{className:"w-4 h-4 ml-2"})]}):e.jsxs("button",{type:"button",onClick:$,className:"inline-flex items-center px-8 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"})," 儲存變更"]})})]})]})]})]})}):e.jsx("div",{className:r.pageContainer,children:e.jsx("div",{className:r.contentContainerFluid,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"找不到此商品"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["SKU: ",b]}),e.jsx("button",{onClick:()=>j("/products"),className:"mt-6 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800",children:"返回商品列表"})]})})})};export{ke as default};
