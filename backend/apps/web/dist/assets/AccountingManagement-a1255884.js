import{r as d,j as e,A as Z}from"./index-5be64975.js";import{S as T}from"./StandardTable-046e436b.js";import{G as C}from"./GlassModal-8d9cbd14.js";import{I as S}from"./IconActionButton-2bcd0b2a.js";import{S as $}from"./SearchableSelect-06cd3eb3.js";import{E as A}from"./EyeIcon-db27fda4.js";import{P as I}from"./PencilIcon-0921d86f.js";import{P}from"./PlusIcon-86b6a2f5.js";import"./chevron-down-e41c1b61.js";import"./XMarkIcon-404a829f.js";function V({title:t,titleId:n,...r},l){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":n},r),t?d.createElement("title",{id:n},t):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5Zm0 2.25h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V18Zm2.498-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z"}))}const D=d.forwardRef(V),F=D,v=t=>String(t).padStart(2,"0"),y=(t,n)=>Math.floor(Math.random()*(n-t+1))+t,f=t=>t[Math.floor(Math.random()*t.length)],k=["發票","收據","請款單","費用報銷"],M=["draft","submitted","approved","paid","void"],u=Array.from({length:35}).map((t,n)=>{const r=new Date(Date.now()-y(0,120)*864e5),l=`${r.getFullYear()}-${v(r.getMonth()+1)}-${v(r.getDate())}`,h=y(500,1e4),o=Math.round(h*.05),m=h+o;return{id:`ACC-${1e3+n}`,docNo:`A${r.getFullYear()}${v(r.getMonth()+1)}-${1e3+n}`,type:f(k),date:l,period:`${r.getFullYear()}-${v(r.getMonth()+1)}`,partner:f(["美樂有限公司","安盛股份有限公司","群益科技","福臨門企業"]),subtotal:h,tax:o,total:m,status:f(M),note:f(["","專案 X 報支","年度保固費用","行銷合作款"])}}),g={async list(){return await new Promise(t=>setTimeout(t,80)),{success:!0,data:[...u]}},async getById(t){await new Promise(r=>setTimeout(r,50));const n=u.find(r=>r.id===t);return n?{success:!0,data:{...n}}:{success:!1}},async update(t,n){const r=u.findIndex(l=>l.id===t);return r===-1?{success:!1}:(u[r]={...u[r],...n},await new Promise(l=>setTimeout(l,60)),{success:!0,data:{...u[r]}})},async create(t){const n=t!=null&&t.date?new Date(t.date):new Date,r=n.getFullYear(),l=v(n.getMonth()+1),h=v(n.getDate()),o=1e3+u.length+1,m=(t==null?void 0:t.id)||`ACC-${o}`,j=(t==null?void 0:t.docNo)||`A${r}${l}-${o}`,c=Number((t==null?void 0:t.subtotal)||0),i=Number((t==null?void 0:t.tax)??Math.round(c*.05)),p=Number((t==null?void 0:t.total)??c+i),N={id:m,docNo:j,type:(t==null?void 0:t.type)||k[0],date:(t==null?void 0:t.date)||`${r}-${l}-${h}`,period:(t==null?void 0:t.period)||`${r}-${l}`,partner:(t==null?void 0:t.partner)||"",subtotal:c,tax:i,total:p,status:(t==null?void 0:t.status)||"draft",note:(t==null?void 0:t.note)||""};return u.unshift(N),await new Promise(s=>setTimeout(s,80)),{success:!0,data:{...N}}},TYPES:k,STATUSES:M},b=t=>`NT$ ${Number(t||0).toLocaleString()}`,w=t=>({draft:"草稿",submitted:"已送審",approved:"已核准",paid:"已付款",void:"作廢"})[t]||t;function W(){const[t,n]=d.useState([]),[r,l]=d.useState(null),[h,o]=d.useState(!1),[m,j]=d.useState(null),[c,i]=d.useState({docNo:"",type:"",date:"",partner:"",subtotal:0,tax:0,total:0,status:"draft",note:""});d.useEffect(()=>{(async()=>{const s=await g.list();s.success&&n(s.data)})()},[]);const p=d.useMemo(()=>(g.STATUSES||[]).map(s=>({value:s,label:w(s)})),[]),N=d.useMemo(()=>[{key:"docNo",label:"單據編號",sortable:!0,render:s=>e.jsx("span",{className:"font-mono text-sm",children:s})},{key:"type",label:"類型",sortable:!0},{key:"date",label:"日期",sortable:!0},{key:"partner",label:"往來對象",sortable:!0},{key:"subtotal",label:"未稅",sortable:!0,render:s=>e.jsx("span",{children:b(s)})},{key:"tax",label:"稅額",sortable:!0,render:s=>e.jsx("span",{children:b(s)})},{key:"total",label:"含稅",sortable:!0,render:s=>e.jsx("strong",{children:b(s)})},{key:"status",label:"狀態",sortable:!0,render:s=>e.jsx("span",{className:`inline-flex items-center px-2 py-1 text-xs rounded-full font-chinese ${s==="approved"?"bg-green-100 text-green-800":s==="submitted"?"bg-blue-100 text-blue-800":s==="paid"?"bg-purple-100 text-purple-800":s==="void"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:w(s)})},{key:"actions",label:"操作",sortable:!1,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{Icon:A,label:"查看",variant:"blue",onClick:()=>{o(!1),l(a)}}),e.jsx(S,{Icon:I,label:"編輯",variant:"amber",onClick:()=>{l(null),j(a),i({...a}),o(!0)}})]})}],[]);return e.jsx("div",{className:"min-h-screen bg-[#fdf8f2]",children:e.jsxs("div",{className:Z.contentContainerFluid,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-8 h-8 text-amber-500"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-chinese",children:"會計管理"})]}),e.jsxs("button",{className:"inline-flex items-center px-4 py-2 bg-[#cc824d] text-white text-sm rounded-lg hover:bg-[#b86c37] transition-all duration-200 shadow-sm font-chinese",onClick:()=>{var s;l(null),j(null),i({docNo:"",type:((s=g.TYPES)==null?void 0:s[0])||"",date:"",partner:"",subtotal:0,tax:0,total:0,status:"draft",note:""}),o(!0)},children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"新增日記帳"]})]}),e.jsx(T,{title:"單據列表",data:t,columns:N,exportFileName:"會計單據"}),e.jsx(C,{isOpen:!!r,onClose:()=>l(null),title:`單據詳情：${r==null?void 0:r.docNo}`,size:"max-w-3xl",children:r&&e.jsxs("div",{className:"p-6 pt-0 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"類型"}),e.jsx("div",{className:"text-sm mt-1",children:r.type})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"日期"}),e.jsx("div",{className:"text-sm mt-1",children:r.date})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"往來對象"}),e.jsx("div",{className:"text-sm mt-1",children:r.partner})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"狀態"}),e.jsx("div",{className:"mt-1 inline-flex px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-700",children:w(r.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"未稅"}),e.jsx("div",{className:"text-sm mt-1",children:b(r.subtotal)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"稅額"}),e.jsx("div",{className:"text-sm mt-1",children:b(r.tax)})]}),e.jsxs("div",{className:"glass rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"含稅"}),e.jsx("div",{className:"text-sm font-semibold mt-1",children:b(r.total)})]})]})]})}),e.jsx(C,{isOpen:h,onClose:()=>o(!1),title:m?"編輯日記帳":"新增日記帳",size:"max-w-3xl",children:e.jsxs("div",{className:"p-6 pt-0 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"單據編號"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.docNo||"",onChange:s=>i(a=>({...a,docNo:s.target.value})),placeholder:"留空自動產生"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"類型"}),e.jsx($,{options:g.TYPES||[],value:c.type||"",onChange:s=>i(a=>({...a,type:s})),placeholder:"選擇類型"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"日期"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.date||"",onChange:s=>i(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"往來對象"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.partner||"",onChange:s=>i(a=>({...a,partner:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"未稅"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.subtotal||0,onChange:s=>{const a=Number(s.target.value||0),x=Math.round(a*.05);i(E=>({...E,subtotal:a,tax:x,total:a+x}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"稅額"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.tax||0,onChange:s=>{const a=Number(s.target.value||0);i(x=>({...x,tax:a,total:Number(x.subtotal||0)+a}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"含稅"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",value:c.total||0,onChange:s=>{const a=Number(s.target.value||0);i(x=>({...x,total:a}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"狀態"}),e.jsx($,{options:p,value:c.status||"draft",onChange:s=>i(a=>({...a,status:s})),placeholder:"選擇狀態"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"備註"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3,value:c.note||"",onChange:s=>i(a=>({...a,note:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200",onClick:()=>o(!1),children:"取消"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-[#cc824d] text-white hover:bg-[#b86c37]",onClick:async()=>{if(m){const s=await g.update(m.id,c);s!=null&&s.success&&n(a=>a.map(x=>x.id===m.id?s.data:x))}else{const s=await g.create(c);s!=null&&s.success&&n(a=>[s.data,...a])}o(!1),j(null)},children:"儲存"})]})]})})]})})}export{W as default};
