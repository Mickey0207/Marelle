import{b as y,r as i,j as e,A as d}from"./index-5be64975.js";import{G as N}from"./GlassModal-8d9cbd14.js";import{l as v,u as w,s as k}from"./index-3a4190b3.js";import"./XMarkIcon-404a829f.js";const P=()=>{const{currentUser:s}=y(),[r,o]=i.useState(""),[m,h]=i.useState(""),[g,u]=i.useState(""),[b,n]=i.useState(!1),[p,l]=i.useState({open:!1,message:""});i.useEffect(()=>{let a=!0;return(async()=>{if(s!=null&&s.id)try{n(!0);const c=(await v()||[]).find(x=>x.id===s.id||x.email===s.email);a&&c&&(o(c.display_name||""),h(c.department||""))}catch(t){l({open:!0,message:(t==null?void 0:t.message)||"載入個人資料失敗"})}finally{n(!1)}})(),()=>{a=!1}},[s]);const f=async a=>{if(a.preventDefault(),!!(s!=null&&s.id))try{n(!0),await w(s.id,{display_name:r,department:m}),l({open:!0,message:"已儲存變更"})}catch(t){l({open:!0,message:(t==null?void 0:t.message)||"儲存失敗"})}finally{n(!1)}},j=async()=>{if(s!=null&&s.id)try{n(!0),await k(s.id),l({open:!0,message:"已寄出重設密碼信，請至信箱收信完成變更。"})}catch(a){l({open:!0,message:(a==null?void 0:a.message)||"寄送失敗"})}finally{n(!1)}};return e.jsx("div",{className:d.pageContainer,children:e.jsxs("div",{className:d.contentContainer,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:d.pageTitle,children:"帳號設定 · 個人資料"}),e.jsx("p",{className:d.pageSubtitle,children:"管理您的基本資訊與安全設定"})]}),e.jsxs("form",{onSubmit:f,className:"bg-white/40 backdrop-blur-sm rounded-lg p-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 font-chinese",children:"帳號資訊"}),e.jsx("div",{className:"grid grid-cols-2 gap-6",children:e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"E-mail"}),e.jsx("input",{type:"email",value:(s==null?void 0:s.email)||"",disabled:!0,className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm text-gray-700"})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 font-chinese",children:"安全設定"}),e.jsx("div",{className:"grid grid-cols-2 gap-6 items-end",children:e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"密碼"}),e.jsxs("div",{className:"flex items-center gap-3 flex-nowrap",children:[e.jsx("input",{type:"password",value:"********",disabled:!0,className:"flex-1 min-w-0 p-3 border rounded-lg bg-white/50 backdrop-blur-sm text-gray-700"}),e.jsx("button",{type:"button",onClick:j,className:"bg-[#cc824d] text-white px-4 py-2 rounded-lg hover:bg-[#b86c37] transition-colors font-chinese shrink-0",children:"更改密碼"})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 font-chinese",children:"個人資訊"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"部門"}),e.jsx("input",{type:"text",value:m,onChange:a=>h(a.target.value),placeholder:"輸入部門",className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm placeholder-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"暱稱"}),e.jsx("input",{type:"text",value:r,onChange:a=>o(a.target.value),placeholder:"輸入暱稱",className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm placeholder-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 font-chinese",children:"電話"}),e.jsx("input",{type:"tel",value:g,onChange:a=>u(a.target.value),placeholder:"輸入電話",className:"w-full p-3 border rounded-lg bg-white/50 backdrop-blur-sm placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{type:"submit",className:"bg-[#cc824d] text-white px-6 py-3 rounded-lg hover:bg-[#b86c37] transition-colors font-chinese",children:b?"儲存中…":"儲存變更"})})]}),e.jsx(N,{isOpen:p.open,onClose:()=>l({open:!1,message:""}),title:"通知",size:"max-w-md",children:e.jsxs("div",{className:"pt-0 px-6 pb-6 space-y-4",children:[e.jsx("p",{className:"text-gray-700 font-chinese",children:p.message}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:d.btnPrimary,onClick:()=>l({open:!1,message:""}),children:"關閉"})})]})})]})})};export{P as default};
