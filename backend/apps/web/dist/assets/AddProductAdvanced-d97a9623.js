import{u as B,r as u,j as e,A as c}from"./index-09c3368c.js";import{N as G,I as L,P as q}from"./NestedSKUManager-f82465e3.js";import{A as Q,P as R,C as X,S as Y,a as _}from"./AlertBox-ad9089e9.js";import{X as H}from"./XMarkIcon-93d59038.js";import{P as J}from"./PlusIcon-3d2e3b30.js";import{C as W}from"./CubeIcon-1f7f940f.js";import{C as Z}from"./ChevronRightIcon-4b094a17.js";import{C as ee}from"./CheckCircleIcon-377c1a08.js";import{I as se}from"./InformationCircleIcon-90a29bbe.js";import{C as te}from"./CurrencyDollarIcon-a9a09c91.js";import{T as S}from"./TagIcon-88ee5672.js";import"./QRCodeGenerator-edf9c63c.js";import"./GlassModal-a6c5f610.js";import"./QrCodeIcon-0fb2cc7f.js";import"./ArrowDownTrayIcon-2accbe6b.js";import"./PencilIcon-619ae986.js";import"./ChevronDownIcon-05511def.js";import"./Cog6ToothIcon-f8515c56.js";import"./TrashIcon-41cd83e4.js";import"./ExclamationTriangleIcon-8f54841e.js";import"./categoryDataManager-0be0a985.js";import"./CheckIcon-ef591eb6.js";const Ce=()=>{var V;const k=B(),[m,b]=u.useState(0),[s,$]=u.useState({name:"",slug:"",description:"",shortDescription:"",categories:[],tags:[],price:"",comparePrice:"",costPrice:"",profit:"",profitMargin:"",baseSKU:"",hasVariants:!1,skuVariants:[],images:[],status:"draft",visibility:"visible",featured:!1,metaTitle:"",metaDescription:"",sitemapIndexing:!0,customCanonicalUrl:"",openGraphTitle:"",openGraphDescription:"",openGraphImage:"",useMetaTitleForOG:!0,useMetaDescriptionForOG:!0,excludeFromSearch:!1,searchTitle:"",searchDescription:"",searchImage:"",useMetaTitleForSearch:!0,useMetaDescriptionForSearch:!0,useOpenGraphImageForSearch:!0}),[n,j]=u.useState({}),[f,C]=u.useState(""),[w,P]=u.useState([]),[h,N]=u.useState({show:!1,message:"",type:"warning"}),p=[{id:"basic",title:"基本資訊",description:"設定產品名稱、描述和基礎 SKU",icon:se,isCompleted:!1},{id:"pricing",title:"定價設定",description:"設定價格、成本和利潤（無變體商品）",icon:te,isCompleted:!1},{id:"variants",title:"SKU 變體管理",description:"設定五層巢狀 SKU 變體和庫存",icon:S,isCompleted:!1},{id:"categories",title:"商品分類",description:"設定商品分類歸屬",icon:S,isCompleted:!1},{id:"media",title:"圖片媒體",description:"上傳產品圖片和媒體",icon:q,isCompleted:!1},{id:"seo",title:"SEO 設定",description:"搜尋引擎優化設定",icon:S,isCompleted:!1}],o=(t,a)=>{$(i=>({...i,[t]:a})),n[t]&&j(i=>({...i,[t]:null}))},T=(t,a)=>{o(t,a)},U=()=>{f.trim()&&!s.tags.includes(f.trim())&&(o("tags",[...s.tags,f.trim()]),C(""))},I=t=>{o("tags",s.tags.filter(a=>a!==t))},F=t=>{b(t),j({})},D=t=>{setTimeout(()=>{const a=document.querySelector(`[name="${t}"], #${t}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.focus())},100)},K=()=>{const t=parseFloat(s.price)||0,a=parseFloat(s.costPrice)||0,i=t-a,l=a>0?(i/t*100).toFixed(2):0;o("profit",i.toFixed(2)),o("profitMargin",l)},y=t=>t?t.toLowerCase().trim().replace(/[\u4e00-\u9fff]/g,a=>`char-${a.charCodeAt(0)}`).replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").substring(0,50):"",O=t=>{const a=p[t],i={};switch(a.id){case"basic":s.name.trim()||(i.name="產品名稱為必填項目"),s.slug.trim()?/^[a-z0-9-]+$/.test(s.slug)||(i.slug="路由只能包含小寫英文、數字和連字符"):i.slug="產品路由為必填項目",s.description.trim()||(i.description="產品描述為必填項目"),s.baseSKU.trim()?/^[a-z0-9]+$/.test(s.baseSKU)||(i.baseSKU="基礎 SKU 只能包含小寫英文和數字"):i.baseSKU="基礎 SKU 為必填項目";break;case"pricing":s.hasVariants||(!s.price||parseFloat(s.price)<=0)&&(i.price="請輸入有效的銷售價格");break;case"variants":s.hasVariants&&(s.skuVariants.length===0?i.skuVariants="請設定至少一個 SKU 變體":s.skuVariants.filter(r=>r.isActive&&(!r.price||r.trackQuantity&&!r.quantity)).length>0&&(i.skuVariants="請為所有啟用的變體設定價格和庫存"));break}return j(i),Object.keys(i).length===0},E=()=>{O(m)&&(w.includes(m)||P(t=>[...t,m]),b(t=>Math.min(t+1,p.length-1)))},A=()=>{b(t=>Math.max(t-1,0))},M=async()=>{const t={};let a=-1,i=null;for(let l=0;l<p.length;l++){const r=p[l],d={};switch(r.id){case"basic":s.name.trim()||(d.name="產品名稱為必填項目",a===-1&&(a=l,i="name")),s.slug.trim()?/^[a-z0-9-]+$/.test(s.slug)||(d.slug="路由只能包含小寫英文、數字和連字符",a===-1&&(a=l,i="slug")):(d.slug="產品路由為必填項目",a===-1&&(a=l,i="slug")),s.description.trim()||(d.description="產品描述為必填項目",a===-1&&(a=l,i="description")),s.baseSKU.trim()?/^[a-z0-9]+$/.test(s.baseSKU)||(d.baseSKU="基礎 SKU 只能包含小寫英文和數字",a===-1&&(a=l,i="baseSKU")):(d.baseSKU="基礎 SKU 為必填項目",a===-1&&(a=l,i="baseSKU"));break;case"pricing":s.hasVariants||(!s.price||parseFloat(s.price)<=0)&&(d.price="請輸入有效的銷售價格",a===-1&&(a=l,i="price"));break;case"variants":s.hasVariants&&(s.skuVariants.length===0?(d.skuVariants="請設定至少一個 SKU 變體",a===-1&&(a=l,i="skuVariants")):s.skuVariants.filter(x=>x.isActive&&(!x.price||x.trackQuantity&&!x.quantity)).length>0&&(d.skuVariants="請為所有啟用的變體設定價格和庫存",a===-1&&(a=l,i="skuVariants")));break}Object.keys(d).length>0&&(t[r.id]=d)}if(Object.keys(t).length>0){j(t[p[a].id]||{}),b(a);const l=Object.values(t).reduce((r,d)=>r+Object.keys(d).length,0);N({show:!0,type:"warning",title:"請完成必填項目",message:e.jsxs("div",{children:[e.jsxs("p",{children:["發現 ",l," 個未完成的必填項目："]}),e.jsx("ul",{className:"mt-2 text-xs space-y-1",children:Object.entries(t).map(([r,d])=>{var x;const g=(x=p.find(v=>v.id===r))==null?void 0:x.title;return Object.values(d).map((v,z)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-1 h-1 bg-current rounded-full mr-2"}),g,": ",v]},`${r}-${z}`))}).flat()})]})}),D(i);return}try{const l={...s,price:parseFloat(s.price)||0,comparePrice:parseFloat(s.comparePrice)||0,costPrice:parseFloat(s.costPrice)||0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),productId:`${s.baseSKU}-${Date.now()}`,images:s.images.map(r=>({id:r.id,url:r.url,name:r.name,size:r.size,isMain:r===s.images[0]})),skuVariants:s.hasVariants?s.skuVariants.map(r=>{var d,g,x;return{...r,price:parseFloat(r.price)||0,comparePrice:parseFloat(r.comparePrice)||0,costPrice:parseFloat(r.costPrice)||0,quantity:parseInt(r.quantity)||0,lowStockThreshold:parseInt(r.lowStockThreshold)||0,weight:parseFloat(r.weight)||0,dimensions:{length:parseFloat((d=r.dimensions)==null?void 0:d.length)||0,width:parseFloat((g=r.dimensions)==null?void 0:g.width)||0,height:parseFloat((x=r.dimensions)==null?void 0:x.height)||0},trackQuantity:!!r.trackQuantity,allowBackorder:!!r.allowBackorder,isActive:!!r.isActive}}):[],hasVariants:!!s.hasVariants,featured:!!s.featured};console.log("準備提交的產品資料:",l),await new Promise(r=>setTimeout(r,1e3)),N({show:!0,type:"success",title:"產品創建成功",message:`產品 "${s.name}" 已成功創建！
產品 ID: ${l.productId}`}),setTimeout(()=>{k("/products")},2e3)}catch(l){console.error("創建產品失敗:",l),N({show:!0,type:"error",title:"創建失敗",message:"創建產品時發生錯誤，請稍後再試。"})}};return e.jsx("div",{className:c.pageContainer,children:e.jsxs("div",{className:c.contentContainerFluid,children:[e.jsx(Q,{show:h.show,onClose:()=>N({...h,show:!1}),title:h.title,message:h.message,type:h.type,autoClose:h.type==="success"?3e3:0}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"w-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-chinese",children:"新增產品"}),e.jsx("p",{className:"text-gray-600 font-chinese mt-1",children:"創建新的產品並設定詳細資訊"}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1 bg-[#cc824d]/10 text-[#cc824d] rounded-full text-sm font-medium",children:["步驟 ",m+1," / ",p.length,": ",(V=p[m])==null?void 0:V.title]})})]}),e.jsx("div",{className:"flex-1",children:e.jsx(R,{steps:p,currentStep:m,onStepClick:F,completedSteps:w,compact:!0})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-8",children:[m===0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"基本資訊"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品名稱 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",id:"name",value:s.name,onChange:t=>{if(o("name",t.target.value),!s.slug||s.slug===y(s.name)){const a=y(t.target.value);o("slug",a)}},className:`${c.input} ${n.name?"border-red-500":""}`,placeholder:"輸入產品名稱"}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品路由 (Slug) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",name:"slug",id:"slug",value:s.slug,onChange:t=>o("slug",t.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-")),className:`${c.input} ${n.slug?"border-red-500":""}`,placeholder:"product-slug",pattern:"[a-z0-9-]+"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"/products/"})})]}),e.jsx("button",{type:"button",onClick:()=>o("slug",y(s.name)),className:"px-3 py-2 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors",disabled:!s.name,children:"自動生成"})]}),n.slug&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.slug}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["產品網址將是: ",window.location.origin,"/",s.categories.length>0?s.categories[0].slug||"category":"products","/",s.slug||"product-slug"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["基礎 SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"baseSKU",id:"baseSKU",value:s.baseSKU,onChange:t=>{const a=t.target.value.toLowerCase().replace(/[^a-z0-9]/g,"");o("baseSKU",a)},className:`${c.input} ${n.baseSKU?"border-red-500":""}`,placeholder:"例如：iphone",maxLength:20}),n.baseSKU&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.baseSKU}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["基礎 SKU 將作為所有變體的前綴，例如：",s.baseSKU||"iphone","bkpro"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"簡短描述"}),e.jsx("input",{type:"text",value:s.shortDescription,onChange:t=>o("shortDescription",t.target.value),className:c.input,placeholder:"一句話描述產品特色"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["產品描述 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"description",id:"description",value:s.description,onChange:t=>o("description",t.target.value),rows:4,className:`${c.input} ${n.description?"border-red-500":""}`,placeholder:"詳細描述產品功能、特色和使用方法"}),n.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品標籤"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:s.tags.map(t=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-[#cc824d] text-white",children:[t,e.jsx("button",{type:"button",onClick:()=>I(t),className:"ml-2 text-white hover:text-gray-200",children:e.jsx(H,{className:"w-4 h-4"})})]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:t=>C(t.target.value),onKeyPress:t=>t.key==="Enter"&&(t.preventDefault(),U()),className:c.input,placeholder:"輸入標籤名稱"}),e.jsx("button",{type:"button",onClick:U,className:c.btnSecondary,children:e.jsx(J,{className:"w-4 h-4"})})]})]})]})]}),m===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"定價設定"}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-amber-800",children:["💡 ",e.jsx("strong",{children:"注意："}),"如果您的商品有多個變體（如不同顏色、尺寸等），價格將在下一步的 SKU 變體管理中設定。 此處的定價僅適用於無變體的單一商品。"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["銷售價格 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",name:"price",id:"price",value:s.price,onChange:t=>{o("price",t.target.value),setTimeout(K,100)},className:`${c.input} pl-12 ${n.price?"border-red-500":""}`,placeholder:"0",min:"0",step:"0.01"})]}),n.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"比較價格（原價）"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",value:s.comparePrice,onChange:t=>o("comparePrice",t.target.value),className:`${c.input} pl-12`,placeholder:"0",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"成本價格"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"number",value:s.costPrice,onChange:t=>{o("costPrice",t.target.value),setTimeout(K,100)},className:`${c.input} pl-12`,placeholder:"0",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利潤"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"NT$"}),e.jsx("input",{type:"text",value:s.profit,readOnly:!0,className:`${c.input} pl-12 bg-gray-50`,placeholder:"0"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利潤率"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:s.profitMargin,readOnly:!0,className:`${c.input} pr-8 bg-gray-50`,placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]})]})]}),m===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"SKU 變體管理"}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"hasVariants",checked:s.hasVariants,onChange:t=>o("hasVariants",t.target.checked),className:"h-4 w-4 text-[#cc824d] border-gray-300 rounded focus:ring-[#cc824d]"}),e.jsx("label",{htmlFor:"hasVariants",className:"ml-2 text-sm text-gray-700",children:"此產品有多個 SKU 變體 (如不同顏色、尺寸、規格等)"})]}),!s.hasVariants&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"此商品為單一 SKU 商品"}),e.jsx("p",{className:"text-sm text-gray-500",children:"如果商品有不同的變體選項，請勾選上方的變體選項"}),s.baseSKU&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded border",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"商品 SKU:"}),e.jsx("p",{className:"font-mono text-lg text-[#cc824d]",children:s.baseSKU})]})]}),s.hasVariants&&e.jsx(G,{baseSKU:s.baseSKU,skuVariants:s.skuVariants,onChange:t=>o("skuVariants",t),basePrice:s.price,baseComparePrice:s.comparePrice,baseCostPrice:s.costPrice,productName:s.name,productCategories:s.categories}),n.skuVariants&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.skuVariants})]})]}),m===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"商品分類設定"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"選擇商品分類 (可複選)"}),e.jsx(X,{selectedCategories:s.categories,onChange:t=>o("categories",t)})]})]}),m===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"圖片媒體"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"產品圖片"}),e.jsx(L,{images:s.images,onChange:t=>o("images",t),maxImages:10})]})]}),m===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:c.sectionTitle,children:"SEO 設定"}),e.jsx(Y,{productData:s,onChange:T,errors:n,categories:s.categories})]})]}),e.jsxs("div",{className:"border-t border-gray-200 px-8 py-6 flex items-center justify-between bg-gray-50 rounded-b-xl",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>k("/products"),className:c.btnSecondary,children:"取消"}),m>0&&e.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"上一步"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["步驟 ",m+1," / ",p.length]}),e.jsx("div",{className:"flex space-x-3",children:m<p.length-1?e.jsxs("button",{type:"button",onClick:E,className:"inline-flex items-center px-6 py-2 bg-[#cc824d] text-white rounded-lg text-sm font-medium hover:bg-[#b86c37] transition-colors shadow-sm",children:["下一步",e.jsx(Z,{className:"w-4 h-4 ml-2"})]}):e.jsxs("button",{type:"button",onClick:M,className:"inline-flex items-center px-8 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"創建產品"]})})]})]})]})]})})};export{Ce as default};
