import{r as i,u as E,a as W,b as I,j as e,A as T,N as L,O as M}from"./index-5be64975.js";import{T as A}from"./TabNavigation-b0ee78ba.js";import{n as S}from"./notificationDataManager-7a4ef445.js";import{B as y}from"./BellIcon-679cf2a6.js";import{H as R}from"./HomeIcon-912b7f72.js";import{S as $}from"./ShoppingBagIcon-4ba987e2.js";import{C as B}from"./CubeIcon-717b6b1f.js";import{C as O}from"./ClipboardDocumentListIcon-c19d60a8.js";import{M as D}from"./MapPinIcon-12c3a05e.js";import{C as b}from"./ChartBarIcon-8ae14525.js";import{U as H}from"./UsersIcon-99672bc6.js";import{S as U}from"./ShoppingCartIcon-6bd4e4ac.js";import{C as _}from"./CurrencyDollarIcon-0b43bcd8.js";import{S as F}from"./StarIcon-cc45df6b.js";import{D as G}from"./DocumentTextIcon-f6a8ab1f.js";import{S as P}from"./ShieldCheckIcon-9ee831f8.js";import{C as X}from"./Cog6ToothIcon-88b00cb1.js";function Y(a){if(!a||typeof a!="string")return[];const t=a.toLowerCase();return t.startsWith("/dashboard")?[{id:"overview",label:"總覽",href:"/dashboard/overview"},{id:"analytics",label:"分析",href:"/dashboard/sales-analytics"},{id:"operations",label:"運營",href:"/dashboard/operations"}]:t.startsWith("/settings")?[{id:"system",label:"系統",href:"/settings"},{id:"general",label:"一般",href:"/settings/general"},{id:"security",label:"安全",href:"/settings/security"},{id:"payment",label:"金流",href:"/settings/payment"},{id:"shipping",label:"物流",href:"/settings/shipping"},{id:"notifications",label:"通知",href:"/settings/notifications"}]:t.startsWith("/accountsetting")?[{id:"profile",label:"個人資料",href:"/accountsetting/profile"},{id:"oauth",label:"第三方登入",href:"/accountsetting/oauth"},{id:"permissions",label:"權限管理",href:"/accountsetting/permissions"}]:t.startsWith("/marketing")?[{id:"coupons",label:"優惠券",href:"/marketing/coupons"},{id:"festivals",label:"節慶活動",href:"/marketing/festivals"},{id:"gifts",label:"贈品",href:"/marketing/gifts"}]:t.startsWith("/orders")?[{id:"credit",label:"信用卡",href:"/orders/credit"},{id:"atm",label:"ATM 轉帳",href:"/orders/atm"},{id:"cvscode",label:"超商代碼",href:"/orders/cvscode"},{id:"webatm",label:"WebATM",href:"/orders/webatm"}]:t.startsWith("/products")?[{id:"list",label:"商品清單",href:"/products"},{id:"add",label:"新增商品",href:"/products/add"},{id:"categories",label:"分類管理",href:"/products/categories"}]:t.startsWith("/inventory")?[{id:"overview",label:"庫存清單",href:"/inventory"},{id:"warehouses",label:"倉庫管理",href:"/inventory/warehouses"}]:t.startsWith("/logistics")?[{id:"tracking",label:"物流追蹤",href:"/logistics"}]:t.startsWith("/notifications")?[{id:"history",label:"歷史",href:"/notifications"},{id:"line-text",label:"LINE 文字",href:"/notifications/line-text"},{id:"line-flex",label:"LINE Flex",href:"/notifications/line-flex"},{id:"mail-text",label:"Email 文字",href:"/notifications/mail-text"},{id:"mail-html",label:"Email HTML",href:"/notifications/mail-html"},{id:"sms",label:"SMS",href:"/notifications/sms"},{id:"web",label:"站內通知",href:"/notifications/web"}]:t.startsWith("/procurement")?[{id:"overview",label:"採購總覽",href:"/procurement"},{id:"suppliers",label:"供應商",href:"/procurement/suppliers"}]:t.startsWith("/accounting")?[{id:"balance-sheet",label:"資產負債表",href:"/accounting/balance-sheet"},{id:"journal",label:"日記帳",href:"/accounting/journal"},{id:"accounts",label:"會計科目",href:"/accounting/accounts"}]:t.startsWith("/members")?[{id:"members",label:"會員管理",href:"/members"}]:t.startsWith("/admin")?[{id:"admin",label:"管理員管理",href:"/admin"},{id:"roles",label:"角色管理",href:"/admin/roles"}]:t.startsWith("/fromsigning")?[{id:"approvals",label:"表單審批",href:"/fromsigning"}]:t.startsWith("/notification-center")?[{id:"overview",label:"總覽",href:"/notification-center"},{id:"orders",label:"訂單通知",href:"/notification-center/orders"},{id:"ecpay-payments",label:"綠界付款",href:"/notification-center/ecpay/payments"},{id:"ecpay-subscriptions",label:"綠界定期",href:"/notification-center/ecpay/subscriptions"},{id:"ecpay-codes",label:"綠界取號",href:"/notification-center/ecpay/codes"},{id:"ecpay-cardless",label:"綠界分期",href:"/notification-center/ecpay/cardless-installments"}]:t.startsWith("/analytics")?[{id:"overview",label:"總覽",href:"/analytics"},{id:"sales",label:"銷售",href:"/analytics/sales"},{id:"customers",label:"顧客",href:"/analytics/customers"},{id:"products",label:"商品",href:"/analytics/products"},{id:"operations",label:"運營",href:"/analytics/operations"},{id:"ai",label:"AI 洞察",href:"/analytics/ai-insights"}]:t.startsWith("/user-tracking")?[{id:"events",label:"事件",href:"/user-tracking/events"},{id:"sessions",label:"工作階段",href:"/user-tracking/sessions"},{id:"segments",label:"分群",href:"/user-tracking/segments"},{id:"funnels",label:"漏斗",href:"/user-tracking/funnels"},{id:"retention",label:"留存",href:"/user-tracking/retention"}]:[]}function z({title:a,titleId:t,...l},f){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":t},l),a?i.createElement("title",{id:t},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"}))}const V=i.forwardRef(z),Z=V;function q({title:a,titleId:t,...l},f){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":t},l),a?i.createElement("title",{id:t},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const J=i.forwardRef(q),K=J,ge=()=>{const a=E(),t=W(),{currentUser:l,logout:f}=I(),[o,u]=i.useState(!1),[g,x]=i.useState(0),v=i.useRef(null),n=i.useRef(null),j=2,w=200;i.useEffect(()=>{const r=s=>{if(s.clientX<=j){o||u(!0),n.current&&(clearTimeout(n.current),n.current=null);return}const c=v.current;if(!c)return;const d=c.getBoundingClientRect(),m=s.clientX>=d.left&&s.clientX<=d.right&&s.clientY>=d.top&&s.clientY<=d.bottom;!m&&o?n.current||(n.current=setTimeout(()=>{u(!1),n.current=null},w)):m&&n.current&&(clearTimeout(n.current),n.current=null)};return window.addEventListener("mousemove",r),()=>window.removeEventListener("mousemove",r)},[o]);const p=Y(t.pathname);i.useEffect(()=>{var r,s;try{const d=(((s=(r=S).getNotifications)==null?void 0:s.call(r))||[]).filter(m=>m.status==="failed"||m.status==="pending").length;x(d)}catch{x(0)}},[]);const N=()=>{f(),i.startTransition(()=>a("/login"))},k=[{name:"總覽",href:"/dashboard/overview",icon:R,module:"dashboard"},{name:"商品管理",href:"/products",icon:$,module:"products"},{name:"庫存管理",href:"/inventory",icon:B,module:"inventory"},{name:"訂單管理",href:"/orders",icon:O,module:"orders"},{name:"物流管理",href:"/logistics",icon:D,module:"logistics"},{name:"通知管理",href:"/notifications",icon:y,module:"notifications"},{name:"行銷管理",href:"/marketing",icon:b,module:"marketing"},{name:"會員管理",href:"/members",icon:H,module:"members"},{name:"採購管理",href:"/procurement",icon:U,module:"procurement"},{name:"會計管理",href:"/accounting/balance-sheet",icon:_,module:"accounting"},{name:"評價管理",href:"/reviews",icon:F,module:"reviews"},{name:"表單審批",href:"/fromsigning",icon:G,module:"fromsigning"},{name:"管理員管理",href:"/admin",icon:P,module:"admin"},{name:"用戶追蹤",href:"/user-tracking",icon:b,module:"user-tracking"},{name:"數據分析",href:"/analytics",icon:b,module:"analytics"},{name:"系統設定",href:"/settings",icon:X,module:"settings"}].filter(r=>(l&&Array.isArray(l.permissions)?l.permissions:[]).includes(r.module)),C=r=>{if(r==="/dashboard/overview")return t.pathname==="/"||t.pathname==="/dashboard/overview";const s=r.split("/").filter(Boolean),c=s.length>0?`/${s[0]}`:r;return c&&t.pathname.startsWith(c)?!0:t.pathname.startsWith(r)},h=o;return e.jsxs("div",{className:`${T.pageContainer} flex`,children:[o&&e.jsx("div",{className:"fixed inset-0 z-40 bg-white/20 backdrop-blur-sm pointer-events-none transition-opacity duration-300"}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 transform transition-all duration-300 ease-in-out will-change-transform ${o?"w-64":"w-16"} ${o?"shadow-xl":"shadow-sm"}`,ref:v,onMouseEnter:()=>{n.current&&(clearTimeout(n.current),n.current=null)},onMouseLeave:()=>{n.current||(n.current=setTimeout(()=>{u(!1),n.current=null},w))},children:e.jsxs("div",{className:`flex flex-col h-full bg-[#fdf8f2] border-r border-gray-200 shadow-sm ${h?"":"pointer-events-none"}`,children:[e.jsx("div",{className:"flex items-center justify-between px-4 h-16 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 bg-[#cc824d] rounded-lg flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"M"})}),e.jsx("span",{className:`font-bold text-xl text-[#2d1e0f] font-serif transition-opacity duration-300 whitespace-nowrap ${o?"opacity-100":"opacity-0 w-0 overflow-hidden"}`,children:"Marelle 管理後台"})]})}),e.jsx("nav",{className:"flex-1 px-3 py-6 space-y-1","aria-hidden":!h,children:k.map(r=>e.jsxs(L,{to:r.href,tabIndex:h?0:-1,"aria-disabled":!h,className:({isActive:s})=>`flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all duration-200 font-serif group ${s||C(r.href)?"bg-[#cc824d] text-white shadow-sm":"text-gray-700 hover:bg-gray-100 hover:text-[#cc824d]"}`,title:o?"":r.name,children:[e.jsx(r.icon,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:`ml-3 transition-opacity duration-300 whitespace-nowrap ${o?"opacity-100":"opacity-0 w-0 overflow-hidden"}`,children:r.name})]},r.name))})]})}),e.jsxs("div",{className:`flex-1 flex flex-col min-w-0 transition-all duration-300 ease-in-out ${o?"ml-64":"ml-16"}`,children:[e.jsx("header",{className:"bg-[#fdf8f2] border-b border-gray-200 sticky top-0 z-30 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between px-8 h-16",children:[e.jsx("div",{className:"flex items-center flex-1",children:p&&p.length>0&&e.jsx("div",{className:"flex-1",children:e.jsx(A,{tabs:p,layout:"left",className:"text-sm"})})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>i.startTransition(()=>a("/notification-center")),className:"p-2 rounded-lg text-[#2d1e0f] hover:bg-[#f7ede3] hover:text-[#cc824d] transition-colors duration-200 relative",title:"通知中心",children:[e.jsx(y,{className:"w-5 h-5"}),g>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] px-1 bg-red-600 text-white text-[10px] leading-[18px] rounded-full text-center",children:g})]}),e.jsx("button",{onClick:()=>i.startTransition(()=>a("/accountsetting")),className:"p-2 rounded-lg text-[#2d1e0f] hover:bg-[#f7ede3] hover:text-[#cc824d] transition-colors duration-200",title:"帳號設定",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-[#2d1e0f] hover:bg-[#f7ede3] hover:text-[#cc824d] transition-colors duration-200 font-serif",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"登出"})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-hidden bg-[#fdf8f2]",style:{overflowY:"scroll",scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"h-full",children:e.jsx(M,{})})})]})]})};export{ge as default};
